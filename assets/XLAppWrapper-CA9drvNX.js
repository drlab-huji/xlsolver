var wa=Object.defineProperty;var ja=(t,e,n)=>e in t?wa(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var xe=(t,e,n)=>ja(t,typeof e!="symbol"?e+"":e,n);import{i as ba,n as Ei,j as a,a as Os,c as _a,d as vn,b as wt,G as on,C as gr,t as Se,u as li,p as Mt,F as wn,T as Sa,e as Ls,f as At,g as Ke,h as en,k as xr,l as Jn,m as Ca,o as jn,s as Hr,L as Ta,q as ci,_ as Ia,r as ka,v as Ds,w as Aa,x as Pa,y as Ma,z as Ea,A as $a,B as za,D as Ra,E as Na,H as vr,I as Oa,J as La,K as Da,M as ui,N as Fs,O as Vs,P as Fa,Q as Va,R as Ba,S as Bs,U as Ha,V as Wa,W as Xa,X as Ua,Y as Ga,Z as qa,$ as Ka,a0 as Ya}from"./index-CPmdMulF.js";import*as mt from"https://esm.sh/react@^19.0.0";import Za,{useRef as ot,useCallback as nt,useEffect as Gt,useState as lt,useLayoutEffect as Qa,memo as it,forwardRef as Ct,useMemo as W,Fragment as Ja,useDeferredValue as ie,useTransition as tl,startTransition as el}from"https://esm.sh/react@^19.0.0";import{s as Fn,v as Hs,p as Ws,u as bn,a as St,b as nl,_ as Xs,c as D,d as Us,e as rl,r as il,f as sl,g as $i,h as ol,i as al,j as ll,k as zi,l as cl,m as ul,n as hl}from"./import-files-YPtOk-wJ.js";import{Tooltip as He,Portal as Ve,useEditable as yr,Editable as Ut,VStack as wr,Flex as at,Box as Rt,Checkbox as ln,IconButton as Be,Popover as ut,HStack as jr,Text as Lt,Spinner as Ie,Dialog as Dt,EditableRootProvider as dl,EditablePreview as fl,EditableTextarea as pl,For as Ri,Span as Ce,Button as En,AbsoluteCenter as hi,Alert as Bt,Select as _t,Fieldset as Te,Input as Ne,useDialog as ce,DialogRootProvider as ke,Link as di,createListCollection as Gs,useSelect as qs,SelectRootProvider as Ks,SelectControl as ml,SelectTrigger as gl,SelectValueText as xl,Separator as Oe,CheckboxGroup as $n,Stack as De,Field as cn,FieldLabel as vl,FieldErrorText as Ge,usePopover as Ni,Card as be,Tag as We,ActionBar as nn,Menu as xt,Clipboard as Ae,DataList as bt,Switch as Me,Group as tr,FieldRoot as yl,Textarea as wl,FieldHelperText as jl,Icon as br,EmptyState as un,Container as zn,Tabs as ve,useFileUpload as bl,Center as Ys,List as je,ListItem as Oi,MenuItemIndicator as Li,useTabs as _l}from"https://esm.sh/@chakra-ui/react@^3.14.2?bundle=true";import Zs from"https://esm.sh/axios@^1.8.4";import{Global as er}from"https://esm.sh/@emotion/react@^11.14.0";import"https://esm.sh/core-js-bundle@^3.41.0";import"https://esm.sh/react-dom@^19.0.0/client";var nr=function(){return nr=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},nr.apply(this,arguments)};function Sl(){var t=ot(!1),e=nt(function(){return t.current},[]);return Gt(function(){return t.current=!0,function(){t.current=!1}},[]),e}function Cl(t,e,n){e===void 0&&(e=[]),n===void 0&&(n={loading:!1});var r=ot(0),i=Sl(),s=lt(n),o=s[0],c=s[1],u=nt(function(){for(var l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];var f=++r.current;return o.loading||c(function(d){return nr(nr({},d),{loading:!0})}),t.apply(void 0,l).then(function(d){return i()&&f===r.current&&c({value:d,loading:!1}),d},function(d){return i()&&f===r.current&&c({error:d,loading:!1}),d})},e);return[o,u]}var Tl=function(t,e,n){if(!ba)return[e,Ei,Ei];var r=JSON.parse,i=ot(function(h){try{var f=n?n.raw?String:n.serializer:JSON.stringify,d=localStorage.getItem(h);return d!==null?r(d):(e&&localStorage.setItem(h,f(e)),e)}catch{return e}}),s=lt(function(){return i.current(t)}),o=s[0],c=s[1];Qa(function(){return c(i.current(t))},[t]);var u=nt(function(h){try{var f=typeof h=="function"?h(o):h;if(typeof f>"u")return;var d=void 0;n||(d=JSON.stringify(f)),localStorage.setItem(t,d),c(r(d))}catch{}},[t,c]),l=nt(function(){try{localStorage.removeItem(t),c(void 0)}catch{}},[t,c]);return[o,u,l]};const Ee=mt.forwardRef(function(e,n){const{showArrow:r,children:i,disabled:s,portalled:o,content:c,contentProps:u,portalRef:l,...h}=e;return s?i:a.jsxs(He.Root,{...h,children:[a.jsx(He.Trigger,{asChild:!0,children:i}),a.jsx(Ve,{disabled:!o,container:l,children:a.jsx(He.Positioner,{children:a.jsxs(He.Content,{ref:n,...u,children:[r&&a.jsx(He.Arrow,{children:a.jsx(He.ArrowTip,{})}),c]})})})]})}),Il=t=>{const e=Number.parseFloat(t);if(!(Number.isNaN(e)||!Number.isFinite(e)))return e},Di=it(({value:t,onChange:e,ref:n,...r})=>{const i=yr({defaultValue:t==null?void 0:t.toString(),placeholder:{preview:"---",edit:""},onValueCommit:({value:s})=>{const o=e(Il(s));o!==void 0?i.setValue(o.toString()):i.clearValue()}});return a.jsxs(Ut.RootProvider,{value:i,justifyContent:"center",size:"sm",ref:n,...r,children:[a.jsx(Ut.Preview,{justifyContent:"center",w:"100%",_placeholderShown:{color:"fg.subtle"},whiteSpace:"nowrap",children:i.value?`${i.value} Å`:i.valueText}),a.jsx(Ut.Input,{inputMode:"decimal",textAlign:"center",focusRing:"none",borderBottomWidth:"1px",borderBottomColor:"border",borderRadius:0,_focusVisible:{borderColor:"var(--focus-color)",boxShadow:"0px 1px 0px 0px var(--focus-color)"}}),i.editing&&"Å"]})});function pn(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24}class _n{constructor(e,n){this.length=e,this.t=new Uint32Array(e+32>>>5),n===!0&&this.i()}get(e){return(this.t[e>>>5]&1<<e)!=0}set(e){this.t[e>>>5]|=1<<e}clear(e){this.t[e>>>5]&=~(1<<e)}o(e){this.t[e>>>5]^=1<<e}h(e,n,r){if(n<e)return;const i=this.t,s=r===!0?4294967295:0,o=e>>>5,c=n>>>5;for(let h=o;h<c;++h)i[h]=s;const u=o<<5,l=c<<5;if(r===!0)if(n-e<32)for(let h=e,f=n+1;h<f;++h)i[h>>>5]|=1<<h;else{for(let h=e,f=u;h<f;++h)i[h>>>5]|=1<<h;for(let h=l,f=n+1;h<f;++h)i[h>>>5]|=1<<h}else if(n-e<32)for(let h=e,f=n+1;h<f;++h)i[h>>>5]&=~(1<<h);else{for(let h=e,f=u;h<f;++h)i[h>>>5]&=~(1<<h);for(let h=l,f=n+1;h<f;++h)i[h>>>5]&=~(1<<h)}return this}l(e,n){return this.h(e,n,!0)}u(e,n){return this.h(e,n,!1)}A(...e){const n=this.t,r=e.length;for(let i=0;i<r;++i){const s=e[i];n[s>>>5]|=1<<s}return this}p(...e){const n=this.t,r=e.length;for(let i=0;i<r;++i){const s=e[i];n[s>>>5]&=~(1<<s)}return this}i(){return this.h(0,this.length-1,!0)}M(){return this.h(0,this.length-1,!1)}m(){const e=this.t.length,n=this.t,r=32-this.length%32;for(let i=0;i<e-1;++i)n[i]=~n[i];return n[e-1]=~(n[e-1]<<r)>>>r,this}S(e,n,r){if(n<e)return;const i=this.t,s=r===!0?4294967295:0,o=e>>>5,c=n>>>5;for(let u=o;u<c;++u)if(i[u]!==s)return!1;if(n-e<32){for(let u=e,l=n+1;u<l;++u)if(!!(i[u>>>5]&1<<u)!==r)return!1}else{const u=c<<5;for(let l=e,h=o<<5<<5;l<h;++l)if(!!(i[l>>>5]&1<<l)!==r)return!1;for(let l=u,h=n+1;l<h;++l)if(!!(i[l>>>5]&1<<l)!==r)return!1}return!0}U(e,n){return this.S(e,n,!0)}_(e,n){return this.S(e,n,!1)}q(){return this.S(0,this.length-1,!0)}v(){return this.S(0,this.length-1,!1)}O(...e){const n=this.t,r=e.length;for(let i=0;i<r;++i){const s=e[i];if((n[s>>>5]&1<<s)==0)return!1}return!0}C(...e){const n=this.t,r=e.length;for(let i=0;i<r;++i){const s=e[i];if((n[s>>>5]&1<<s)!=0)return!1}return!0}G(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length);for(let s=0;s<i;++s)if(n[s]!==r[s])return!1;return!0}P(){const e=this.t.length,n=this.t;let r=0;for(let i=0;i<e;++i)r+=pn(n[i]);return r}R(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length);for(let s=0;s<i;++s)n[s]=n[s]&~r[s];for(let s=n.length;s<i;++s)n[s]=0;return this}I(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length);for(let s=0;s<i;++s)n[s]|=r[s];for(let s=n.length;s<i;++s)n[s]=0;return this}T(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length);for(let s=0;s<i;++s)n[s]&=r[s];for(let s=n.length;s<i;++s)n[s]=0;return this}F(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length);for(let s=0;s<i;++s)if((n[s]&r[s])!=0)return!0;return!1}D(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length);let s=0;for(let o=0;o<i;++o)s+=pn(n[o]&r[o]);return s}B(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length),s=new Uint32Array(i),o=Object.create(_n.prototype);o.t=s,o.length=Math.min(this.length,e.length);for(let c=0;c<i;++c)s[c]=n[c]&r[c];return o}forEach(e){const n=this.t.length,r=this.t;let i=0;for(let s=0;s<n;++s){let o=r[s];for(;o!==0;){const c=o&-o;e((s<<5)+pn(c-1),i),o^=c,++i}}}toArray(){const e=this.t,n=Array(this.P()),r=this.t.length;let i=0;for(let s=0;s<r;++s){let o=e[s];for(;o!==0;){const c=o&-o;n[i++]=(s<<5)+pn(c-1),o^=c}}return n}toString(){return"{"+this.toArray().join(",")+"}"}N(){const e=this.toArray().join(",");return e?"@"+e:"NONE"}clone(){const e=Object.create(_n.prototype);return e.length=this.length,e.t=new Uint32Array(this.t),e}}const kl={matrix:[[58,23,-12,-7,-44,10,-23,-14,-14,-27,-17,-8,1,-9,-22,23,15,5,-74,-45,0],[23,224,-67,-63,-50,-30,-29,1,-56,-41,-6,-33,-44,-53,-43,15,2,18,-93,-6,0],[-12,-67,111,59,-104,-4,4,-84,6,-88,-65,48,-13,18,-29,5,-7,-63,-105,-73,0],[-7,-63,59,85,-83,-17,-1,-63,25,-60,-47,15,-12,40,-8,1,-7,-47,-108,-51,0],[-44,-50,-104,-83,144,-93,4,12,-74,36,30,-64,-67,-56,-65,-43,-41,-3,63,104,0],[10,-30,-4,-17,-93,140,-32,-95,-27,-91,-75,4,-36,-29,-32,5,-26,-68,-80,-79,0],[-23,-29,4,-1,4,-32,137,-50,6,-37,-42,21,-23,27,19,-4,-12,-44,-13,48,0],[-14,1,-84,-63,12,-95,-50,86,-53,53,47,-62,-60,-47,-55,-43,-8,69,-27,-24,0],[-14,-56,6,25,-74,-27,6,-53,75,-48,-30,13,-12,34,68,-3,-4,-44,-71,-49,0],[-27,-41,-88,-60,36,-91,-37,53,-48,88,62,-63,-48,-36,-48,-47,-25,36,-11,-4,0],[-17,-6,-65,-47,30,-75,-42,47,-30,62,103,-45,-54,-21,-31,-35,-9,31,-46,-20,0],[-8,-33,48,15,-64,4,21,-62,13,-63,-45,89,-25,12,2,22,10,-51,-79,-29,0],[1,-44,-13,-12,-67,-36,-23,-60,-12,-48,-54,-25,160,-6,-20,5,-12,-42,-76,-83,0],[-9,-53,18,40,-56,-29,27,-47,34,-36,-21,12,-6,75,34,1,-4,-37,-92,-48,0],[-22,-43,-29,-8,-65,-32,19,-55,68,-48,-31,2,-20,34,113,-10,-14,-49,-58,-39,0],[23,15,5,1,-43,5,-4,-43,-3,-47,-35,22,5,1,-10,53,32,-28,-62,-31,0],[15,2,-7,-7,-41,-26,-12,-8,-4,-25,-9,10,-12,-4,-14,32,68,0,-87,-40,0],[5,18,-63,-47,-3,-68,-44,69,-44,36,31,-51,-42,-37,-49,-28,0,74,-61,-32,0],[-74,-93,-105,-108,63,-80,-13,-27,-71,-11,-46,-79,-76,-92,-58,-62,-87,-61,289,81,0],[-45,-6,-73,-51,104,-79,48,-24,-49,-4,-20,-29,-83,-48,-39,-31,-40,-32,81,162,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],H:22,$:-300},Al={matrix:[[91,-114,-31,-123],[-114,100,-125,-31],[-31,-125,100,-114],[-123,-31,-114,91]],$:-400,H:120},Pl=/^[ACGTRNDEQHILKMFPSWYV]+$/,Ml=/^[ABCDGHKMNRSTUVWY]+$/i,El=/^[ABCGTRNDEQHIJLKMFPSWYUVXZ]+$/i,$l=/[^ACGU]/i,zl=/[^ACGT]/i;function Fi(t){if(!$l.test(t)||!zl.test(t))return 1;const e=Ml.test(t),n=Pl.test(t);if(n&&!e)return 0;if(n&&e||El.test(t))return Vi(t);throw Error("Unrecognized sequence type: "+t)}function Vi(t){let e=0;const n=Math.min(t.length,100);for(let r=0;r<n;r++)switch(t[r]){case"A":case"T":case"U":case"G":case"C":case"N":e++}return e/n>Math.SQRT1_2?1:0}const dt=new Uint8Array(96);dt.fill(255),dt[65]=0,dt[67]=1,dt[68]=2,dt[69]=3,dt[70]=4,dt[71]=5,dt[72]=6,dt[73]=7,dt[75]=8,dt[76]=9,dt[77]=10,dt[78]=11,dt[80]=12,dt[81]=13,dt[82]=14,dt[83]=15,dt[84]=16,dt[86]=17,dt[87]=18,dt[89]=19,dt[95]=20;const $e=new Uint8Array(96);function Rl(t,e){const n=Math.floor(100*Math.random());if(e===1)switch(t){case"M":return[0,1][n%2];case"R":return[0,2][n%2];case"W":return[0,3][n%2];case"S":return[1,2][n%2];case"Y":return[1,3][n%2];case"K":return[2,3][n%2];case"V":return[0,1,2][n%3];case"H":return[0,1,3][n%3];case"D":return[0,2,3][n%3];case"B":return[1,2,3][n%3];default:return n%4}switch(t){case"B":return[2,11][n%2];case"Z":return[3,13][n%2];case"J":return[7,9][n%2];default:return n%20}}function Nl(t){return t.map(e=>Ol[e])}$e.fill(255),$e[65]=0,$e[67]=1,$e[71]=2,$e[84]=3,$e[85]=3;const Ol=[0,1,2,2,3,0,4,5,4,5,5,2,0,2,4,0,0,5,3,3];function Ll(t,e,n){const r=[],i=n.gapchar;let s=0;for(let o=0;o<e.length;o++){let c=e[o];c<0?r.push(i.repeat(-c)):(r.push(t.substr(s,c)),s+=c)}return r.join("")}function Vn(t,e){const n=[0];let r=0;const i=e.slice();function s(o){(o^n[n.length-1])>=0?n[n.length-1]+=o:n.push(o)}for(let o=0;o<t.length;o++){let c=t[o];if(c<0)s(c);else for(;c>0&&r<i.length;){let u=i[r];u<0?c<-u?(i[r]+=c,s(-c),c=0):(s(u),c+=u,r++):c<u?(i[r]-=c,s(c),c=0):(s(u),c-=u,r++)}}return n}function Dl(t,e){const n=[];let r=0,i=0,s=t[0],o=e[0];for(;r<t.length||i<e.length;)s!==o?Math.sign(s)!==Math.sign(o)?s<0||o===void 0?(n.push(s),s=t[++r]):(n.push(o),o=e[++i]):s>0?s>o?(n.push(o),s-=o,o=e[++i]):(n.push(s),o-=s,s=t[++r]):(n.push(Math.min(s,o)),s=t[++r],o=e[++i]):(n.push(o),s=t[++r],o=e[++i]);return n}function Fl(t,e){const n=[];let r=0,i=0,s=e[0],o=t[0],c=0;for(;r<e.length||i<t.length;)if(c=n[n.length-1],s!==o){if(Math.sign(s)===Math.sign(o)){if(s>0){if(o>s)return;c>0?n[n.length-1]=c+o:n.push(o),s-=o,o=t[++i];continue}if(s>o){c>0?n[n.length-1]=c-s:n.push(Math.abs(s)),o-=s,s=e[++r];continue}return}if(!(o<0))return;c<0?n[n.length-1]=c+o:n.push(o),o=t[++i]}else c>0?n[n.length-1]=c+Math.abs(s):n.push(Math.abs(s)),s=e[++r],o=t[++i];return n}function Bi(t,e){if(Math.sign(t[t.length-1])===Math.sign(e[0])){let n=[...t];return n[n.length-1]+=e[0],n.push(...e.slice(1)),n}return[...t,...e]}function _e(t,e=0){const n=[];let r=0,i=0;for(let s=0;s<t.length;s++)i=t[s],(i^r)>=0?r+=i:(n.push(r),r=i);return n.push(r),n[0]===0&&n.shift(),1&e||n.reverse(),n}function Wr(t){let e=0,n=0;for(let r=0;r<t.length;r++)n=t[r],e+=n<0?-n:n;return e}function Hi(t){const e=[];let n=0,r=0;for(let i=0;i<t.length;i++)if(r=t[i],r<0)for(let s=0;s<-r;s++)e.push(-1);else for(let s=0;s<r;s++)e.push(n),n++;return e}function rr(t,e,n,r=0){const i=t.V,s=e.V,o=i.length,c=s.length;let u=0,l=[],h=[],f=0,d=0,p=0,x=0;const m=new Uint8Array(Math.ceil((o+1)*c/2)+1);let v=0,g=0,y=0,b=0,w=0,I=n.W[0];const E=n.$,_=1&r?0:-E/2,S=2&r?0:-E/2;l[0]=0,h[0]=-1/0;for(let R=1;R<=c;R++)l[R]=E+_,h[R]=-1/0;for(let R=1;R<=o;R++){f=_,d=-1/0,I=n.W[i[R-1]];for(let $=1;$<=c;$++)w=0,v=l[$]+E,y=h[$],$===c&&(v+=S),v>=y?h[$]=v:w+=1,g=f+E,b=d,R===o&&(g+=S),g>=b?d=g:w+=2,u=l[$-1]+I[s[$-1]],l[$-1]=f,u>=d?u>=h[$]?f=u:(f=h[$],w+=4):d>=h[$]?(f=d,w+=8):(f=h[$],w+=4),p=R*c+$,x=p%2,p>>>=1,m[p]+=x?w:w<<4;l[c]=f}const A=Math.max(u,d,h[h.length-1]),[k,P]=Xr(m,o,c,w);return{j:[_e(k),_e(P)],K:A}}function Xr(t,e,n,r){let i=e,s=n,o=e*n+n,c=o,u=1;const l=[],h=[];let f=(12&r)>>2,d=0;for(;i>0&&s>0;)o=i*n+s,c=o>>>1,u=o%2,d=t[c],d=u?15&d:d>>>4,f===0?(d>>=2,d===0&&(i--,s--,l.push(1),h.push(1))):f===2?(l.push(-1),h.push(1),d&=2,s--):(l.push(1),h.push(-1),d&=1,i--),f=d;return i>0?(l.push(i),h.push(-i)):s>0&&(l.push(-s),h.push(s)),[l,h]}class Qs{constructor(e,n,r,i=0){this.Y=0,this.length=0,this.weight=0,this.length=e,this.J=new _n(e),this.L=new Uint8Array(n*e),this.Z=new Uint8Array(n*e),this.X=new Float32Array(n*e),this.tt=new Float32Array(n*e),this.et=new Uint8Array(e),this.rt=new Float32Array(e),this.nt=new Float32Array(e),this.it=new Float32Array(e),this.st=new Float32Array(e),this.ot=new Float32Array(e),this.Y=r,this.ht=n,this.weight=i}ct(e=0){return new Vl(this,e)}}class Vl{constructor(e,n=0){this.lt=0,this.ht=4,this.offset=0,this.ut=e,this.lt=n,this.ht=e.ht,this.offset=this.lt*this.ht}ft(e){this.lt=e,this.offset=e*this.ht}get J(){return this.ut.J.get(this.lt)}set J(e){e?this.ut.J.set(this.lt):this.ut.J.clear(this.lt)}get L(){return this.ut.L.subarray(this.offset,this.offset+this.ht)}set L(e){this.ut.L.set(e,this.offset)}get et(){return this.ut.et[this.lt]}set et(e){this.ut.et[this.lt]=e}get Z(){return this.ut.Z.subarray(this.offset,this.offset+this.ht)}set Z(e){this.ut.Z.set(e,this.offset)}get X(){return this.ut.X.subarray(this.offset,this.offset+this.ht)}set X(e){this.ut.X.set(e,this.offset)}get tt(){return this.ut.tt.subarray(this.offset,this.offset+this.ht)}set tt(e){this.ut.tt.set(e,this.offset)}get rt(){return this.ut.rt[this.lt]}set rt(e){this.ut.rt[this.lt]=e}get nt(){return this.ut.nt[this.lt]}set nt(e){this.ut.nt[this.lt]=e}get it(){return this.ut.it[this.lt]}set it(e){this.ut.it[this.lt]=e}get st(){return this.ut.st[this.lt]}set st(e){this.ut.st[this.lt]=e}get ot(){return this.ut.ot[this.lt]}set ot(e){this.ut.ot[this.lt]=e}}function Bl(t,e,n,r=0){const i=t.V,s=i.length,o=new Qs(s,n.dt,1,e);let c=e;const u=n.$;let l=o.ct(),h=0;for(let f=0;f<s;f++){l.ft(f),h=i[f],l.Z[h]=1,l.X[h]=c,l.L[l.et]=h,l.et=1,l.rt=c,l.st=u/2*c,l.ot=u/2*c;for(let d=0;d<n.dt;d++)l.tt[d]=c*n.W[d][h]}return 1&r||(o.st[0]/=2),2&r||(o.st[s-1]/=2),o}function Mr(t,e,n,r,i,s=0){const o=Wr(n),c=t.Y+e.Y,u=t.weight+e.weight,l=new Qs(o,i.dt,c,u),h=i.$;let f=l.ct(),d=t.ct(),p=e.ct(),x=Hi(n),m=Hi(r),v=0,g=0,y=1,b=1,w=!1,I=!1,E=!1,_=!1,S=0;for(let A=0;A<o;A++){if(f.ft(A),v=x[A],d.ft(v),v===-1?(w=y>=0,I=A===o-1||x[A+1]>0):(w=!1,I=!1),y=v,g=m[A],p.ft(g),g===-1?(E=b>=0,_=A==o-1||m[A+1]>0):(E=!1,_=!1),b=g,S=0,v!==-1&&g!==-1){f.nt=d.nt+p.nt,f.it=d.it+p.it,f.rt=d.rt+p.rt,f.Z.set(d.Z),f.X.set(d.X);for(let k=0;k<e.ht;k++){let P=p.Z[k];P&&(f.Z[k]+=P,f.X[k]+=p.X[k]),f.Z[k]&&(f.L[S]=k,S++),f.tt[k]=d.tt[k]+p.tt[k]}f.et=S}else v==-1?(f.nt=p.nt+(w?t.weight:0),f.it=p.it+(I?t.weight:0),f.rt=p.rt,f.Z.set(p.Z),f.X.set(p.X),f.L.set(p.L),f.tt.set(p.tt),f.et=p.et):g==-1&&(f.nt=d.nt+(E?e.weight:0),f.it=d.it+(_?e.weight:0),f.rt=d.rt,f.Z.set(d.Z),f.X.set(d.X),f.L.set(d.L),f.tt.set(d.tt),f.et=d.et);f.st=h/2*(1-f.nt)*f.rt,f.ot=h/2*(1-f.it)*f.rt}return 1&s||(l.st[0]/=2),2&s||(l.st[o-1]/=2),l}function Xe(t){return"gt"in t}function Hl(t,e){let n=1/0,r=0,i=0,s=t.length;for(let o=0;o<s;o++)for(let c=o+1;c<s;c++)t[o][c]<n&&(n=t[o][c],r=o,i=c);return[{profile:null,wt:e[r],At:e[i],Mt:n,yt:[],St:[],Ut:[],type:1,_t:0,id:"",qt:[],parent:-1,weight:0},r,i]}function Wl(t,e,n,r){const[i,s]=e>n?[e,n]:[n,e],o=[],c=t.length;for(let u=0;u<c;u++){if(u==e||u==n)continue;const l=.1*(t[u][e]+t[u][n])/2+.9*Math.min(t[u][e],t[u][n]);t[u].push(l),o.push(l),t[u].splice(i,1),t[u].splice(s,1)}return o.push(0),t.push(o),t.splice(i,1),t.splice(s,1),r.splice(i,1),r.splice(s,1),t}class Xl{constructor(e){this.bt=e,this.store=Array(e),this.head=0,this.vt=0}get size(){return(this.vt-this.head+this.bt)%this.bt}get Ot(){return this.head===this.vt}Ct(){if(this.Ot)return null;const e=this.store[this.head];return this.head++,this.head>=this.bt&&(this.head=0),e}Et(){return this.Ot?null:(this.vt--,this.vt<0&&(this.vt=this.bt-1),this.store[this.vt])}Gt(e){this.head--,this.head<0&&(this.head=this.bt-1),this.store[this.head]=e,this.head===this.vt&&(this.vt=(this.vt-1+this.bt)%this.bt)}Pt(e){this.store[this.vt]=e,this.vt++,this.vt>=this.bt&&(this.vt=0),this.head===this.vt&&(this.head=(this.head-1+this.bt)%this.bt)}Rt(e=0){const n=e===0?this.head:(this.head+e+this.bt)%this.bt;return this.store[n]}It(e=0){const n=(this.vt-1-e+this.bt)%this.bt;return this.store[n]}}function Ur(t,e,n){const r=new Map,i=new Xl(n),s=0|e,o=new Uint16Array(t.V.length-s+1);let c=0,u=0;for(let x=0;x<s;x++)c|=t.V[s-x-1]<<2*x;o[u++]=c;for(let x=s,m=t.V.length;x<m;x++)c=(c<<2)+t.V[x],o[u++]=c;const l=t.Tt.length*(2/(n+1))*2|0,h={Ft:new Uint16Array(l),Dt:new Uint16Array(l),xt:new Uint16Array(l),Bt:new Uint16Array(l),count:0};let f=NaN,d=0,p=-17;for(let x=0;x<o.length;x++){const m=o[x];for(p++;!i.Ot&&((d=i.It())<p||o[d]>=m);)i.Et();if(i.Pt(x),p<0)continue;for(;i.Rt()<p;)i.Ct();let v=i.Rt();if(v===f)h.Bt[h.count-1]=x+s;else{const g=o[v],y=h.count;h.count++,h.Ft[y]=g,h.Dt[y]=v,h.xt[y]=p,h.Bt[y]=x+s,f=v,r.has(g)?r.get(g).push(y):r.set(g,[y])}}return[r,h,o]}function Wi(t,e,n,r,i){const[s,o,c]=r??Ur(t,8,24),[u,l,h]=i??Ur(e,8,24);t.Tt.length,e.Tt.length;const f=new Map;for(let _=0;_<o.count;_++){let S=o.Ft[_];if(!u.has(S))continue;let A=u.get(S);if(A.length>4)continue;let k=t.Tt.substring(o.xt[_],o.Bt[_]);for(let P=0;P<A.length;P++){let R=A[P],$=e.Tt.substring(l.xt[R],l.Bt[R]),j=Math.min(k.length,$.length),T=!1;T=j==k.length?$.indexOf(k)===0:k.indexOf($)===0;let C,M=0;T?(M=o.xt[_]-l.xt[R],C={Nt:M,Ht:o.xt[_],end:o.xt[_]+j}):(M=o.Dt[_]-l.Dt[R],C={Nt:M,Ht:o.Dt[_],end:o.Dt[_]+8-1}),f.has(M)?f.get(M).push(C):f.set(M,[C])}}let d=[];if(f.forEach(_=>{if(!_.length)return;let S=_[0];d.push(S),_.forEach(A=>{A.Ht<=S.end?S.end=A.end:(S=A,d.push(S))})}),d.length===0)return rr(t,e,n).j;d.sort((_,S)=>{let A=_.Ht+_.Nt-S.Ht-S.Nt;return A===0?_.Nt-S.Nt:A}),d=function(_,S,A){var k;const P=1/Math.max(S,A),R=S-A;let $=[0],j=new Int16Array(_.length);j[0]=-1;let T=_[0],C=T.end-T.Ht,M=T.end-T.Nt,O=T.Ht-T.Nt,V=Math.min(A-M,S-T.end),F=[C],H=[M],Y=[V],N=_[0],L=0,U=_[L],G=C,q=0;for(let ct=1;ct<_.length;ct++){if(T=_[ct],C=T.end-T.Ht,M=T.end-T.Nt,O=T.Ht-T.Nt,V=T.Nt<R?A-M:S-T.end,q===20){q=0;let ft=[],vt=$.length-1,ht=H[vt],Q=S-T.Ht;for(;vt--;)H[vt]>ht?ft.push(vt):(ht=H[vt],F[vt]+Math.min(Y[vt],Q)<G&&ft.push(vt));ft.forEach(zt=>{$.splice(zt,1),F.splice(zt,1),H.splice(zt,1),Y.splice(zt,1)})}if(T.Nt>=N.Nt&&M<H[0]){if(C+V<G)continue;if(j[ct]=-1,N=_[ct],q++,C<F[0]){$.unshift(ct),F.unshift(C),H.unshift(M),Y.unshift(V);continue}C>G&&(G=C),$[0]=ct,F[0]=C,H[0]=M,Y[0]=V}else{for(let ft=$.length-1;ft>=0;ft--)if(L=$[ft],U=_[L],T.Ht>=U.end&&H[ft]<O){const vt=Math.abs(T.Nt-L)*P,ht=F[ft]+C-vt;if(ht+V<G)continue;let Q=ft;for(;Q<$.length&&F[Q]<ht;)Q++;if(Q===$.length)G=ht,Y.push(V),F.push(ht),H.push(M),$.push(ct);else{if(M>=H[H.length-1])continue;Y.splice(Q,0,V),F.splice(Q,0,ht),H.splice(Q,0,M),$.splice(Q,0,ct)}j[ct]=L,q++;break}C>G&&(j[ct]=-1,G=C,Y.push(V),F.push(C),H.push(M),$.push(ct),q++)}}let Z=[],rt=(k=$.pop())!==null&&k!==void 0?k:0,tt=rt;for(;rt>-1&&tt>-1;)Z.push(rt),rt=j[rt],tt--;let $t=[];for(let ct=Z.length-1;ct>=0;ct--)$t.push(_[Z[ct]]);return $t}(d,t.V.length,e.V.length);let p={Nt:0,Ht:0,end:0},x=[p],m=[];for(let _=0;_<d.length;_++){let S=d[_];if(S.Nt!==p.Nt){let A=p.end,k=A-p.Nt;for(;t.V[A]===e.V[k]&&A<S.Ht&&k<S.Ht-S.Nt;)A++,k++;for(p.end=A,A=S.Ht,k=A-S.Nt;t.V[A]===e.V[k]&&A>p.end&&k>p.end-p.Nt;)A--,k--;S.Ht=A+1,m.push({$t:S.Nt,kt:p.Nt,Ht:p.end,end:S.Ht}),x.push(S),p=S}else{let A=p.end,k=A-S.Nt,P=0;for(;A<S.Ht&&k<S.Ht-S.Nt&&P<2;)A+=8,k+=8,P=Ui(c[A],h[k])<=2?0:P+1;for(A>p.end&&(p.end=Math.max(A-2-8,p.end)),A=S.Ht-8,k=A-S.Nt,P=0;A>p.end&&k>p.end-p.Nt&&P<2;)A-=8,k-=8,P=Ui(c[A],h[k])<=2?0:P+1;if(A<S.Ht-16&&(S.Ht=A+24+2),S.Ht-p.end<=24){p.end=S.end;continue}m.push({kt:p.Nt,$t:S.Nt,Ht:p.end,end:S.Ht}),x.push(S),p=S}}let v=x[0];const g=[],y=[];for(let _=0;_<x.length;_++){v=x[_],g.push(v.end-v.Ht),y.push(v.end-v.Ht);let S=m[_];if(S){if(S.Ht===S.end){const k=Math.abs(S.$t-S.kt);g.push(-k),y.push(k);continue}if(S.Ht-S.kt==S.end-S.$t){const k=S.end-S.Ht;y.push(-k),g.push(k);continue}let A=rr({Tt:t.Tt.substring(S.Ht,S.end),type:t.type,V:t.V.subarray(S.Ht,S.end)},{Tt:e.Tt.substring(S.Ht-S.kt,S.end-S.$t),type:e.type,V:e.V.subarray(S.Ht-S.kt,S.end-S.$t)},n,3);g.push(...A.j[0]),y.push(...A.j[1])}}Xi(g,t.V.length),Xi(y,e.V.length);let b=_e(g,1),w=_e(y,1);const I=Wr(b),E=Wr(w);return I>E?w=Bi(w,[E-I]):I<E&&(b=Bi(b,[I-E])),[b,w]}function Xi(t,e){let n=e-function(r){let i=0,s=0;for(let o=0;o<r.length;o++)s=r[o],s<0||(i+=s);return i}(t);n>0?t.push(n):n<0&&(t[t.length-1]+=n)}function Ui(t,e){let n=t^e;return n=1431655765&n|n>>1&1431655765,pn(n)}const Gi={Vt:"auto",gapchar:"-",Wt:"auto",debug:!1},Ul=new class{constructor(){this.jt=[],this.Kt=2,this.Yt=Object.assign({},Gi)}Jt(t){if(Array.isArray(t))t.forEach(e=>{this.Jt(e)});else{if(typeof t!="string")throw new TypeError("String type expected for sequences to add.");if(t=t.toUpperCase(),this.Yt.Vt==="auto"){const e=Fi(t);if(this.Kt===2)this.Kt=e;else if(this.Kt!==e)throw Error("All sequences must be of same type.")}this.jt.push(function(e,n){const r=n??Fi(e),i=function(s,o){const c=new Uint8Array(s.length),u=o===0?dt:$e;let l=0;for(let h=0,f=s.length;h<f;h++)l=u[s.charCodeAt(h)],l===255&&(l=Rl(s[h],o)),c[h]=l;return c}(e,r);return{Tt:e,V:i,zt:r===0?Nl(i):i,type:r}}(t,this.Kt))}}reset(){this.jt=[],this.Kt=2,this.Lt()}Lt(){this.Yt=Object.assign({},Gi)}Qt(t){var e;function n(r,i){return i.some(s=>s==r)}t.method&&n(t.method,["complete","diag"])&&(this.Yt.Wt=t.method),t.type&&n(t.type,["amino","nucleic"])&&(this.Yt.Vt=t.type,this.Kt=t.type==="amino"?0:1),((e=t.gapchar)===null||e===void 0?void 0:e.length)===1&&(this.Yt.gapchar=t.gapchar),t.debug!==void 0&&(this.Yt.debug=!!t.debug)}align(t,e){return new Promise((r,i)=>{if(!Array.isArray(t)||t.some(l=>typeof l!="string"))return i("Array of sequences expected");if(t.length<2)return i("At least 2 sequences are required.");this.reset(),e&&this.Qt(e),this.Jt(t);const s=function(l,h){var f,d;const p=l===0?kl:Al;let x=(f=h==null?void 0:h.matrix)!==null&&f!==void 0?f:p.matrix,m=h!=null&&h.gapextend?2*-h.gapextend:p.H;var v;return{type:l,W:(v=m,x.map(g=>g.map(y=>y+v))),$:(d=h==null?void 0:h.gapopen)!==null&&d!==void 0?d:p.$,dt:l===0?20:4}}(this.Kt,e);let o,c=!1;c=this.Yt.Wt==="auto"?this.jt.some(l=>l.Tt.length>1600):this.Yt.Wt==="diag",o=this.jt.length==2?c?Wi(this.jt[0],this.jt[1],s):rr(this.jt[0],this.jt[1],s).j:c?function(l,h){let f=l.map(m=>Ur(m,8,24)),d=[],p=[],x=[];for(let m=0;m<f.length;m++){if(m===0)continue;let v=Wi(l[0],l[m],h,f[0],f[m]);p=p.length===0?v[0]:Dl(p,v[0]),x[m]=v[0],d[m]=v[1]}for(let m=0;m<f.length;m++){if(m===0){d[m]=p;continue}let v=Fl(p,x[m]);if(!v)throw console.error("An error occured while computing the center diff. for sequence #"+m,p,x[m]),console.dir(d),console.dir(x),new RangeError;d[m]=Vn(v,d[m])}return d}(this.jt,s):function(l,h){const f=(m,v)=>{const g=d[m.wt],y=d[m.At];let b={};if(Xe(g)||g.St.length!==0||f(g,v),Xe(y)||y.St.length!==0||f(y,v),Xe(g))if(Xe(y)){const w=rr(g.gt,y.gt,h);b.K=w.K,m.Ut=[g.Ut[0],y.Ut[0]],m.yt=w.j,m.profile=Mr(g.profile,y.profile,w.j[0],w.j[1],h)}else{y.qt=y.Ut.map(I=>v[I]);const w=function(I,E,_,S=0){const A=E.gt,k=E.weight,P=A.Tt.length,R=I.profile.length;let $=0,j=[],T=[];const C=new Uint8Array(Math.ceil((R+1)*(P+1)/2)+1);let M,O,V,F=0,H=0,Y=0,N=0,L=0,U=0,G=0,q=0,Z=0,rt=0,tt=0,$t=0,ct=0;const ft=_.$*k,vt=ft/2,ht=ft/2,Q=1&S?0:-ft/4,zt=2&S?0:-ft/4,Pe=A.V,Tt=I.profile;j[0]=0,T[0]=-1/0;for(let X=1;X<=P;X++)j[X]=vt+ht+Q,T[X]=-1/0;for(let X=1;X<=R;X++){$t=Tt.st[X-1],ct=Tt.ot[X-1],V=Tt.tt.subarray((X-1)*_.dt,X*_.dt),Z=Q,U=-1/0,T[0]=Tt.st[0];for(let K=1;K<=P;K++)L=0,F=j[K]+$t,Y=q=T[K],K===P&&(F-=$t/2),F>=Y?T[K]=F:L+=1,H=Z+vt,N=G=U,X===R&&(H+=zt),H>=N?U=H:L+=2,rt=q+ct,tt=G+ht,$=j[K-1]+V[Pe[K-1]],K===P&&(tt+=zt),j[K-1]=Z,$>=tt?$>=rt?Z=$:(Z=rt,L+=4):tt>=rt?(Z=tt,L+=8):(Z=rt,L+=4),M=X*P+K,O=M%2,M>>>=1,C[M]+=O?L:L<<4;j[P]=Z}const Kt=Math.max($,U,T[T.length-2]),[z,B]=Xr(C,R,P,L);return{j:[_e(z),_e(B)],K:Kt}}(y,g,h);b.K=w.K,m.Ut=[g.Ut[0],...y.Ut],m.yt=[w.j[1],...y.yt.map(I=>Vn(w.j[0],I))],m.profile=Mr(g.profile,y.profile,w.j[1],w.j[0],h)}else if(!Xe(y)){y.qt=y.Ut.map(I=>v[I]),g.qt=g.Ut.map(I=>v[I]);const w=function(I,E,_,S=0){const A=I.profile.length,k=E.profile.length,P=new Uint8Array(Math.ceil((A+1)*(k+1)/2)+1);let R,$,j=[],T=[],C=0,M=0,O=0,V=0,F=0,H=0,Y=0,N=0,L=0,U=0,G=0,q=0,Z=0,rt=0,tt=new Float32Array(_.dt),$t=new Uint8Array(_.dt),ct=0,ft=0,vt=0,ht=0,Q=0,zt=0;const Pe=1&S?1:2,Tt=E.profile,Kt=I.profile;for(j[0]=0,T[0]=-1/0,Q=1;Q<=k;Q++)j[Q]=Tt.st[0]+Tt.ot[Q-1]/Pe,T[Q]=-1/0;const z=Kt.st[0];for(ht=1;ht<=A;ht++){for(tt=Kt.tt.subarray(_.dt*(ht-1),_.dt*ht),Z=Kt.st[ht-1],rt=Kt.ot[ht-1],L=z+rt/Pe,Y=-1/0,T[0]=Kt.st[0],Q=1;Q<=k;Q++){for(H=0,M=j[Q]+Z,V=U=T[Q],Q!==k||2&S||(M-=Z/2),M>=V?T[Q]=M:H+=1,O=L+Tt.st[Q-1],F=N=Y,ht!==A||2&S||(O-=Tt.st[Q-1]/2),O>=F?Y=O:H+=2,C=j[Q-1],vt=Tt.et[Q-1],zt=0,ft=(Q-1)*_.dt,$t=Tt.L.subarray(ft,ft+vt);zt<vt;)ct=$t[zt],C+=tt[ct],zt++;G=U+rt,q=N+Tt.ot[Q-1],Q!==1||2&S||(G-=rt/2),Q!==k||2&S||(G-=rt/2,q-=Tt.ot[k-1]/2),j[Q-1]=L,C>=q?C>=G?L=C:(L=G,H+=4):q>=G?(L=q,H+=8):(L=G,H+=4),R=ht*k+Q,$=R%2,R>>>=1,P[R]+=$?H:H<<4}j[k]=L}const B=Math.max(C,Y,T[Q-1]),[X,K]=Xr(P,A,k,H);return{j:[_e(X),_e(K)],K:B}}(g,y,h);b.K=w.K,m.yt=[...g.yt.map(I=>Vn(w.j[0],I)),...y.yt.map(I=>Vn(w.j[1],I))],m.profile=Mr(g.profile,y.profile,w.j[0],w.j[1],h)}return m.Ut=[...g.Ut,...y.Ut],b.K},d=function(m,v){let g,y,b,w=[],I=m.length,E=[];for(let _=0;_<I;_++)w[_]={type:0,gt:v[_],profile:null,wt:_,At:_,Mt:0,Ut:[_],St:[],id:_.toString(),weight:0,parent:-1,_t:0},E[_]=_;for(let _=0,S=I-1;_<S;_++){[g,y,b]=Hl(m,E);const A=w[g.wt],k=w[g.At];g.id=A.id<k.id?`|${A.id},${k.id}|`:`|${k.id},${A.id}|`,g._t=Math.max(A._t,k._t)+1,k.parent=A.parent=w.length,E.push(I+_),w.push(g),m=Wl(m,y,b,E)}return w[w.length-1].type=2,w}(function(m){const v=m[0].type===0,g=v?6:4,y=Math.pow(g,6),b=m.map($=>{const j=new _n(y),T=v?$.zt:$.V;let C=0;for(let O=0;O<6;O++)C+=T[O]*Math.pow(g,O);j.set(C);const M=Math.pow(g,5);for(let O=6,V=T.length;O<V;O++)C-=T[O-6],C/=g,C+=T[O]*M,j.set(C);return j}),w=m.length,I=m.map(()=>[]);let E,_,S,A,k,P,R;for(let $=0;$<w;$++){I[$][$]=0,E=b[$],S=E.P(),P=1/(-Math.LN2/Math.log(1-S/y)*2);for(let j=$+1;j<w;j++)A=b[j].P(),k=E.D(b[j]),k+=y-(S+A-k),R=Math.ceil(P*A),k-=R,k=Math.max(k,0),_=1-k/(y-R),I[j][$]=I[$][j]=_}return I}(l),l),p=d[d.length-1],x=function(m){let v=0;return function g(y){let b=0,w=0;switch(y.type){case 2:y.weight=0,g(m[y.wt]),g(m[y.At]);break;case 1:b=m[y.parent].Mt-y.Mt,w=y.id.split(",").length,y.weight=m[y.parent].weight+b/w,g(m[y.wt]),g(m[y.At]);break;case 0:b=m[y.parent].Mt,y.weight=m[y.parent].weight+b,v+=y.weight}}(m[m.length-1]),m.map(g=>g.weight)}(d);return function(m,v,g){let y=0,b=m[y];for(;Xe(b)&&y<m.length;)b.profile=Bl(b.gt,b.weight,v,void 0),y++,b=m[y]}(d,h),f(p,x),function(m,v){let g=v.slice();return v.forEach((y,b)=>g[y]=b),g.map(y=>m[y])}(p.yt.slice(),p.Ut)}(this.jt,s);const u=function(l,h,f){var d;let p=(d=f==null?void 0:f.gapchar)!==null&&d!==void 0?d:"-",x=[];for(let m=0;m<l.length;m++)x.push(Ll(l[m].Tt,h[m],{gapchar:p}));return x}(this.jt,o,{gapchar:this.Yt.gapchar});return r(u)}).catch(r=>Promise.reject(r))}},Js={A:{A:10,R:-1,N:0,D:-1,C:-1,Q:-1,E:-1,G:1,H:-2,I:0,L:-1,K:-1,M:-1,F:-3,P:1,S:1,T:2,W:-4,Y:-3,V:1,B:0,Z:-1,X:0,"-":0},R:{A:-1,R:10,N:0,D:-1,C:-1,Q:2,E:0,G:0,H:2,I:-3,L:-3,K:4,M:-2,F:-4,P:-1,S:-1,T:-1,W:0,Y:-2,V:-3,B:0,Z:1,X:0,"-":0},N:{A:0,R:0,N:10,D:2,C:-1,Q:0,E:1,G:0,H:1,I:-2,L:-3,K:1,M:-2,F:-3,P:-1,S:1,T:1,W:-4,Y:-1,V:-2,B:2,Z:0,X:0,"-":0},D:{A:-1,R:-1,N:2,D:10,C:-3,Q:0,E:4,G:1,H:0,I:-3,L:-4,K:0,M:-3,F:-5,P:-2,S:0,T:-1,W:-5,Y:-2,V:-3,B:3,Z:2,X:0,"-":0},C:{A:-1,R:-1,N:-1,D:-3,C:10,Q:-3,E:-4,G:-1,H:0,I:-2,L:-3,K:-3,M:-2,F:0,P:-2,S:1,T:-1,W:1,Y:2,V:-2,B:-2,Z:-3,X:0,"-":0},Q:{A:-1,R:2,N:0,D:0,C:-3,Q:10,E:2,G:-1,H:3,I:-3,L:-2,K:2,M:-2,F:-4,P:0,S:-1,T:-1,W:-3,Y:-1,V:-3,B:0,Z:3,X:0,"-":0},E:{A:-1,R:0,N:1,D:4,C:-4,Q:2,E:10,G:1,H:0,I:-3,L:-4,K:1,M:-3,F:-5,P:-2,S:-1,T:-1,W:-5,Y:-4,V:-2,B:2,Z:3,X:0,"-":0},G:{A:1,R:0,N:0,D:1,C:-1,Q:-1,E:1,G:10,H:-2,I:-3,L:-4,K:-1,M:-3,F:-5,P:-1,S:1,T:0,W:-2,Y:-4,V:-2,B:0,Z:0,X:0,"-":0},H:{A:-2,R:2,N:1,D:0,C:0,Q:3,E:0,G:-2,H:10,I:-3,L:-2,K:1,M:-2,F:0,P:0,S:-1,T:-1,W:-3,Y:4,V:-3,B:0,Z:1,X:0,"-":0},I:{A:0,R:-3,N:-2,D:-3,C:-2,Q:-3,E:-3,G:-3,H:-3,I:10,L:2,K:-3,M:3,F:0,P:-2,S:-1,T:1,W:-4,Y:-2,V:4,B:-2,Z:-3,X:0,"-":0},L:{A:-1,R:-3,N:-3,D:-4,C:-3,Q:-2,E:-4,G:-4,H:-2,I:2,L:10,K:-3,M:3,F:2,P:0,S:-2,T:-1,W:-2,Y:-1,V:2,B:-3,Z:-3,X:0,"-":0},K:{A:-1,R:4,N:1,D:0,C:-3,Q:2,E:1,G:-1,H:1,I:-3,L:-3,K:10,M:-2,F:-5,P:-2,S:-1,T:-1,W:-3,Y:-3,V:-3,B:0,Z:1,X:0,"-":0},M:{A:-1,R:-2,N:-2,D:-3,C:-2,Q:-2,E:-3,G:-3,H:-2,I:3,L:3,K:-2,M:10,F:0,P:-2,S:-1,T:0,W:-3,Y:-3,V:2,B:-2,Z:-2,X:0,"-":0},F:{A:-3,R:-4,N:-3,D:-5,C:0,Q:-4,E:-5,G:-5,H:0,I:0,L:2,K:-5,M:0,F:10,P:-2,S:-2,T:-2,W:-1,Y:5,V:0,B:-4,Z:-4,X:0,"-":0},P:{A:1,R:-1,N:-1,D:-2,C:-2,Q:0,E:-2,G:-1,H:0,I:-2,L:0,K:-2,M:-2,F:-2,P:10,S:1,T:1,W:-5,Y:-3,V:-1,B:-1,Z:-1,X:0,"-":0},S:{A:1,R:-1,N:1,D:0,C:1,Q:-1,E:-1,G:1,H:-1,I:-1,L:-2,K:-1,M:-1,F:-2,P:1,S:10,T:1,W:-3,Y:-1,V:-1,B:0,Z:-1,X:0,"-":0},T:{A:2,R:-1,N:1,D:-1,C:-1,Q:-1,E:-1,G:0,H:-1,I:1,L:-1,K:-1,M:0,F:-2,P:1,S:1,T:10,W:-4,Y:-3,V:0,B:0,Z:-1,X:0,"-":0},W:{A:-4,R:0,N:-4,D:-5,C:1,Q:-3,E:-5,G:-2,H:-3,I:-4,L:-2,K:-3,M:-3,F:-1,P:-5,S:-3,T:-4,W:10,Y:0,V:-4,B:-4,Z:-4,X:0,"-":0},Y:{A:-3,R:-2,N:-1,D:-2,C:2,Q:-1,E:-4,G:-4,H:4,I:-2,L:-1,K:-3,M:-3,F:5,P:-3,S:-1,T:-3,W:0,Y:10,V:-3,B:-1,Z:-2,X:0,"-":0},V:{A:1,R:-3,N:-2,D:-3,C:-2,Q:-3,E:-2,G:-2,H:-3,I:4,L:2,K:-3,M:2,F:0,P:-1,S:-1,T:0,W:-4,Y:-3,V:10,B:-2,Z:-2,X:0,"-":0},B:{A:0,R:0,N:2,D:3,C:-2,Q:0,E:2,G:0,H:0,I:-2,L:-3,K:0,M:-2,F:-4,P:-1,S:0,T:0,W:-4,Y:-1,V:-2,B:10,Z:1,X:0,"-":0},Z:{A:-1,R:1,N:0,D:2,C:-3,Q:3,E:3,G:0,H:1,I:-3,L:-3,K:1,M:-2,F:-4,P:-1,S:-1,T:-1,W:-4,Y:-2,V:-2,B:1,Z:10,X:0,"-":0},X:{A:0,R:0,N:0,D:0,C:0,Q:0,E:0,G:0,H:0,I:0,L:0,K:0,M:0,F:0,P:0,S:0,T:0,W:0,Y:0,V:0,B:0,Z:0,X:1,"-":0},"-":{A:0,R:0,N:0,D:0,C:0,Q:0,E:0,G:0,H:0,I:0,L:0,K:0,M:0,F:0,P:0,S:0,T:0,W:0,Y:0,V:0,B:0,Z:0,X:0,"-":1}},to=Object.values(Js).map(t=>Object.values(t)),qi=Math.min(...to.flat()),Gl=Math.max(...to.flat());function eo(t,e){return t==="-"||e==="-"?0:(Js[t][e]-qi)/(Gl-qi)}function ql(t,e){const n=Array.from(t),r=Array.from(e),i=[];for(let c=0;c<n.length;c++)n[c]==="-"||r[c]==="-"||i.push(c);const s=i.length;let o=0;for(const c of i)o+=eo(n[c],r[c]);return 1-o/s}function Ki(t,e){let n=0;for(const r of e)n+=ql(t,r);return n/(e.length-1)}function Kl(t){const e=t[0].length,n=Array.from({length:e},()=>0);let r=0;for(let s=0;s<t.length;s++){const o=Ki(t[s],t);for(let c=s+1;c<t.length;c++){const u=Ki(t[c],t);for(let l=0;l<e;l++)n[l]+=o*u*eo(t[s][l],t[c][l]);r+=o*u}}return n.map(s=>s/r)}function*Yl(...t){if(t.length===0)return;const e=t.map(r=>r[Symbol.iterator]()),n=e.map(r=>r.next());for(let r=0;;){if(n[r].done){if(e[r]=t[r][Symbol.iterator](),n[r]=e[r].next(),++r>=e.length)return}else yield n.map(({value:i})=>i),r=0;n[r]=e[r].next()}}const Zl=t=>t.reduce((e,n)=>e+n,0)/t.length,Ql=(...t)=>{const e=Math.max(...t.map(n=>n.length));return Array.from(Array(e)).map((n,r)=>t.map(i=>i[r]))};function Jl(t){const e=[],n=[];let r=0;return Array.from(t).forEach((i,s)=>{i==="-"?n.push(-1):(e.push(s),n.push(r),++r)}),{alignedSequence:t,toReference:e,fromReference:n}}function no(t,e){let r=Kl(t);return r.every(i=>Number.isNaN(i))&&(r=Ql(...t.map(i=>Array.from(i))).map(i=>new Set(i).values().map(s=>i.filter(o=>o===s).length).toArray().toSorted((s,o)=>o-s)[0]/i.length)),{consensus:void 0,conservationScores:r,alignments:t.map(i=>Jl(i))}}async function tc(t,e){const n=await Ul.align(t,{type:"amino"});return no(n)}const ro=(t,e,n=0,r=!0)=>{const i=new Set,s=new Set,o=new Set;for(const[c,u]of t){const l=c+n-1;if(l<0||l>=e.length){o.add(c);continue}if(e[l]==="-"){o.add(c);continue}if(e[l]===u)i.add(c);else if(s.add(c),r)break}return{success:i.size>0&&s.size===0,mappedPositions:i,mismatchedPositions:s,unmappedPositions:o}},io=t=>[Math.min(...t.keys()),Math.max(...t.keys())],ec=(t,e)=>{const n=[],[r,i]=io(t);for(let s=(i-1)*-1;s<=e-r;s+=1)n.push(s);return n},nc=(t,e)=>{let n=new Map;for(const r of ec(e,t.length)){const{success:i,mappedPositions:s}=ro(e,t,r,!0);i&&n.set(r,s)}return n.entries().map(([r,i])=>({offset:r,mappedPositions:i})).toArray().toSorted((r,i)=>i.mappedPositions.size-r.mappedPositions.size)};async function so(t,e,n){const{alignments:r,conservationScores:i}=n?no(n):await tc([t,e.replaceAll("-","X")]),s=r[0].toReference,o=r[1].fromReference;return{alignedSequences:r.map(({alignedSequence:c})=>c),alignmentOffsets:s.map(c=>o[c]),scores:i}}const oo=({linkPositionToAminoAcid:t,peptides:e})=>new Map([...Object.entries(t??{}).map(([n,r])=>[Number.parseInt(n),r]),...(e??[]).flatMap(({position:n,sequence:r})=>Array.from(r).map((i,s)=>[n+s,i]))]);async function rc(t,{sequence:e,...n},r){if(e){const{alignmentOffsets:i,scores:s,alignedSequences:o}=await so(e,t.sequence,r?[r[1],r[0]]:void 0),c=new Map(Array.from(Array(e.length)).map((l,h)=>[h+1,i[h]!==-1?t.startPosition+i[h]:void 0])),u=c.values().filter(l=>l!==void 0).toArray().length;return{proteinPosToChainPos:c,alignedSequences:{chain:o[1],protein:o[0]},alignmentScore:Zl(s),hits:u,relativeHits:u/e.length}}else{const i=oo(n),s=nc(t.sequence,i);if(s.length===0)return;const o=new Map(i.keys().map(u=>[u,s[0].mappedPositions.has(u)?t.startPosition+s[0].offset+u-1:void 0])),c=s[0].mappedPositions.size;return{proteinPosToChainPos:o,hits:c,relativeHits:c/i.size}}}function ic(t){const e=t.filter(({alignmentScore:n,hits:r,relativeHits:i})=>{if(n&&n<.2||i<.2)return!1;const s=r/i;return!(r<Math.min(s/10,5))}).toSorted((n,r)=>r.relativeHits!==n.relativeHits?r.relativeHits-n.relativeHits:(r.alignmentScore??0)-(n.alignmentScore??0));return e.length>0?e[0]:void 0}const sc={ala:"A",cys:"C",asp:"D",glu:"E",phe:"F",gly:"G",his:"H",ile:"I",lys:"K",leu:"L",met:"M",asn:"N",pro:"P",gln:"Q",arg:"R",ser:"S",thr:"T",val:"V",trp:"W",tyr:"Y"},oc=(t,e)=>{const n=e.x-t.x,r=e.y-t.y,i=e.z-t.z;return Math.sqrt(n*n+r*r+i*i)};function*fi(t,e,n,r){const i=({proteinId:c,linkPosition:u,aminoAcid:l})=>{const h=[];for(const{id:f,residues:d}of e)for(const[p,x]of Object.entries(n[f])){if(p!==c)continue;const m=x==null?void 0:x.get(u);if(m===void 0||!d[m])continue;const v=sc[d[m].name.toLowerCase()];if(r&&v&&l&&v!==l)continue;const g=d[m].atoms.CA;if(!g){console.warn(`CA is missing in /${f}:${m}`);continue}h.push({chainId:f,position:m,aminoAcid:v,atom:g})}return h},s=i(t.from),o=i(t.to);if(!(s.length===0||o.length===0))for(const[{atom:c,...u},{atom:l,...h}]of Yl(s,o))u.chainId===h.chainId&&(u.position===h.position||t.homoMultimeric)||(yield{from:u,to:h,distance:oc(c,l)})}const ac=`import json
from collections import defaultdict


def list_models():
    data = json.loads('%%data%%')

    for model in session.models:
        if not hasattr(model, 'find_residue'):
            continue

        groups = defaultdict(list)
        for group, chain1, pos1, chain2, pos2 in data:
            res1 = model.find_residue(chain1, pos1)
            if res1 is None:
                break
            atom1 = res1.find_atom('CA')
            if atom1 is None:
                break

            res2 = model.find_residue(chain2, pos2)
            if res2 is None:
                break
            atom2 = res2.find_atom('CA')
            if atom2 is None:
                break

            groups[group].append((atom1, atom2))
        else:
            yield model, groups


for model, groups in list(list_models()):
    pbond_groups = []
    for group_name, atom_pairs in groups.items():
        group = session.pb_manager.get_group(group_name)
        for atom1, atom2 in atom_pairs:
            bond = group.new_pseudobond(atom1, atom2)
            bond.radius = 0.8
            if group_name == '%%under%%':
                bond.color =  [243, 168, 59, 255]
            elif group_name == '%%ok%%':
                bond.color = [55, 125, 34, 255]
            elif group_name == '%%over%%':
                bond.color = [235, 50, 35, 255]
        pbond_groups.append(group)
    session.models.add_group(pbond_groups, name='%%experiment_name%%', parent=model)
`,Gr=(t,{startPosition:e,endPosition:n})=>t!==void 0&&e<=t&&t<=n,ir=(t,e)=>t!==void 0?e==null?void 0:e.find(n=>Gr(t,n)):void 0,sr=(t,e)=>{const n=l=>`${e[l].name}${l}`,r=l=>(l==null?void 0:l.startPosition.toString().padStart(5,"0"))??"XXXXX",i={},s=({from:l,to:h})=>{const f=ir(l.linkPosition,e[l.proteinId].domains),d=ir(h.linkPosition,e[h.proteinId].domains),p=`${n(l.proteinId)}${r(f)}:${n(h.proteinId)}${r(d)}`;return p in i||(i[p]={fromProteinId:l.proteinId,fromProteinName:e[l.proteinId].name,fromDomainName:f==null?void 0:f.name,toProteinId:h.proteinId,toProteinName:e[h.proteinId].name,toDomainName:d==null?void 0:d.name}),p},o={},c=({from:l,to:h})=>{var d,p;const f=`${(((d=l.linkPosition)==null?void 0:d.toString())??"XXXXX").padStart(5,"0")}:${(((p=h.linkPosition)==null?void 0:p.toString())??"XXXXX").padStart(5,"0")}`;return f in o||(o[f]={fromProteinId:l.proteinId,fromPosition:l.linkPosition,fromAminoAcid:l.aminoAcid,toProteinId:h.proteinId,toPosition:h.linkPosition,toAminoAcid:h.aminoAcid}),f},u={};return t.forEach((l,h)=>l.forEach(f=>{const d=s(f),p=c(f);d in u?p in u[d]?h in u[d][p]||(u[d][p][h]=[]):u[d][p]={[h]:[]}:u[d]={[p]:{[h]:[]}},u[d][p][h].push(f)})),Object.entries(u).toSorted(([l,h],[f,d])=>l.localeCompare(f)).map(([l,h])=>({...i[l],rows:Object.entries(h).toSorted(([f],[d])=>f.localeCompare(d)).map(([f,d])=>({...o[f],ids:t.map((p,x)=>{var m;return((m=d[x])==null?void 0:m.toSorted((v,g)=>(g.score??0)-(v.score??0)).map(({id:v})=>v))??[]}),scores:t.map((p,x)=>{var m;return((m=d[x])==null?void 0:m.toSorted((v,g)=>(g.score??0)-(v.score??0)).map(({score:v})=>v))??[]})}))}))},lc=(t,e=!0)=>(Os(t.length===0||t[0].rows[0].ids.length===1),t.flatMap(({rows:n})=>n.flatMap(({ids:r})=>r.flatMap(i=>e?i[0]:i.flat())))),Sn=(t,{lower:e,upper:n})=>{let r;for(const i of t)if(e&&i<e)r="under";else if(n&&i>n)r!=="under"&&(r="over");else{r="ok";break}return r},pi=(t,e,n,r)=>Object.fromEntries(t.flatMap(i=>i.loading?[]:[[i.id,Object.fromEntries(e.filter(({from:s,to:o})=>s.linkPosition!==void 0&&o.linkPosition!==void 0).map(s=>[s.id,Sn(fi(s,i.chains,i.chainIdToProteinIdToMapping,n).map(({distance:o})=>o),r??{})]))]])),cc=async(t="XL Solver",e,n,r)=>{const i=n.map(({category:c,from:u,to:l})=>[(r==null?void 0:r[c])??c,u.chainId,u.position,l.chainId,l.position]),s=document.createElement("a"),o=new Blob([ac.replaceAll("%%experiment_name%%",t).replaceAll("%%data%%",JSON.stringify(i)).replaceAll("%%under%%",(r==null?void 0:r.under)??"under").replaceAll("%%ok%%",(r==null?void 0:r.ok)??"ok").replaceAll("%%over%%",(r==null?void 0:r.over)??"over")],{type:"text/x-python"});s.href=URL.createObjectURL(o),s.download=`${t}-${e}-xlinks.chimerax.py`,s.click()},_r=(t,e)=>{const n=Object.fromEntries(t.map(({proteins:l},h)=>[h,Object.fromEntries(l.map(f=>[f.id,f]))])),r=Object.fromEntries(t.map(({proteins:l},h)=>[h,Object.fromEntries(l.map(f=>[f.id,"peptides"in f?f.peptides:void 0]))])),i=(l,h)=>{var f;return h.peptideIndex!==void 0?(f=r[l][h.proteinId])==null?void 0:f[h.peptideIndex]:void 0},s=[];if(e)for(const{ids:l}of e.flatMap(({rows:h})=>h))s.push(...t.flatMap((h,f)=>l[f].map(d=>[f,h.crosslinks.find(p=>p.id===d)])));else s.push(...t.flatMap((l,h)=>l.crosslinks.map(f=>[h,f])));const o=["Experiment","id","Score","Protein1","AminoAcid1","Position1","PeptideSeq1","PeptidePos1","PositionInPeptide1","Protein2","AminoAcid2","Position2","PeptideSeq2","PeptidePos2","PositionInPeptide2"],c={Experiment:s.map(([l])=>t[l].name),id:s.map(([,{id:l}])=>l),Score:s.map(([,{score:l}])=>l),Protein1:s.map(([l,{from:h}])=>n[l][h.proteinId].name),AminoAcid1:s.map(([,{from:l}])=>l.aminoAcid),Position1:s.map(([,{from:l}])=>l.linkPosition),PeptideSeq1:s.map(([l,{from:h}])=>{var f;return(f=i(l,h))==null?void 0:f.sequence}),PeptidePos1:s.map(([l,{from:h}])=>{var f;return(f=i(l,h))==null?void 0:f.position}),PositionInPeptide1:s.map(([,{from:l}])=>l.linkPositionInPeptide),Protein2:s.map(([l,{to:h}])=>n[l][h.proteinId].name),AminoAcid2:s.map(([,{to:l}])=>l.aminoAcid),Position2:s.map(([,{to:l}])=>l.linkPosition),PeptideSeq2:s.map(([l,{to:h}])=>{var f;return(f=i(l,h))==null?void 0:f.sequence}),PeptidePos2:s.map(([l,{to:h}])=>{var f;return(f=i(l,h))==null?void 0:f.position}),PositionInPeptide2:s.map(([,{to:l}])=>l.linkPositionInPeptide)},u=o.filter(l=>c[l].some(h=>h!==void 0));return{headers:u,rows:s.map((l,h)=>u.map(f=>c[f][h]))}},uc=(t,e,n)=>{const r=_r([{...t,crosslinks:n}]),i=_a(e).toArray();return r.headers.push(...i.map(([s,o])=>s+o)),n.forEach((s,o)=>{for(const[c,u]of i){const l=s.pairs.find(({from:h,to:f})=>h.chainId===c&&f.chainId===u||h.chainId===u&&f.chainId===c);l?r.rows[o].push(l.distance):r.rows[o].push(void 0)}}),r},Sr=(t,e)=>{const n=document.createElement("a"),r=new Blob([t.headers.join(",")+`
`+t.rows.map(i=>i.join(",")).join(`
`)],{type:"text/csv"});n.href=URL.createObjectURL(r),n.download=`${e}.csv`,n.click()},se=t=>{switch(t){case"under":return"orange";case"ok":return"green";case"over":return"red";default:return"rgb(161, 161, 170)"}},hc=(t,e)=>t&&e?`Crosslink distance is between ${t} Å and ${e} Å`:t&&!e?`Crosslink distance is above ${t} Å`:!t&&e?`Crosslink distance is below ${e} Å`:"Crosslink appears in structure",dc=(t,e)=>{const i=[10,void 0,void 0,void 0];t||(i[1]=1),e||(i[3]=1);const s=(100-i.reduce((o,c)=>(o??0)+(c??0),0))/i.filter(o=>o===void 0).length;return i.map(o=>o??s)};let Vt;const fc=it(({thresholds:{lower:t,upper:e}={},experimentId:n,ref:r,...i})=>{const[s,o,c,u]=dc(!!t,!!e),l=10;return a.jsxs(wr,{gap:0,align:"stretch",ref:r,...i,children:[a.jsxs(at,{h:5,children:[a.jsx(Ee,{content:"Crosslink does not appear in structure",openDelay:200,children:a.jsx(Rt,{bg:se(void 0),w:`${s}%`,borderLeftRadius:"md"})}),a.jsx(Ee,{content:`Crosslink distance is below ${t} Å`,openDelay:200,disabled:!t,children:a.jsx(Rt,{bg:se("under"),w:`${o}%`})}),a.jsx(Ee,{content:hc(t,e),openDelay:200,children:a.jsx(Rt,{bg:se("ok"),w:`${c}%`})}),a.jsx(Ee,{content:`Crosslink distance is above ${e} Å`,openDelay:200,disabled:!e,children:a.jsx(Rt,{bg:se("over"),w:`${u}%`,borderRightRadius:"md"})})]}),a.jsxs(at,{children:[a.jsx(Rt,{w:`${s+o-l/2}%`}),a.jsx(Ee,{content:"Lower threshold",children:a.jsx(Di,{value:t,onChange:h=>{if(Vt=vn(Vt),!h){Fn(n,{lower:void 0,upper:e});return}return h<=0?(Vt=wt(Vt,{type:"error",title:"Lower threshold must be positive"}),t):e&&h>=e?(Vt=wt(Vt,{type:"error",title:"Lower threshold must be below the upper threshold"}),t):(Fn(n,{lower:h,upper:e}),h)},w:`${l}%`})}),a.jsx(Rt,{flexGrow:1}),a.jsx(Ee,{content:"Upper threshold",children:a.jsx(Di,{value:e,onChange:h=>{if(Vt=vn(Vt),!h){Fn(n,{lower:t,upper:void 0});return}return h<=0?(Vt=wt(Vt,{type:"error",title:"Upper threshold must be positive"}),t):t&&h<=t?(Vt=wt(Vt,{type:"error",title:"Upper threshold must be above the lower threshold"}),e):(Fn(n,{lower:t,upper:h}),h)},w:`${l}%`})}),a.jsx(Rt,{w:`${u-l/2}%`})]})]})}),Rn=({name:t,onRename:e,center:n=!1,disabled:r=!1,autoResize:i=!1,ref:s,...o})=>{const c=yr({defaultValue:t,disabled:r,autoResize:i,onValueCommit:({value:u})=>{const l=u.trim()===""?void 0:u.trim();l?(e(l),c.setValue(l)):c.setValue(t)}});return a.jsx(Ut.RootProvider,{value:c,ref:s,...o,children:a.jsxs(Ut.Area,{w:i?void 0:"full",children:[a.jsx(Ut.Preview,{width:"full",justifyContent:n?"center":void 0}),a.jsx(Ut.Input,{textAlign:n?"center":void 0,focusRing:"none",borderBottomWidth:"1px",borderBottomColor:"border",borderRadius:0,_focusVisible:{borderColor:"var(--focus-color)",boxShadow:"0px 1px 0px 0px var(--focus-color)"}})]})})},Cn=mt.forwardRef(function(e,n){const{icon:r,children:i,inputProps:s,rootRef:o,...c}=e;return a.jsxs(ln.Root,{ref:o,...c,children:[a.jsx(ln.HiddenInput,{ref:n,...s}),a.jsx(ln.Control,{children:r||a.jsx(ln.Indicator,{})}),i!=null&&a.jsx(ln.Label,{children:i})]})});function pc(t){return on({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},child:[]}]})(t)}const ao=Ct(function(e,n){const{showArrow:r,children:i,portalled:s=!0,content:o,portalRef:c,...u}=e;return a.jsxs(ut.Root,{...u,positioning:{...u.positioning,gutter:4},children:[a.jsx(ut.Trigger,{asChild:!0,children:i}),a.jsx(Ve,{disabled:!s,container:c,children:a.jsx(ut.Positioner,{children:a.jsxs(ut.Content,{width:"auto",px:"2",py:"1",textStyle:"xs",rounded:"sm",ref:n,children:[r&&a.jsx(ut.Arrow,{children:a.jsx(ut.ArrowTip,{})}),o]})})})]})}),mc=Ct(function(e,n){const{children:r,...i}=e;return a.jsx(ao,{content:r,...i,ref:n,children:a.jsx(Be,{variant:"ghost","aria-label":"info",size:"2xs",colorPalette:"gray",ml:1,children:a.jsx(pc,{})})})}),gc=({checked:t,onCheckedChange:e,ref:n,...r})=>{const i=nt(()=>t==="indeterminate"?e==null?void 0:e({checked:!1}):e==null?void 0:e({checked:!t}),[e,t]);return a.jsx(Cn,{checked:t,onCheckedChange:i,ref:n,...r})},ye=it(({name:t,info:e,loading:n=!1,total:r,visible:i,ref:s,...o})=>{const c=i?i===r?!0:"indeterminate":!1,u=n?null:i===r?r:`${i}/${r}`;return a.jsx(gc,{checked:c,disabled:n||!r,ref:s,...o,children:a.jsxs(at,{inline:!0,alignItems:"baseline",gap:2,children:[a.jsxs(jr,{alignItems:"center",gap:0,children:[t!==void 0&&a.jsx(Lt,{fontWeight:"semibold",letterSpacing:"tight",children:t}),e&&a.jsx(mc,{content:e})]}),a.jsxs(Lt,{color:"fg.muted",textStyle:"xs",children:[n&&a.jsx(Ie,{size:"xs"}),!n&&u]})]})})}),xc=({stat:t,stat2:e,toggleVisibility:n,...r})=>a.jsx(ye,{visible:t.visible+((e==null?void 0:e.visible)??0),total:t.total+((e==null?void 0:e.total)??0),onCheckedChange:({checked:i})=>n(i!==!1,t.data,...e?[e.data]:[]),...r}),Yt=it(xc),ue=mt.forwardRef(function(e,n){const{children:r,portalled:i=!0,portalRef:s,backdrop:o=!0,...c}=e;return a.jsxs(Ve,{disabled:!i,container:s,children:[o&&a.jsx(Dt.Backdrop,{}),a.jsx(Dt.Positioner,{children:a.jsx(Dt.Content,{ref:n,...c,asChild:!1,children:r})})]})}),de=mt.forwardRef(function(e,n){return a.jsx(Dt.CloseTrigger,{position:"absolute",top:"2",insetEnd:"2",...e,asChild:!0,children:a.jsx(gr,{size:"sm",ref:n,children:e.children})})}),vc=Dt.Root,fe=Dt.Footer,pe=Dt.Header,me=Dt.Body;Dt.Backdrop;const ge=Dt.Title,Nn=Dt.Description,yc=Dt.Trigger,qr=Dt.ActionTrigger,wc=10,lo=t=>/^[OPQ][0-9][A-Z0-9]{3}[0-9]|[A-NR-Z][0-9]([A-Z][A-Z0-9]{2}[0-9]){1,2}$/.test(t),co=t=>t,jc="https://www.ebi.ac.uk/proteins",bc=jc+"/api",_c=(t,e)=>Zs.get(bc+t,{validateStatus:null,signal:e}),uo=co(async({accession:t},e)=>{var s,o,c,u,l,h,f;if(!lo(t))throw new Error("Invalid UniProt accession number");const{data:n,statusText:r}=await _c(`/proteins/${t}`,e);if(!n.accession||n.errorMessage)throw n.errorMessage?new Error(n.errorMessage):new Error(`Failed to fetch UniProt entry: ${r}`);const i=((s=n.protein.recommendedName)==null?void 0:s.fullName.value)??((o=n.protein.submittedName)==null?void 0:o[0].fullName.value);return{uniprotAccession:n.accession,uniprotEntryName:n.id,name:i,geneName:((l=(u=(c=n.gene)==null?void 0:c[0])==null?void 0:u.name)==null?void 0:l.value)??null,organismName:((h=n.organism.names.find(({type:d})=>d==="scientific"))==null?void 0:h.value)??null,sequence:((f=n.sequence)==null?void 0:f.sequence)??null}}),Sc="_dragover_1s8s7_1",Ye={dragover:Sc},Cc=({mappedPeptides:t,offset:e})=>t.map(({sequence:n,position:r})=>({start:r+e-1,end:r+e-1+n.length})),Tc=(t,e=0)=>{if(t.length===0)return[];const n=t.map(({start:h})=>h).toSorted((h,f)=>h-f),r=t.map(({end:h})=>h).toSorted((h,f)=>h-f),i=n[0],s=r[r.length-1],o=[];let c=0,u=0,l=0;for(let h=Math.min(0,i);h<s;h++){let f=!1;for(;n[u]===h;)c===0&&(f=!0),c++,u++;const d=c;let p=!1;for(;r[l]===h+1;)c--,l++,c===0&&(p=!0);h>=e&&o.push({count:d,isStart:f,isEnd:p})}return o},hn=t=>t!==void 0&&t>0?`green.400/${Math.min(t*40,100)}`:void 0,Ic=({sequence:t,peptidePositions:e,mappedPositions:n})=>{var o,c,u,l,h,f,d,p;const r=[],s=e?Tc(e):n?Array.from(Array(t.length)).map((x,m)=>({count:n.mappedPositions.has(n.offset+m+1)?1:0,isStart:!0,isEnd:!0})):[];for(let x=0;x<t.length;x+=10){const m=Math.min(x+10,t.length),v=s.slice(x,m),g=((o=s[x])==null?void 0:o.isStart)??!1?0:Math.min(((c=s[x-1])==null?void 0:c.count)??((u=s[x])==null?void 0:u.count)??0,((l=s[x])==null?void 0:l.count)??0),y=((h=s[m])==null?void 0:h.isStart)??!1?0:Math.min(((f=s[m-1])==null?void 0:f.count)??0,((d=s[m])==null?void 0:d.count)??0);r.push({sequence:t.slice(x,m),peptides:v,stableNumOfPeptides:v.every(({isStart:b,isEnd:w})=>!b&&!w)&&new Set(v.map(({count:b})=>b)).size===1?((p=v[0])==null?void 0:p.count)??0:void 0,numPeptidesBefore:g,numPeptidesAfter:y})}return a.jsx(at,{gapY:2,wrap:"wrap",children:a.jsx(Ri,{each:r,children:(x,m)=>a.jsxs(at,{children:[a.jsx(Rt,{direction:"column",minW:3,mt:"1.1lh",h:"0.8lh",bg:hn(x.numPeptidesBefore)}),a.jsxs(at,{direction:"column",align:"end",children:[a.jsx(Lt,{color:"fg.muted",children:t.length<10?t.length:m*10+10}),a.jsxs(Lt,{whiteSpace:"pre",children:[x.stableNumOfPeptides?a.jsx(Ce,{bg:hn(x.stableNumOfPeptides),children:x.sequence}):a.jsx(Ri,{each:Array.from(x.sequence),children:(v,g)=>{var y,b,w;return a.jsx(Ce,{bg:hn((y=x.peptides[g])==null?void 0:y.count),borderStartRadius:((b=x.peptides[g])==null?void 0:b.isStart)??!1?"md":void 0,borderEndRadius:((w=x.peptides[g])==null?void 0:w.isEnd)??!1?"md":void 0,children:v},g)}}),10>x.sequence.length&&a.jsx(Ce,{bg:hn(x.numPeptidesAfter),children:" ".repeat(10-x.sequence.length)})]})]}),a.jsx(Rt,{direction:"column",minW:3,mt:"1.1lh",h:"0.8lh",bg:hn(x.numPeptidesAfter)})]},m)})})};let jt;const ho=({defaultValue:t,onChange:e,disabled:n=!1,setIsEditing:r,defaultEdit:i,inputRef:s,mappedPeptides:o,mappedPositions:c,onDropRef:u,ref:l,...h})=>{const f=yr({defaultValue:t,placeholder:"Enter a sequence, UniProt accession, or drop a FASTA file",disabled:n,defaultEdit:i,onValueCommit:({value:v})=>{const g=v.toUpperCase().replaceAll(/\s/g,"");if(lo(g)){jt=wt(jt,{type:"loading",title:`Fetching ${g} from UniProt...`}),uo({accession:g}).then(({uniprotEntryName:b,sequence:w})=>{w?(Se.success({id:jt,title:`Loaded ${g} from UniProt`,description:b}),f.setValue(w),e(w)):(Se.error({id:jt,title:`Entry ${g} has no sequence`,description:b}),f.clearValue(),e())}).catch(b=>{Se.error({id:jt,title:"Failed to fetch sequence from UniProt",description:b.message}),f.clearValue(),e()});return}const y=g.replaceAll(/[^GAVLITSMCPFYWHKRDENQ]/g,"");y!==g&&(jt=wt(jt,{type:"warning",title:"Invalid characters removed from the sequence",description:"Please ensure the sequence contains only valid amino acid codes."})),f.setValue(y),e(y!==""?y:void 0)},onEditChange:({edit:v})=>r==null?void 0:r(v)}),d=W(()=>o?Cc(o):void 0,[o]),p=nt(v=>{if(v.size===0){jt=wt(jt,{type:"error",title:`${v.name} is empty`});return}v.text().then(g=>{if(!Hs(g)){jt=wt(jt,{type:"error",title:`${v.name} is not a valid FASTA file`});return}const y=Ws(g),b=y.next().value;if(b){const w=b.sequence.toUpperCase().replaceAll(/[^GAVLITSMCPFYWHKRDENQ]/g,"").trim(),I=w!==b.sequence.toUpperCase().trim(),E=!!y.next().value;jt=wt(jt,{type:I||E?"warning":"success",title:`Loaded the sequence of ${b.id} from ${v.name}`,description:[I?"Invalid characters were removed from the sequence.":"",E?"Note that only the first sequence is loaded.":""].join(" ")}),f.cancel(),f.setValue(w),e(w)}else{jt=wt(jt,{type:"error",title:`Couldn't parse ${v.name} as FASTA`}),f.edit(),f.setValue(g);return}}).catch(g=>{jt=wt(jt,{type:"error",title:`Couldn't read ${v.name}`,description:g.message})})},[f,e]);Gt(()=>(u&&"current"in u&&(u.current=p),()=>{u&&"current"in u&&(u.current=null)}),[u,p]);const x=nt(v=>{var y;if(!((y=v.dataTransfer)!=null&&y.items)||v.dataTransfer.items.length===0)return;const g=v.dataTransfer.items[0];if(g.kind==="file"){const b=g.getAsFile();b&&p(b)}},[p]);let m=0;return a.jsxs(dl,{value:f,fontFamily:"mono",onDragEnter:v=>{v.stopPropagation(),++m===1&&v.currentTarget.classList.add(Ye.dragover)},onDragLeave:v=>{v.stopPropagation(),--m===0&&v.currentTarget.classList.remove(Ye.dragover)},onDragOver:v=>{v.preventDefault(),v.stopPropagation()},onDrop:v=>{v.preventDefault(),v.stopPropagation(),v.currentTarget.classList.remove(Ye.dragover),m=0,x(v)},border:"2px solid transparent",ref:l,...h,children:[a.jsxs(fl,{w:"full",_hover:{bg:"unset"},_placeholderShown:{color:"fg.muted",fontFamily:"body"},children:[f.empty&&f.valueText,!f.empty&&a.jsx(Ic,{sequence:f.value,peptidePositions:d,mappedPositions:c})]}),a.jsx(pl,{ref:s,_placeholderShown:{color:"fg.muted",fontFamily:"body"},overflowY:"hidden",onFocus:v=>{v.currentTarget.style.height="auto",v.currentTarget.style.height=`${v.currentTarget.scrollHeight}px`},onInput:v=>{v.currentTarget.style.height="auto",v.currentTarget.style.height=`${v.currentTarget.scrollHeight}px`},onKeyDown:v=>v.key==="Enter"&&f.submit()})]})},st=Ct(function(e,n){const{loading:r,disabled:i,loadingText:s,children:o,...c}=e;return a.jsx(En,{disabled:r||i,ref:n,...c,children:r&&!s?a.jsxs(a.Fragment,{children:[a.jsx(hi,{display:"inline-flex",children:a.jsx(Ie,{size:"inherit",color:"inherit"})}),a.jsx(Ce,{opacity:0,children:o})]}):r&&s?a.jsxs(a.Fragment,{children:[a.jsx(Ie,{size:"inherit",color:"inherit",writingMode:"initial"}),s]}):o})}),kc=it(({protein:{id:t,name:e,linkPositionToAminoAcid:n,peptides:r,sequence:i},experimentId:s,isEditing:o,setIsEditing:c,onDropRef:u,closeDialog:l})=>{const[h,f]=lt(i),d=ot(null),{proteinPositionToAminoAcid:p,lastAminoAcidPosition:x}=W(()=>{const y=oo({linkPositionToAminoAcid:n,peptides:r}),[b,w]=io(y);return{proteinPositionToAminoAcid:y,lastAminoAcidPosition:w}},[n,r]),m=W(()=>h?ro(p,h,0,!1):void 0,[h,p]),v=m&&m.success&&m.mappedPositions.size>0&&m.mismatchedPositions.size===0&&m.unmappedPositions.size===0,g=W(()=>h&&m&&r?r.filter(({position:y,sequence:b})=>y-1+b.length-1>=0&&y-1<h.length).filter(({position:y,sequence:b})=>Array.from(Array(b.length)).map((w,I)=>y+I).every(w=>m.mappedPositions.has(w))):void 0,[h,m,r]);return li("keydown",y=>{y.key==="Enter"&&y.target!==d.current&&(!h||v)&&(y.preventDefault(),h!==i&&bn(s,t,{sequence:h}),l())}),a.jsxs(a.Fragment,{children:[a.jsxs(pe,{flexDir:"column",children:[a.jsxs(ge,{children:[e," Sequence"]}),a.jsx(Nn,{children:"Sequences in strcutures are aligned to the provided protein sequences to determine crosslink positions."}),a.jsx(de,{})]}),a.jsxs(me,{children:[a.jsx(ho,{defaultValue:i,inputRef:d,onChange:f,setIsEditing:c,defaultEdit:!i,mappedPeptides:g?{mappedPeptides:g,offset:0}:void 0,mappedPositions:m?{mappedPositions:m.mappedPositions,offset:0}:void 0,onDropRef:u}),h&&!o&&a.jsxs(Bt.Root,{status:v?"success":"error",mt:5,children:[a.jsx(Bt.Indicator,{}),a.jsx(Bt.Content,{children:a.jsx(Bt.Description,{children:v?r?`${r.length>1?"All":"The"} ${Mt(r.length,"peptide")} of ${e} ${r.length===1?"was":"were"} mapped succesfully to the sequence.`:`${p.size>1?"All":"The"} ${Mt(p.size,"cross-linking position")} in ${e} ${p.size===1?"was":"were"} mapped succesfully to the sequence.`:h.length<x?`The sequence should be at least ${Mt(x,"amino acid")} long (the last ${r?"peptide of":"cross-linking position in"} ${e} ${r?"ends at":"is"} ${p.get(x)}${x}).`:((m==null?void 0:m.mismatchedPositions.size)??0)>0?r?`Some peptides of ${e} don't match the sequence.`:`Some positions of ${e} don't match the sequence.`:`The sequence doesn't match the positions of ${e}.`})})]})]}),a.jsxs(fe,{children:[(o||i===h)&&a.jsx(st,{variant:"surface",onClick:l,children:"Close"}),i!==h&&!o&&a.jsxs(a.Fragment,{children:[a.jsx(st,{variant:"surface",onClick:l,children:"Cancel"}),a.jsx(st,{colorPalette:"green",onClick:()=>{bn(s,t,{sequence:h}),l()},disabled:!!h&&!v,children:"Save sequence"})]})]})]})}),Ac=Ct(function(e,n){const{children:r,clearable:i,hideIndicator:s,triggerProps:o,...c}=e;return a.jsxs(_t.Control,{...c,children:[a.jsx(_t.Trigger,{...o,ref:n,children:r}),a.jsxs(_t.IndicatorGroup,{children:[i&&a.jsx(Pc,{}),!s&&a.jsx(_t.Indicator,{})]})]})}),Pc=Ct(function(e,n){return a.jsx(_t.ClearTrigger,{asChild:!0,...e,ref:n,children:a.jsx(gr,{size:"xs",variant:"plain",focusVisibleRing:"inside",focusRingWidth:"2px",pointerEvents:"auto"})})}),fo=Ct(function(e,n){const{portalled:r=!0,portalRef:i,...s}=e;return a.jsx(Ve,{disabled:!r,container:i,children:a.jsx(_t.Positioner,{children:a.jsx(_t.Content,{...s,ref:n})})})}),Kr=Ct(function(e,n){const{item:r,children:i,...s}=e;return a.jsxs(_t.Item,{item:r,...s,ref:n,children:[i,a.jsx(_t.ItemIndicator,{})]},r.value)}),Mc=Ct(function(e,n){const{children:r,...i}=e;return a.jsx(_t.ValueText,{...i,ref:n,children:a.jsx(_t.Context,{children:s=>{const o=s.selectedItems;return o.length===0?e.placeholder:r?r(o):o.length===1?s.collection.stringifyItem(o[0]):`${o.length} selected`}})})});Ct(function(e,n){return a.jsx(_t.Root,{...e,ref:n,positioning:{sameWidth:!0,...e.positioning},children:e.asChild?e.children:a.jsxs(a.Fragment,{children:[a.jsx(_t.HiddenSelect,{}),e.children]})})});Ct(function(e,n){const{children:r,label:i,...s}=e;return a.jsxs(_t.ItemGroup,{...s,ref:n,children:[a.jsx(_t.ItemGroupLabel,{children:i}),r]})});const Ec=_t.Label;_t.ItemText;const $c=t=>W(()=>nl(t),[]);function mi(t){const e=$c({}),n=St(t||e);return t?n:void 0}const Yi=t=>{const e=Us();return D.referenceProteinsById[e]={id:e,...t},e},zc=t=>{const e=Object.entries(D.proteinIdToReferenceProtein).filter(([n,{id:r}])=>r===t).map(([n])=>n);for(const n of e)D.proteinIdToReferenceProtein.delete(n);D.referenceProteinsById=Object.fromEntries(Object.entries(D.referenceProteinsById).filter(([,{id:n}])=>n!==t))},or=(t,e)=>Xs(D.referenceProteinsById[t],e),Zi=async(t,e,n)=>{if(!e){D.proteinIdToReferenceProtein.delete(t.id);return}if(!t.sequence)throw new Error;const r=D.referenceProteinsById[e],{alignmentOffsets:i}=await so(t.sequence,r.sequence,n),s=Object.fromEntries(i.map((o,c)=>[c+1,o!==-1?o+1:void 0]));return s[1]===1&&(s[0]=0),D.proteinIdToReferenceProtein.set(t.id,{id:r.id,xlPosToRefPos:s}),i},po=({proteinIdToReferenceProtein:t,referenceProteinsById:e},n)=>n.map(r=>{var s;const i=(s=t.get(r.id))==null?void 0:s.id;if(i){const o=e[i];if(o)return{isReferenceProtein:!0,...o}}return{isReferenceProtein:!1,...r}}),Rc=t=>po(D,t),Nc=(t,e,n)=>{const r=i=>{const s=i.peptideIndex!==void 0,o=e.get(i.proteinId);if(!o)return{...i,hasPeptide:s};const c=n[o.id];if(!c)throw new Error("Reference protein not found");const u=o.xlPosToRefPos[i.linkPosition];return{proteinId:o.id,linkPosition:u,aminoAcid:u?c.sequence[u-1]:void 0,hasPeptide:s}};return t.map(i=>{const[s,o]=[r(i.from),r(i.to)].toSorted((c,u)=>c.proteinId===u.proteinId?0:c.proteinId>u.proteinId?1:-1);return{...i,from:s,to:o}})},mo=(...t)=>{const e=mi(t.length>0?D:void 0);return W(()=>e?t.map(({proteins:n,crosslinks:r,...i})=>({proteins:po(e,n),crosslinks:Nc(r,e.proteinIdToReferenceProtein,e.referenceProteinsById),...i})):[],[t,e])},Oc=t=>{const e=W(()=>t?[t]:[],[t]);return mo(...e)[0]},gi=()=>{const{referenceProteinsById:t}=St(D);return W(()=>Array.from(Object.values(t)).toSorted((e,n)=>e.name.localeCompare(n.name)),[t])},go=t=>{const{proteinIdToReferenceProtein:e,referenceProteinsById:n}=St(D),r=e.get(t.id);return r?{resolvedProtein:{isReferenceProtein:!0,...n[r.id]},xlPosToRefPos:r.xlPosToRefPos}:{resolvedProtein:{isReferenceProtein:!1,...t},xlPosToRefPos:void 0}},Lc=({closeDialog:t,onAddedReferenceProtein:e})=>{const n=ot(null),r=ot(null),[i,s]=lt(""),[o,c]=lt(""),u=i.length>0&&o.length>0;return li("keydown",l=>{var h,f;if(l.key==="Enter"){if(l.target===n.current&&i.length>0){l.preventDefault(),(f=(h=r.current)==null?void 0:h.previousElementSibling)==null||f.focus();return}if(l.target!==r.current&&u){l.preventDefault();const d=Yi({name:i,sequence:o});e==null||e(d),t()}}}),a.jsxs(a.Fragment,{children:[a.jsx(de,{}),a.jsx(pe,{children:a.jsx(ge,{children:"Add a reference protein to the project"})}),a.jsx(me,{asChild:!0,children:a.jsx(Te.Root,{children:a.jsxs(Te.Content,{children:[a.jsx(wn,{label:"Name",children:a.jsx(Ne,{type:"text",ref:n,value:i,onChange:l=>s(l.target.value),autoFocus:!0})}),a.jsx(wn,{label:"Sequence",children:a.jsx(ho,{inputRef:r,onChange:l=>c(l??"")})})]})})}),a.jsxs(fe,{children:[a.jsx(st,{variant:"surface",onClick:t,children:"Close"}),a.jsx(st,{colorPalette:"green",disabled:!u,onClick:()=>{const l=Yi({name:i,sequence:o});e==null||e(l),t()},children:"Add protein"})]})]})},xo=({dialogRef:t,onAddedReferenceProtein:e})=>{const n=ce({restoreFocus:!1});return Gt(()=>(t&&(t.current=n),()=>{t&&(t.current=null)}),[t,n]),a.jsx(ke,{value:n,placement:"top",size:"xl",lazyMount:!0,unmountOnExit:!0,children:a.jsx(ue,{children:a.jsx(Lc,{closeDialog:()=>n.setOpen(!1),onAddedReferenceProtein:e})})})},Yr=it(({active:t,children:e,ref:n,...r})=>a.jsx(di,{fontSize:"xs",variant:"underline",color:t?void 0:"fg.muted/50",textDecorationLine:"none",_hover:{color:"unset",textDecorationLine:"underline"},ref:n,...r,children:e})),Dc=it(({protein:t,experimentId:e,onDropRef:n,ref:r,...i})=>{const[s,o]=lt(!1),c=ce({closeOnInteractOutside:!s,closeOnEscape:!s,trapFocus:!1,restoreFocus:!1}),u=ot(null);Gt(()=>(n&&"current"in n&&(n.current=x=>{c.setOpen(!0),setTimeout(()=>{var m;return(m=u.current)==null?void 0:m.call(u,x)},0)}),()=>{n&&"current"in n&&(n.current=null)}),[n,c]);const l=ot(null),h=gi(),f=W(()=>Gs({items:[...h.map(({id:x,name:m})=>({value:x,label:m})),{value:"new",label:"Add..."}]}),[h]),{resolvedProtein:d}=go(t),p=qs({collection:f,defaultValue:d.isReferenceProtein?[d.id]:void 0,deselectable:!0,onValueChange:async({value:x})=>{var m;if(x[0]==="new"){(m=l.current)==null||m.setOpen(!0),p.clearValue();return}if(x.length===0){await Zi(t,void 0);return}await Zi(t,x[0])},positioning:{gutter:5,shift:20}});return a.jsxs(a.Fragment,{children:[a.jsx(ke,{value:c,size:"xl",placement:"top",lazyMount:!0,unmountOnExit:!0,children:a.jsx(ue,{h:"fit",children:a.jsx(kc,{protein:t,experimentId:e,isEditing:s,setIsEditing:o,onDropRef:u,closeDialog:()=>{o(!1),c.setOpen(!1)}})})}),a.jsx(xo,{dialogRef:l,onAddedReferenceProtein:x=>{p.setValue([x])}}),a.jsxs(jr,{ref:r,...i,children:[a.jsx(Yr,{active:!!t.sequence,onClick:()=>c.setOpen(!0),py:2,children:"Sequence"}),t.sequence&&a.jsxs(Ks,{value:p,size:"xs",pt:"2px",children:[a.jsx(ml,{width:"full",children:a.jsx(gl,{as:"span",asChild:!0,border:"none",pl:0,children:a.jsxs(Yr,{active:!p.empty,w:"full",children:[a.jsx(Sa,{}),a.jsx(xl,{placeholder:"Reference"})]})})}),a.jsx(fo,{mt:-1,children:p.collection.items.map(x=>a.jsxs(Ja,{children:[x.value==="new"&&p.collection.items.length>1&&a.jsx(Oe,{},"before-new"),a.jsx(Kr,{item:x,children:x.label})]},x.value))})]})]})]})}),Fc="_dragover_1ksss_1",Er={dragover:Fc},Vc=({domain:{name:t,startPosition:e,endPosition:n},stats:{interdomain:r,intradomain:i},toggleVisibility:s,deleteDomain:o})=>a.jsxs($n,{children:[a.jsxs(at,{justifyContent:"space-between",children:[a.jsx(Yt,{size:"sm",name:t,stat:r,stat2:i,toggleVisibility:s}),a.jsxs(Lt,{fontSize:"xs",color:"fg.muted",children:["from ",e," to ",n,a.jsx(Be,{size:"2xs",variant:"ghost",_hover:{colorPalette:"red"},verticalAlign:"center",ml:2,onClick:()=>o(e),children:a.jsx(Ls,{})})]})]}),a.jsx(Yt,{name:"Inter-domain",ms:6,size:"sm",info:"Crosslinks that occur between two different domains",stat:r,toggleVisibility:s}),a.jsx(Yt,{name:"Intra-domain",ms:6,size:"sm",info:"Crosslinks that occur within the same domain",stat:i,toggleVisibility:s})]}),Qi=({domains:t,proteinLength:e,addDomain:n})=>{const[r,i]=lt(""),[s,o]=lt(""),[c,u]=lt(""),l=r.length>0?r.trim():void 0,h=(()=>{if(l!==void 0)return l.length===0?"Domain name can't be empty":(t==null?void 0:t.some(x=>x.name===l))??!1?"Domain name already exist":!1})(),f=(()=>{if(s.length===0)return;if(!/^[0-9]+$/.test(s.trim()))return"Invalid position";const x=Number.parseInt(s);if(!Number.isSafeInteger(x)||x<=0)return"Invalid position";if(e!==void 0&&x>e)return`Must be smaller than the protein's length (${e})`;const m=ir(x,t);return m?`The position is in an existing domain (${m.name})`:x})(),d=(()=>{if(typeof f!="number"||c.length===0)return;if(!/^[0-9]+$/.test(c.trim()))return"Invalid position";const x=Number.parseInt(c);if(!Number.isSafeInteger(x))return"Invalid position";if(e!==void 0&&x>e)return`Must be smaller than the protein's length (${e})`;if(x<f)return"Must be larger than the start position";const m=ir(x,t);return m?`The position is in an existing domain (${m.name})`:x})(),p=(()=>{if(typeof f!="number"||typeof d!="number")return;const x=(t==null?void 0:t.filter(m=>m.startPosition<=d&&m.endPosition>=f))??[];return x.length>0?x.length===1?`Overlapping with an existing domain (${x[0].name})`:`Overlapping with ${Mt(x.length,"domain")}: ${At(x.map(({name:m})=>m))}`:!1})();return a.jsx(De,{asChild:!0,children:a.jsxs("form",{onSubmit:x=>{x.preventDefault(),h===!1&&p===!1&&n(l,f,d)},children:[a.jsxs(cn.Root,{invalid:!!h,children:[a.jsx(vl,{fontSize:"xs",children:"Domain name"}),a.jsx(Ne,{size:"xs",onChange:x=>i(x.target.value)}),a.jsx(Ge,{children:h})]}),a.jsxs(cn.Root,{invalid:!!p,children:[a.jsx(cn.Label,{fontSize:"xs",children:"Position"}),a.jsxs(jr,{align:"start",children:[a.jsxs(cn.Root,{invalid:!!p||typeof f=="string",children:[a.jsx(Ne,{size:"xs",placeholder:"Start",inputMode:"numeric",onChange:x=>o(x.target.value)}),typeof f=="string"&&a.jsx(Ge,{children:f})]}),a.jsxs(cn.Root,{invalid:!!p||typeof d=="string",children:[a.jsx(Ne,{size:"xs",placeholder:"End",inputMode:"numeric",onChange:x=>u(x.target.value)}),typeof d=="string"&&a.jsx(Ge,{children:d})]})]}),a.jsx(Ge,{children:p})]}),a.jsx(En,{size:"xs",type:"submit",disabled:h!==!1||p!==!1,children:"Add"})]})})},Ji=Ct(function(e,n){const{portalled:r=!0,portalRef:i,...s}=e;return a.jsx(Ve,{disabled:!r,container:i,children:a.jsx(ut.Positioner,{children:a.jsx(ut.Content,{ref:n,...s})})})}),ts=Ct(function(e,n){return a.jsx(ut.Arrow,{...e,ref:n,children:a.jsx(ut.ArrowTip,{})})});Ct(function(e,n){return a.jsx(ut.CloseTrigger,{position:"absolute",top:"1",insetEnd:"1",...e,asChild:!0,ref:n,children:a.jsx(gr,{size:"sm"})})});ut.Title;ut.Description;ut.Footer;ut.Header;ut.Root;ut.Body;ut.Trigger;const vo=({protein:t,experimentId:e,domainNameToStats:n,toggleVisibility:r,ref:i,...s})=>{var h,f;const o=Ni({}),c=Ni({portalled:!1,positioning:{placement:"right"}}),u=nt(d=>{var x;const p=(x=t.domains)==null?void 0:x.filter(m=>m.startPosition!==d);t.isReferenceProtein?or(t.id,{domains:p}):e&&bn(e,t.id,{domains:p})},[t.domains,t.isReferenceProtein,t.id,e]),l=nt((d,p,x)=>{const m=[...t.domains??[],{name:d,startPosition:p,endPosition:x}].toSorted((v,g)=>v.startPosition-g.startPosition);t.isReferenceProtein?or(t.id,{domains:m}):e&&bn(e,t.id,{domains:m}),c.setOpen(!1)},[t.domains,t.isReferenceProtein,t.id,e,c]);return a.jsxs(ut.RootProvider,{value:o,size:"sm",unmountOnExit:!0,lazyMount:!0,children:[a.jsx(ut.Trigger,{asChild:!0,children:a.jsx(Yr,{active:o.open||Ke(t.domains),ref:i,...s,children:Ke(t.domains)?Mt(t.domains.length,"domain"):"Domains"})}),a.jsxs(Ji,{maxH:"unset",children:[a.jsx(ts,{}),a.jsx(ut.Body,{children:a.jsx(De,{gapY:5,children:Ke(t.domains)?a.jsxs(a.Fragment,{children:[t.domains.map(d=>a.jsx(Vc,{domain:d,stats:n[d.name],toggleVisibility:r,deleteDomain:u},d.startPosition)),a.jsxs(ut.RootProvider,{value:c,size:"xs",lazyMount:!0,unmountOnExit:!0,children:[a.jsx(ut.Trigger,{asChild:!0,children:a.jsxs(st,{size:"2xs",children:[a.jsx(en,{}),"Add domain"]})}),a.jsxs(Ji,{portalled:!1,children:[a.jsx(ts,{}),a.jsx(ut.Body,{children:a.jsx(Qi,{domains:t.domains,proteinLength:(h=t.sequence)==null?void 0:h.length,addDomain:l})})]})]})]}):a.jsx(Qi,{domains:t.domains,proteinLength:(f=t.sequence)==null?void 0:f.length,addDomain:l})})})]})]})},Bc=({protein:t,stats:e,domainNameToStats:n,toggleVisibility:r,experimentId:i,hideMultiProteinToggles:s,ref:o,...c})=>{const u=e.interprotein.visible+e.intraprotein.visible>0,{resolvedProtein:l}=go(t),h=ot(null);let f=0;return a.jsxs(be.Root,{borderColor:u?"colorPalette.solid":void 0,onDragEnter:d=>{d.stopPropagation(),++f===1&&d.currentTarget.classList.add(Er.dragover)},onDragLeave:d=>{d.stopPropagation(),--f===0&&d.currentTarget.classList.remove(Er.dragover)},onDragOver:d=>{d.stopPropagation(),d.preventDefault()},onDrop:d=>{var x,m;d.stopPropagation(),d.preventDefault(),d.currentTarget.classList.remove(Er.dragover),f=0;const p=(x=d.dataTransfer.items[0])==null?void 0:x.getAsFile();p&&((m=h==null?void 0:h.current)==null||m.call(h,p))},ref:o,...c,children:[a.jsxs(be.Header,{children:[a.jsxs(at,{flexDir:"row",alignItems:"center",children:[a.jsx(Rn,{name:t.name,onRename:d=>bn(i,t.id,{name:d}),size:"lg",fontWeight:"semibold"}),a.jsx(Yt,{stat:e.interprotein,stat2:e.intraprotein,toggleVisibility:r,dir:"rtl"})]}),a.jsx(Dc,{protein:t,experimentId:i,onDropRef:h}),a.jsx(vo,{protein:l,domainNameToStats:n,toggleVisibility:r,experimentId:i,w:"fit-content",mt:-2})]}),a.jsx(be.Body,{p:s&&e.homomultimeric.total===0?0:void 0,children:a.jsxs($n,{children:[!s&&a.jsxs(a.Fragment,{children:[a.jsx(Yt,{name:"Inter-protein",info:"Crosslinks that occur between two different proteins",stat:e.interprotein,toggleVisibility:r}),a.jsx(Yt,{name:"Intra-protein",info:"Crosslinks that occur within the same protein",stat:e.intraprotein,toggleVisibility:r})]}),e.homomultimeric.total>0&&a.jsx(Yt,{ms:s?void 0:6,name:"Homo-multimeric",info:"Crosslinks that occur between overlapping peptides",stat:e.homomultimeric,toggleVisibility:r})]})}),a.jsx(be.Footer,{})]})},Hc=it(Bc),xi=(t,e)=>{const n=D.experimentIdToGroupedStructureIds[t];n.flat(2).every(r=>!e.includes(r))||(D.experimentIdToGroupedStructureIds[t]=xr(n.map(r=>r.filter(i=>!e.includes(i)))))},Wc=(t,e)=>{D.experimentIdToGroupedStructureIds[t]=xr([...D.experimentIdToGroupedStructureIds[t],e])},Zr=(t,e)=>{const n=D.experimentIdToGroupedStructureIds[t];D.experimentIdToGroupedStructureIds[t]=xr([e,...n])},ar=(t,e,n)=>{const r=new Set(D.experimentIdToVisibleCrosslinkIds[t]),i=e?r.union(n):r.difference(n);D.experimentIdToVisibleCrosslinkIds[t]=i},Xc=t=>{const e=D.experiments.find(({id:r})=>r===t);if(!e)return;const n=new Set(e==null?void 0:e.crosslinks.map(({id:r})=>r));D.experimentIdToVisibleCrosslinkIds[t]=n},Uc=it(({experiment:{id:t,proteins:e},resolvedExperiment:{proteins:n,crosslinks:r},ref:i,...s})=>{const o=W(()=>{const f=d=>({total:d.length,data:new Set(d)});return Object.fromEntries(e.map(({id:d,interProteinCrosslinks:p,intraProteinCrosslinks:x,homoMultimericCrosslinks:m},v)=>{var g;return[d,{stats:{interprotein:f(p),intraprotein:f(x),homomultimeric:f(m)},domainNameToStats:Object.fromEntries(((g=n[v].domains)==null?void 0:g.map(y=>{const b=n[v].id,w=[],I=[];for(const{id:E,from:_,to:S}of r){const A=_.proteinId===b&&Gr(_.linkPosition,y),k=S.proteinId===b&&Gr(S.linkPosition,y);!A&&!k||(A===k?I.push(E):w.push(E))}return[y.name,{interdomain:f(w),intradomain:f(I)}]}))??[])}]}))},[e,r,n]),{experimentIdToVisibleCrosslinkIds:c}=St(D),u=c[t],l=W(()=>{const f=x=>x.intersection(u).size,d=x=>Jn(Object.entries(x).map(([m,{data:v,...g}])=>[m,{visible:f(v),data:v,...g}])),p={};for(const[x,{stats:m,domainNameToStats:v}]of Object.entries(o))p[x]={stats:d(m),domainNameToStats:Jn(Object.entries(v).map(([g,y])=>[g,d(y)]))};return p},[o,u]),h=nt((f,...d)=>ar(t,f,d.length===1?d[0]:new Set(d.flatMap(p=>Array.from(p)))),[t]);return a.jsx(Rt,{position:"relative",ref:i,...s,children:a.jsx(at,{gapY:5,gapX:10,wrap:"wrap",children:e.map(f=>a.jsx(Hc,{experimentId:t,protein:f,stats:l[f.id].stats,domainNameToStats:l[f.id].domainNameToStats,toggleVisibility:h,hideMultiProteinToggles:e.length===1,w:"30%",overflow:"clip",size:"sm"},f.id))})})}),Gc=it(({experimentId:t,structureToXlinkIdToStatus:e,allCrosslinkIds:n,visibleCrosslinkIds:r,unmappedCrosslinkIds:i,numOfDistanceConstraints:s,ref:o,...c})=>{const u=W(()=>{if(e==="loading")return e;if(Object.keys(e).length===0)return null;const d={};for(const p of Object.values(e))for(const[x,m]of Object.entries(p))x in d||(d[x]=new Set),m!==void 0&&d[x].add(m);return{missing:Object.entries(d).filter(([p,x])=>x.size===0).map(([p])=>p),appear:Object.entries(d).filter(([p,x])=>x.size>0).map(([p])=>p),withoutConflicts:Object.entries(d).filter(([p,x])=>!x.has("under")&&!x.has("over")).map(([p])=>p),withConflicts:Object.entries(d).filter(([p,x])=>x.has("under")||x.has("over")).map(([p])=>p)}},[e]),l=nt(d=>d?{loading:!1,visible:d.filter(p=>r.has(p)).length,total:d.length,onCheckedChange:({checked:p})=>ar(t,p!==!1,new Set(d))}:{loading:!0,visible:void 0,total:void 0},[r,t]),h=W(()=>{if(!(!i||i.size===0))return a.jsx(ye,{ms:6,name:"Not mapped to reference protein",info:"Crosslinks that one or both of their residues are not mapped to the reference protein",...l(Array.from(i))})},[i,l]),f=W(()=>{if(u===null)return;const d=u!=="loading"?p=>u[p]:()=>{};return s>0?a.jsxs(a.Fragment,{children:[a.jsx(ye,{ms:6,name:"Without any conflict",info:`Crosslinks that don't violate the distance constraint${s!==1?"s":""} in any of the structures`,...l(d("withoutConflicts"))}),a.jsx(ye,{ms:12,name:"Missing in all structures",info:"Crosslinks that don't appear in any of the structures",...l(d("missing"))}),a.jsx(ye,{ms:6,name:"With some conflicts",info:`Crosslinks that violate the distance constraint${s!==1?"s":""} in some of the structures`,...l(d("withConflicts"))})]}):a.jsxs(a.Fragment,{children:[a.jsx(ye,{ms:6,name:"Missing in all structures",info:"Crosslinks that don't appear in any of the structures",...l(d("missing"))}),a.jsx(ye,{ms:6,name:"Appear in all structures",info:"Crosslinks that appear in all of the structures",...l(d("appear"))})]})},[u,l,s]);return a.jsxs($n,{ref:o,...c,children:[a.jsx(ye,{name:"All crosslinks",visible:r.size,total:n.size,onCheckedChange:({checked:d})=>ar(t,d!==!1,n)}),h,f]})});function qc(t){return new Worker("/xlsolver/assets/load-structures-worker-D6WuWvKA.js",{name:t==null?void 0:t.name})}const Kc=async(t,e,n,r)=>{const i=D.structures.find(({id:u})=>u===t);if(!i||i.loading)throw new Error("Structure not available for mapping");const s=i.chains.find(({id:u})=>u===e);if(!s)throw new Error("Chain not found in structure");const o=await rc(s,n,r);if(!o){let u=`Chain ${e} couldn't be mapped to `;throw n.sequence?u+=`the provided sequence of ${n.name}.`:u+=`${n.name}. Try adding a sequence to ${n.name} to overcome mismatches.`,new Error(u)}let c=(()=>{let u=`${Mt(o.hits,"position")} matched (${Math.round(o.relativeHits*100)}% of ${n.name}'s positions)`;return o.alignmentScore&&(u+=`, alignment score is ${Math.round(o.alignmentScore*100)}%`),u+"."})();return ic([o])!==o&&(c="Note that this mapping might be wrong: "+c),i.chainIdToProteinIdToMapping[e][n.id]=o.proteinPosToChainPos,{message:c,mapping:o}},Yc=(t,{chains:e,chainIdToProteinIdToMapping:n})=>{var i;const r=D.structures.findIndex(s=>s.id===t);if(r===-1||!D.structures[r].loading){Ca(`Loaded structure ${t} doesn't exist, or wasn't in loading state when loading finished (loading = ${(i=D.structures[r])==null?void 0:i.loading})`);return}D.structures[r]={...D.structures[r],chains:il(e),chainIdToProteinIdToMapping:n,loading:!1}},yo=new qc;yo.onmessage=({data:t})=>{const{id:e}=t;if("error"in t){Se.error({title:"Failed to load structure",description:t.error.message}),jo([e]);return}Yc(e,t)};const es=t=>{const e=t.map(({name:s,...o})=>({name:s,id:Us(),...o}));for(const{id:s,name:o}of e)D.structures.push({id:s,name:o,loading:!0});const n=Object.keys(D.experimentIdToGroupedStructureIds);for(const s of n)D.experimentIdToGroupedStructureIds[s]=xr([...D.experimentIdToGroupedStructureIds[s],e.map(({id:o})=>o)]);const r=new Set,i=[];for(const s of[...Rc(D.experiments.flatMap(({proteins:o})=>o)),...Object.values(D.referenceProteinsById)])r.has(s.id)||(i.push(rl(s)),r.add(s.id));yo.postMessage({action:"load-structures",structures:e,proteins:i})},wo=(t,e)=>{const n=D.structures.find(r=>r.id===t);n&&Xs(n,e)},Zc=(t,e,n)=>{const r=D.structures.find(i=>i.id===t);r&&(r.loading||r.chainIdToProteinIdToMapping[e][n]!==void 0&&(r.chainIdToProteinIdToMapping[e]=Object.fromEntries(Object.entries(r.chainIdToProteinIdToMapping[e]).filter(([i])=>i!==n))))},jo=t=>{D.structures=D.structures.filter(({id:e})=>!t.includes(e));for(const{id:e}of D.experiments)xi(e,t)},Qc=({id:t})=>{const{experimentIdToGroupedStructureIds:e}=St(D),n=e[t],r=n.some(s=>s.length>0),i=mi(r?D.structures:void 0);return W(()=>{if(!i)return[[],n];const s=n.flat(2);return[i.filter(({id:c})=>s.includes(c)),n]},[i,n])},oe=({startElement:t,endElement:e,onClose:n,closable:r=!!n,children:i,ref:s,...o})=>a.jsxs(We.Root,{ref:s,...o,children:[t&&a.jsx(We.StartElement,{children:t}),a.jsx(We.Label,{children:i}),e&&a.jsx(We.EndElement,{children:e}),r&&a.jsx(We.EndElement,{children:a.jsx(We.CloseTrigger,{onClick:n})})]});function Cr(t){return on({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M221.69,199.77,160,96.92V40h8a8,8,0,0,0,0-16H88a8,8,0,0,0,0,16h8V96.92L34.31,199.77A16,16,0,0,0,48,224H208a16,16,0,0,0,13.72-24.23Zm-90.08-42.91c-15.91-8.05-31.05-12.32-45.22-12.81l24.47-40.8A7.93,7.93,0,0,0,112,99.14V40h32V99.14a7.93,7.93,0,0,0,1.14,4.11L183.36,167C171.4,169.34,154.29,168.34,131.61,156.86Z"},child:[]}]})(t)}function Jc(t){return on({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M195.51,62.66,212.44,44A6,6,0,1,0,203.56,36L186.63,54.58A94,94,0,0,0,60.49,193.34L43.56,212A6,6,0,0,0,52.44,220l16.93-18.62A94,94,0,0,0,195.51,62.66ZM46,128A81.93,81.93,0,0,1,178.53,63.49L68.59,184.43A81.69,81.69,0,0,1,46,128Zm82,82a81.57,81.57,0,0,1-50.53-17.49L187.41,71.57A81.94,81.94,0,0,1,128,210Z"},child:[]}]})(t)}function bo(t){return on({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,112v96a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V112A16,16,0,0,1,56,96H80a8,8,0,0,1,0,16H56v96H200V112H176a8,8,0,0,1,0-16h24A16,16,0,0,1,216,112ZM93.66,69.66,120,43.31V136a8,8,0,0,0,16,0V43.31l26.34,26.35a8,8,0,0,0,11.32-11.32l-40-40a8,8,0,0,0-11.32,0l-40,40A8,8,0,0,0,93.66,69.66Z"},child:[]}]})(t)}const ns=(t,e)=>t===void 0?a.jsx(Jc,{}):t===0?"N'":`${e}${t}`,rs=({hoverKey:t,...e})=>a.jsx(oe,{className:`xlp${jn(t)}`,...e}),is=({proteinId:t,proteinName:e,domainName:n})=>a.jsxs(a.Fragment,{children:[a.jsx(rs,{hoverKey:t,...n?{borderRightRadius:0}:{},children:e}),n&&a.jsx(rs,{hoverKey:t+n,borderLeftRadius:0,children:n})]}),_o=it(({rowHeader:t,groupHeader:e,field:n,checked:r,groupedChecked:i,toggle:s,toggleGroup:o,ref:c,...u})=>{const l=t.ids.flat().length>1;return a.jsxs(at,{minW:"fit-content",justify:"space-between",align:"baseline",wrap:"nowrap",whiteSpace:"nowrap",ref:c,...u,children:[e&&a.jsxs("span",{style:{flexShrink:0,display:"flex",fontWeight:"bolder"},children:[i!==void 0&&a.jsx(Cn,{size:"xs",mx:2,checked:i,inputProps:{onClick:({shiftKey:h})=>o==null?void 0:o(i!==!0,e,h)},disabled:!o,visibility:o?void 0:"hidden"}),a.jsx(is,{proteinId:e.fromProteinId,proteinName:e.fromProteinName,domainName:e.fromDomainName}),"-",a.jsx(is,{proteinId:e.toProteinId,proteinName:e.toProteinName,domainName:e.toDomainName})]}),a.jsx("div",{style:{minWidth:"10px",flexGrow:1}}),a.jsxs(at,{flexShrink:0,mr:n?void 0:3,children:[a.jsx(Cn,{size:"xs",mx:2,checked:r,inputProps:{onClick:({shiftKey:h})=>s==null?void 0:s(r!==!0,t,h)},disabled:!s,visibility:s?void 0:"hidden"}),a.jsx(oe,{opacity:t.fromPosition===void 0?.5:void 0,children:ns(t.fromPosition,t.fromAminoAcid)}),"-",a.jsx(oe,{opacity:t.toPosition===void 0?.5:void 0,children:ns(t.toPosition,t.toAminoAcid)})]}),n&&a.jsx(Lt,{ml:5,mr:3,fontFamily:"mono",fontSize:"2xs",minW:"8",textAlign:"right",children:t[n].length===1&&`${t[n][0][0]}${l?"..":""}`})]})});var $r={exports:{}},It={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ss;function tu(){if(ss)return It;ss=1;var t=Za;function e(u){var l="https://react.dev/errors/"+u;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)l+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+u+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(u,l,h){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:f==null?null:""+f,children:u,containerInfo:l,implementation:h}}var o=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(u,l){if(u==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return It.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,It.createPortal=function(u,l){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(e(299));return s(u,l,null,h)},It.flushSync=function(u){var l=o.T,h=r.p;try{if(o.T=null,r.p=2,u)return u()}finally{o.T=l,r.p=h,r.d.f()}},It.preconnect=function(u,l){typeof u=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,r.d.C(u,l))},It.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},It.preinit=function(u,l){if(typeof u=="string"&&l&&typeof l.as=="string"){var h=l.as,f=c(h,l.crossOrigin),d=typeof l.integrity=="string"?l.integrity:void 0,p=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;h==="style"?r.d.S(u,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:f,integrity:d,fetchPriority:p}):h==="script"&&r.d.X(u,{crossOrigin:f,integrity:d,fetchPriority:p,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},It.preinitModule=function(u,l){if(typeof u=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var h=c(l.as,l.crossOrigin);r.d.M(u,{crossOrigin:h,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&r.d.M(u)},It.preload=function(u,l){if(typeof u=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var h=l.as,f=c(h,l.crossOrigin);r.d.L(u,h,{crossOrigin:f,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},It.preloadModule=function(u,l){if(typeof u=="string")if(l){var h=c(l.as,l.crossOrigin);r.d.m(u,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:h,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else r.d.m(u)},It.requestFormReset=function(u){r.d.r(u)},It.unstable_batchedUpdates=function(u,l){return u(l)},It.useFormState=function(u,l,h){return o.H.useFormState(u,l,h)},It.useFormStatus=function(){return o.H.useHostTransitionStatus()},It.version="19.0.0",It}var os;function eu(){if(os)return $r.exports;os=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),$r.exports=tu(),$r.exports}var nu=eu();function Ue(t,e,n){let r=n.initialDeps??[],i;function s(){var o,c,u,l;let h;n.key&&((o=n.debug)!=null&&o.call(n))&&(h=Date.now());const f=t();if(!(f.length!==r.length||f.some((x,m)=>r[m]!==x)))return i;r=f;let p;if(n.key&&((c=n.debug)!=null&&c.call(n))&&(p=Date.now()),i=e(...f),n.key&&((u=n.debug)!=null&&u.call(n))){const x=Math.round((Date.now()-h)*100)/100,m=Math.round((Date.now()-p)*100)/100,v=m/16,g=(y,b)=>{for(y=String(y);y.length<b;)y=" "+y;return y};console.info(`%c⏱ ${g(m,5)} /${g(x,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*v,120))}deg 100% 31%);`,n==null?void 0:n.key)}return(l=n==null?void 0:n.onChange)==null||l.call(n,i),i}return s.updateDeps=o=>{r=o},s}function zr(t,e){if(t===void 0)throw new Error("Unexpected undefined");return t}const ru=(t,e)=>Math.abs(t-e)<1,So=(t,e,n)=>{let r;return function(...i){t.clearTimeout(r),r=t.setTimeout(()=>e.apply(this,i),n)}},iu=t=>t,vi=t=>{const e=Math.max(t.startIndex-t.overscan,0),n=Math.min(t.endIndex+t.overscan,t.count-1),r=[];for(let i=e;i<=n;i++)r.push(i);return r},su=(t,e)=>{const n=t.scrollElement;if(!n)return;const r=t.targetWindow;if(!r)return;const i=o=>{const{width:c,height:u}=o;e({width:Math.round(c),height:Math.round(u)})};if(i(n.getBoundingClientRect()),!r.ResizeObserver)return()=>{};const s=new r.ResizeObserver(o=>{const c=()=>{const u=o[0];if(u!=null&&u.borderBoxSize){const l=u.borderBoxSize[0];if(l){i({width:l.inlineSize,height:l.blockSize});return}}i(n.getBoundingClientRect())};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(c):c()});return s.observe(n,{box:"border-box"}),()=>{s.unobserve(n)}},Tn={passive:!0},ou=(t,e)=>{const n=t.scrollElement;if(!n)return;const r=()=>{e({width:n.innerWidth,height:n.innerHeight})};return r(),n.addEventListener("resize",r,Tn),()=>{n.removeEventListener("resize",r)}},lr=typeof window>"u"?!0:"onscrollend"in window,au=(t,e)=>{const n=t.scrollElement;if(!n)return;const r=t.targetWindow;if(!r)return;let i=0;const s=t.options.useScrollendEvent&&lr?()=>{}:So(r,()=>{e(i,!1)},t.options.isScrollingResetDelay),o=h=>()=>{const{horizontal:f,isRtl:d}=t.options;i=f?n.scrollLeft*(d&&-1||1):n.scrollTop,s(),e(i,h)},c=o(!0),u=o(!1);u(),n.addEventListener("scroll",c,Tn);const l=t.options.useScrollendEvent&&lr;return l&&n.addEventListener("scrollend",u,Tn),()=>{n.removeEventListener("scroll",c),l&&n.removeEventListener("scrollend",u)}},lu=(t,e)=>{const n=t.scrollElement;if(!n)return;const r=t.targetWindow;if(!r)return;let i=0;const s=t.options.useScrollendEvent&&lr?()=>{}:So(r,()=>{e(i,!1)},t.options.isScrollingResetDelay),o=h=>()=>{i=n[t.options.horizontal?"scrollX":"scrollY"],s(),e(i,h)},c=o(!0),u=o(!1);u(),n.addEventListener("scroll",c,Tn);const l=t.options.useScrollendEvent&&lr;return l&&n.addEventListener("scrollend",u,Tn),()=>{n.removeEventListener("scroll",c),l&&n.removeEventListener("scrollend",u)}},cu=(t,e,n)=>{if(e!=null&&e.borderBoxSize){const r=e.borderBoxSize[0];if(r)return Math.round(r[n.options.horizontal?"inlineSize":"blockSize"])}return Math.round(t.getBoundingClientRect()[n.options.horizontal?"width":"height"])},uu=(t,{adjustments:e=0,behavior:n},r)=>{var i,s;const o=t+e;(s=(i=r.scrollElement)==null?void 0:i.scrollTo)==null||s.call(i,{[r.options.horizontal?"left":"top"]:o,behavior:n})},hu=(t,{adjustments:e=0,behavior:n},r)=>{var i,s;const o=t+e;(s=(i=r.scrollElement)==null?void 0:i.scrollTo)==null||s.call(i,{[r.options.horizontal?"left":"top"]:o,behavior:n})};class du{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let n=null;const r=()=>n||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:n=new this.targetWindow.ResizeObserver(i=>{i.forEach(s=>{const o=()=>{this._measureElement(s.target,s)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()})}));return{disconnect:()=>{var i;(i=r())==null||i.disconnect(),n=null},observe:i=>{var s;return(s=r())==null?void 0:s.observe(i,{box:"border-box"})},unobserve:i=>{var s;return(s=r())==null?void 0:s.unobserve(i)}}})(),this.range=null,this.setOptions=n=>{Object.entries(n).forEach(([r,i])=>{typeof i>"u"&&delete n[r]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:iu,rangeExtractor:vi,onChange:()=>{},measureElement:cu,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...n}},this.notify=n=>{var r,i;(i=(r=this.options).onChange)==null||i.call(r,this,n)},this.maybeNotify=Ue(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),n=>{this.notify(n)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(n=>n()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var n;const r=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==r){if(this.cleanup(),!r){this.maybeNotify();return}this.scrollElement=r,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((n=this.scrollElement)==null?void 0:n.window)??null,this.elementsCache.forEach(i=>{this.observer.observe(i)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,i=>{this.scrollRect=i,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(i,s)=>{this.scrollAdjustments=0,this.scrollDirection=s?this.getScrollOffset()<i?"forward":"backward":null,this.scrollOffset=i,this.isScrolling=s,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(n,r)=>{const i=new Map,s=new Map;for(let o=r-1;o>=0;o--){const c=n[o];if(i.has(c.lane))continue;const u=s.get(c.lane);if(u==null||c.end>u.end?s.set(c.lane,c):c.end<u.end&&i.set(c.lane,!0),i.size===this.options.lanes)break}return s.size===this.options.lanes?Array.from(s.values()).sort((o,c)=>o.end===c.end?o.index-c.index:o.end-c.end)[0]:void 0},this.getMeasurementOptions=Ue(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(n,r,i,s,o)=>(this.pendingMeasuredCacheIndexes=[],{count:n,paddingStart:r,scrollMargin:i,getItemKey:s,enabled:o}),{key:!1}),this.getMeasurements=Ue(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:n,paddingStart:r,scrollMargin:i,getItemKey:s,enabled:o},c)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(h=>{this.itemSizeCache.set(h.key,h.size)}));const u=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const l=this.measurementsCache.slice(0,u);for(let h=u;h<n;h++){const f=s(h),d=this.options.lanes===1?l[h-1]:this.getFurthestMeasurement(l,h),p=d?d.end+this.options.gap:r+i,x=c.get(f),m=typeof x=="number"?x:this.options.estimateSize(h),v=p+m,g=d?d.lane:h%this.options.lanes;l[h]={index:h,start:p,size:m,end:v,key:f,lane:g}}return this.measurementsCache=l,l},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Ue(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(n,r,i,s)=>this.range=n.length>0&&r>0?fu({measurements:n,outerSize:r,scrollOffset:i,lanes:s}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Ue(()=>{let n=null,r=null;const i=this.calculateRange();return i&&(n=i.startIndex,r=i.endIndex),this.maybeNotify.updateDeps([this.isScrolling,n,r]),[this.options.rangeExtractor,this.options.overscan,this.options.count,n,r]},(n,r,i,s,o)=>s===null||o===null?[]:n({startIndex:s,endIndex:o,overscan:r,count:i}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=n=>{const r=this.options.indexAttribute,i=n.getAttribute(r);return i?parseInt(i,10):(console.warn(`Missing attribute name '${r}={index}' on measured element.`),-1)},this._measureElement=(n,r)=>{const i=this.indexFromElement(n),s=this.measurementsCache[i];if(!s)return;const o=s.key,c=this.elementsCache.get(o);c!==n&&(c&&this.observer.unobserve(c),this.observer.observe(n),this.elementsCache.set(o,n)),n.isConnected&&this.resizeItem(i,this.options.measureElement(n,r,this))},this.resizeItem=(n,r)=>{const i=this.measurementsCache[n];if(!i)return;const s=this.itemSizeCache.get(i.key)??i.size,o=r-s;o!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(i,o,this):i.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=o,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(i.index),this.itemSizeCache=new Map(this.itemSizeCache.set(i.key,r)),this.notify(!1))},this.measureElement=n=>{if(!n){this.elementsCache.forEach((r,i)=>{r.isConnected||(this.observer.unobserve(r),this.elementsCache.delete(i))});return}this._measureElement(n,void 0)},this.getVirtualItems=Ue(()=>[this.getVirtualIndexes(),this.getMeasurements()],(n,r)=>{const i=[];for(let s=0,o=n.length;s<o;s++){const c=n[s],u=r[c];i.push(u)}return i},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=n=>{const r=this.getMeasurements();if(r.length!==0)return zr(r[Co(0,r.length-1,i=>zr(r[i]).start,n)])},this.getOffsetForAlignment=(n,r,i=0)=>{const s=this.getSize(),o=this.getScrollOffset();r==="auto"&&(r=n>=o+s?"end":"start"),r==="center"?n+=(i-s)/2:r==="end"&&(n-=s);const c=this.options.horizontal?"scrollWidth":"scrollHeight",l=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[c]:this.scrollElement[c]:0)-s;return Math.max(Math.min(l,n),0)},this.getOffsetForIndex=(n,r="auto")=>{n=Math.max(0,Math.min(n,this.options.count-1));const i=this.measurementsCache[n];if(!i)return;const s=this.getSize(),o=this.getScrollOffset();if(r==="auto")if(i.end>=o+s-this.options.scrollPaddingEnd)r="end";else if(i.start<=o+this.options.scrollPaddingStart)r="start";else return[o,r];const c=r==="end"?i.end+this.options.scrollPaddingEnd:i.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(c,r,i.size),r]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(n,{align:r="start",behavior:i}={})=>{this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(n,r),{adjustments:void 0,behavior:i})},this.scrollToIndex=(n,{align:r="auto",behavior:i}={})=>{n=Math.max(0,Math.min(n,this.options.count-1)),this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const s=this.getOffsetForIndex(n,r);if(!s)return;const[o,c]=s;this._scrollToOffset(o,{adjustments:void 0,behavior:i}),i!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(n))){const[l]=zr(this.getOffsetForIndex(n,c));ru(l,this.getScrollOffset())||this.scrollToIndex(n,{align:c,behavior:i})}else this.scrollToIndex(n,{align:c,behavior:i})}))},this.scrollBy=(n,{behavior:r}={})=>{this.cancelScrollToIndex(),r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+n,{adjustments:void 0,behavior:r})},this.getTotalSize=()=>{var n;const r=this.getMeasurements();let i;if(r.length===0)i=this.options.paddingStart;else if(this.options.lanes===1)i=((n=r[r.length-1])==null?void 0:n.end)??0;else{const s=Array(this.options.lanes).fill(null);let o=r.length-1;for(;o>0&&s.some(c=>c===null);){const c=r[o];s[c.lane]===null&&(s[c.lane]=c.end),o--}i=Math.max(...s.filter(c=>c!==null))}return Math.max(i-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(n,{adjustments:r,behavior:i})=>{this.options.scrollToFn(n,{behavior:i,adjustments:r},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(e)}}const Co=(t,e,n,r)=>{for(;t<=e;){const i=(t+e)/2|0,s=n(i);if(s<r)t=i+1;else if(s>r)e=i-1;else return i}return t>0?t-1:0};function fu({measurements:t,outerSize:e,scrollOffset:n,lanes:r}){const i=t.length-1,s=u=>t[u].start;if(t.length<=r)return{startIndex:0,endIndex:i};let o=Co(0,i,s,n),c=o;if(r===1)for(;c<i&&t[c].end<n+e;)c++;else if(r>1){const u=Array(r).fill(0);for(;c<i&&u.some(h=>h<n+e);){const h=t[c];u[h.lane]=h.end,c++}const l=Array(r).fill(n+e);for(;o>0&&l.some(h=>h>=n);){const h=t[o];l[h.lane]=h.start,o--}o=Math.max(0,o-o%r),c=Math.min(i,c+(r-1-c%r))}return{startIndex:o,endIndex:c}}const as=typeof document<"u"?mt.useLayoutEffect:mt.useEffect;function To(t){const e=mt.useReducer(()=>({}),{})[1],n={...t,onChange:(i,s)=>{var o;s?nu.flushSync(e):e(),(o=t.onChange)==null||o.call(t,i,s)}},[r]=mt.useState(()=>new du(n));return r.setOptions(n),as(()=>r._didMount(),[]),as(()=>r._willUpdate()),r}function Io(t){return To({observeElementRect:su,observeElementOffset:au,scrollToFn:hu,...t})}function ko(t){return To({getScrollElement:()=>typeof document<"u"?window:null,observeElementRect:ou,observeElementOffset:lu,scrollToFn:uu,initialOffset:()=>typeof document<"u"?window.scrollY:0,...t})}const Ao=Ct(function(e,n){const{children:r,portalled:i=!0,portalRef:s,...o}=e;return a.jsx(Ve,{disabled:!i,container:s,children:a.jsx(nn.Positioner,{children:a.jsx(nn.Content,{ref:n,...o,asChild:!1,children:r})})})}),Po=Ct(function(e,n){return a.jsx(nn.CloseTrigger,{...e,asChild:!0,ref:n,children:a.jsx(gr,{size:"sm"})})}),Mo=nn.Root,Eo=nn.SelectionTrigger,cr=nn.Separator;function pu(t){return on({attr:{viewBox:"0 0 32 32"},child:[{tag:"path",attr:{d:"M 5 5 L 5 9 L 6 9 L 6 23 L 5 23 L 5 27 L 9 27 L 9 26 L 23 26 L 23 27 L 27 27 L 27 23 L 26 23 L 26 9 L 27 9 L 27 5 L 23 5 L 23 6 L 9 6 L 9 5 Z M 9 8 L 23 8 L 23 9 L 24 9 L 24 23 L 23 23 L 23 24 L 9 24 L 9 23 L 8 23 L 8 9 L 9 9 Z M 10 10 L 10 18 L 14 18 L 14 22 L 22 22 L 22 14 L 18 14 L 18 10 Z M 12 12 L 16 12 L 16 16 L 12 16 Z M 18 16 L 20 16 L 20 20 L 16 20 L 16 18 L 18 18 Z"},child:[]}]})(t)}const mu=it(({experimentId:t,structure:{id:e,name:n,loading:r},checked:i,onCheck:s,onClick:o,ref:c,...u})=>a.jsxs(at,{flexDir:"column",h:"100%",justifyContent:"space-between",alignItems:"center",gap:3,ref:c,...u,children:[a.jsx(Cn,{size:"xs",inputProps:{onClick:({shiftKey:l})=>s==null?void 0:s(t,e,l)},disabled:!s,visibility:s?void 0:"hidden",checked:i}),a.jsx(st,{variant:"ghost",size:"2xs",writingMode:"vertical-lr",minH:"fit",loading:r,flexGrow:1,justifyContent:"end",loadingText:Hr(n,12),onClick:o,children:Hr(n,15)})]})),Ze=mt.forwardRef(function(e,n){const{portalled:r=!0,portalRef:i,...s}=e;return a.jsx(Ve,{disabled:!r,container:i,children:a.jsx(xt.Positioner,{children:a.jsx(xt.Content,{ref:n,...s})})})});mt.forwardRef(function(e,n){return a.jsx(xt.Arrow,{ref:n,...e,children:a.jsx(xt.ArrowTip,{})})});const ls=mt.forwardRef(function(e,n){return a.jsxs(xt.CheckboxItem,{ps:"8",ref:n,...e,children:[a.jsx(hi,{axis:"horizontal",insetStart:"4",asChild:!0,children:a.jsx(xt.ItemIndicator,{children:a.jsx(ci,{})})}),e.children]})}),Rr=mt.forwardRef(function(e,n){const{children:r,...i}=e;return a.jsxs(xt.RadioItem,{ps:"8",ref:n,...i,children:[a.jsx(hi,{axis:"horizontal",insetStart:"4",asChild:!0,children:a.jsx(xt.ItemIndicator,{children:a.jsx(ci,{})})}),a.jsx(xt.ItemText,{children:r})]})});mt.forwardRef(function(e,n){const{title:r,children:i,...s}=e;return a.jsxs(xt.ItemGroup,{ref:n,...s,children:[r&&a.jsx(xt.ItemGroupLabel,{userSelect:"none",children:r}),i]})});const cs=mt.forwardRef(function(e,n){const{startIcon:r,children:i,...s}=e;return a.jsxs(xt.TriggerItem,{ref:n,...s,children:[r,i,a.jsx(Ta,{})]})}),gu=xt.RadioItemGroup,xu=xt.ContextTrigger,Qe=xt.Root,qn=xt.Separator,ae=xt.Item;xt.ItemText;xt.ItemCommand;const yn=xt.Trigger,$o=it(({field:t,onFieldClick:e,viewName:n,experiments:r,groupedCrosslinkIds:i,disableMenus:s,exportFigureDialog:o,showingStructures:c,ref:u,...l})=>{const h=mi(c?D:void 0),f=h?Math.min(...r.map(({id:v})=>h.experimentIdToGroupedStructureIds[v].flat().length)):void 0,d=f&&f>2?Math.min(3,f-1):void 0,p=h?r.some(({id:v})=>h.experimentIdToGroupedStructureIds[v].filter(g=>g.length>0).length>1):!1,x=nt(()=>{d&&Ia(async()=>{const{kmeans:v}=await import("https://esm.sh/ml-kmeans@^6.0.0");return{kmeans:v}},[]).then(({kmeans:v})=>{r.forEach((g,y)=>{const b=D.experimentIdToGroupedStructureIds[g.id].flat(),w=pi(D.structures.filter(({id:E})=>b.includes(E)),g.crosslinks,D.aminoAcidsMustMatch,D.experimentIdToThresholds[g.id]),{clusters:I}=v(b.map(E=>i.flatMap(({rows:_})=>_.flatMap(S=>S.ids[y])).map(_=>{switch(w[E][_]){case"over":return 10;case"ok":return 0;case"under":return-10;default:return-500}})),d,{});for(let E=0;E<d;E++)Zr(g.id,b.filter((_,S)=>I[S]===E))})})},[d,r,i]),m=nt(()=>r.forEach(({id:v})=>Zr(v,D.experimentIdToGroupedStructureIds[v].flat())),[r]);return a.jsxs(at,{h:"100%",flexDirection:"column",justify:"space-between",ref:u,...l,children:[a.jsxs(at,{my:3,gap:2,children:[a.jsxs(Qe,{size:"sm",positioning:{gutter:2},onSelect:({value:v})=>v==="figure"?o==null?void 0:o.setOpen(!0):v==="table"?Sr(_r(r,i),`${n}-xlinks`):null,children:[a.jsx(yn,{asChild:!0,children:a.jsxs(st,{size:"2xs",variant:"outline",disabled:s,children:[a.jsx(bo,{}),"Export"]})}),a.jsxs(Ze,{children:[a.jsxs(ae,{value:"figure",disabled:!o,children:[a.jsx(ka,{}),"Figure..."]}),a.jsxs(ae,{value:"table",children:[a.jsx(Ds,{}),"Crosslink Table"]})]})]}),c&&a.jsxs(Qe,{size:"sm",positioning:{gutter:2},onSelect:({value:v})=>v==="kmeans"?x():v==="ungroup"?m():null,children:[a.jsx(yn,{asChild:!0,children:a.jsxs(st,{size:"2xs",variant:"outline",disabled:s,children:[a.jsx(Aa,{}),"Structures"]})}),a.jsxs(Ze,{children:[a.jsxs(ae,{value:"kmeans",disabled:!d,children:[a.jsx(Pa,{}),a.jsx(Lt,{fontStyle:"italic",marginRight:-1,children:"k"}),"-means",d?` (${Mt(d,"cluster")})`:null]}),a.jsx(qn,{}),a.jsxs(ae,{value:"ungroup",disabled:!p,children:[a.jsx(Ma,{}),"Ungroup"]})]})]})]}),a.jsxs(at,{minW:"fit-content",justify:"space-between",align:"baseline",wrap:"nowrap",whiteSpace:"nowrap",py:3,opacity:0,_hover:{opacity:1},transition:"opacity 0.2s",mr:t?void 0:3,children:[a.jsxs("span",{style:{flexShrink:0,display:"flex",fontWeight:"bolder"},children:[a.jsx(oe,{children:"From"}),"-",a.jsx(oe,{children:"To"})]}),a.jsx("div",{style:{minWidth:"10px",flexGrow:1}}),a.jsxs("span",{style:{flexShrink:0,display:"flex"},children:[a.jsx(oe,{children:"From"}),"-",a.jsx(oe,{children:"To"})]}),t&&(e?a.jsx(st,{size:"2xs",fontSize:"2xs",ml:2,mr:3,minW:"12",px:1,fontFamily:"mono",onClick:e,children:t}):a.jsx(Lt,{ml:5,mr:3,fontFamily:"mono",fontSize:"2xs",minW:"7",textAlign:"right",children:t}))]})]})}),vu="_weak_1r16j_1",us={weak:vu},zo=mt.forwardRef(function(e,n){return a.jsx(Ae.Indicator,{copied:a.jsx(ci,{}),...e,ref:n,children:a.jsx(Ea,{})})}),yi=mt.forwardRef(function(e,n){return a.jsx(Ae.Indicator,{copied:"Copied",...e,ref:n,children:"Copy"})});mt.forwardRef(function(e,n){return a.jsx(Ae.Label,{textStyle:"sm",fontWeight:"medium",display:"inline-block",mb:"1",...e,ref:n})});mt.forwardRef(function(e,n){return a.jsx(Ae.Trigger,{asChild:!0,children:a.jsxs(En,{ref:n,size:"sm",variant:"surface",...e,children:[a.jsx(zo,{}),a.jsx(yi,{})]})})});mt.forwardRef(function(e,n){return a.jsx(Ae.Trigger,{asChild:!0,children:a.jsxs(En,{unstyled:!0,variant:"plain",size:"xs",display:"inline-flex",alignItems:"center",gap:"2",ref:n,...e,children:[a.jsx($a,{}),a.jsx(yi,{})]})})});const yu=mt.forwardRef(function(e,n){return a.jsx(Ae.Trigger,{asChild:!0,children:a.jsxs(Be,{ref:n,size:"xs",variant:"subtle",...e,children:[a.jsx(zo,{}),a.jsx(yi,{srOnly:!0})]})})});mt.forwardRef(function(e,n){return a.jsx(Ae.Input,{asChild:!0,children:a.jsx(Ne,{ref:n,...e})})});const wu=Ae.Root,hs=({aminoAcid:t},{aminoAcid:e})=>t&&e&&t!==e&&a.jsx(ao,{showArrow:!0,content:`The cross-linked residue (${t}) is different from the aligned residue in the structure (${e})`,children:a.jsx(Be,{verticalAlign:"middle",ml:"0.2rem",mb:"0.1rem",size:"2xs",height:"unset",minW:"unset",variant:"ghost",children:a.jsx(za,{style:{height:"unset",width:"unset"}})})}),ju=it(({experiment:t,crosslinkIds:e,structure:n,ref:r,...i})=>{const{experimentIdToThresholds:s,aminoAcidsMustMatch:o}=St(D),c=s[t.id],u=t.crosslinks.filter(({id:m})=>e.includes(m));if(u.length===0)return null;const l=t.proteins.find(({id:m})=>m==u[0].from.proteinId),h=t.proteins.find(({id:m})=>m==u[0].to.proteinId);if(!l||!h)return null;let f=null;const d=u.filter(({homoMultimeric:m})=>m);if(d.length>0){const m=d.map(({id:y})=>y),v=d.some(({from:y,to:b})=>[y,b].some(({hasPeptide:w})=>w)),g=u.length-m.length;f=a.jsx(Bt.Root,{status:"neutral",children:a.jsx(Bt.Content,{overflow:"clip",children:a.jsxs(Bt.Description,{children:[u.length===1?"This crosslink":u.length===m.length?"These crosslinks":`${m.length} of the crosslinks (id${m.length>1?"s":""}: ${At(m)})`," ",m.length===1?"is":"are"," classified as"," ",a.jsx("b",{children:"homo-multimeric"})," because"," ",m.length===1?"it occurs":"they occur"," between"," ",v?"overlapping peptides":"the same residue","."," ",g>0?`However, because ${g} of the crosslinks ${g===1?"is":"are"} not classified as homo-multimeric, distances within the same chain are not excluded.`:"Therefore, distances within the same chain are excluded."]})})})}const p=u[0].from.linkPosition&&u[0].to.linkPosition?fi(u[0],n.chains,n.chainIdToProteinIdToMapping,o).toArray().toSorted((m,v)=>m.distance-v.distance):[],x=u.flatMap(({score:m})=>m!==void 0?[m]:[]);return a.jsxs(ue,{ref:r,...i,children:[a.jsxs(pe,{flexDir:"column",children:[a.jsxs(ge,{children:[a.jsx("span",{className:us.weak,children:l.name})," ",u[0].from.aminoAcid??"",u[0].from.linkPosition??"(unmapped residue)",a.jsxs("span",{className:us.weak,children:[" - ",l.id!==h.id&&`${h.name} `]}),u[0].to.aminoAcid??"",u[0].to.linkPosition??"(unmapped residue)"]}),a.jsx(Nn,{asChild:!0,children:a.jsxs(bt.Root,{size:"sm",orientation:"horizontal",wordBreak:"break-word",children:[a.jsxs(bt.Item,{children:[a.jsx(bt.ItemLabel,{children:"File"}),a.jsx(bt.ItemValue,{children:t.name})]}),a.jsxs(bt.Item,{children:[a.jsx(bt.ItemLabel,{children:"Structure"}),a.jsx(bt.ItemValue,{children:n.name})]}),a.jsxs(bt.Item,{children:[a.jsxs(bt.ItemLabel,{children:["Crosslink ID",u.length>1?"s":""]}),a.jsx(bt.ItemValue,{children:At(u.map(({id:m})=>m))})]}),x.length>0&&a.jsxs(bt.Item,{children:[a.jsxs(bt.ItemLabel,{children:["Crosslink score",u.length>1?"s":""]}),a.jsx(bt.ItemValue,{children:At(u.map(({score:m})=>m!==void 0?m.toString():"(no score)"))})]})]})}),a.jsx(de,{})]}),a.jsx(me,{children:a.jsxs(wr,{gap:5,align:"stretch",children:[f,a.jsxs("div",{children:[p.length===0&&"The crosslink was not found in this structure.",p.length>0&&`Found ${p.length===1?"a single pair":`${p.length} pairs`} of residues that match this crosslink in the structure:`,a.jsx("ul",{style:{marginTop:"10px"},children:p.map((m,v)=>a.jsxs("li",{style:{marginBottom:"5px"},children:[a.jsxs(oe,{verticalAlign:"baseline",children:["/",m.from.chainId,":",m.from.aminoAcid??"",m.from.position,hs(u[0].from,m.from)]}),"-",a.jsxs(oe,{verticalAlign:"baseline",children:["/",m.to.chainId,":",m.to.aminoAcid??"",m.to.position,hs(u[0].to,m.to)]})," - ",a.jsxs("span",{style:{color:se(Sn([m.distance],c??{}))},children:[Math.round((m.distance+Number.EPSILON)*100)/100," ","Å"]}),a.jsx(Ee,{content:"Copy as ChimeraX command",ids:{trigger:String(v)},positioning:{placement:"right"},showArrow:!0,children:a.jsx(wu,{value:`distance /${m.from.chainId}:${m.from.position}@ca /${m.to.chainId}:${m.to.position}@ca color ${se(Sn([m.distance],c??{}))}`,asChild:!0,ids:{root:String(v)},ml:5,verticalAlign:"middle",children:a.jsx(yu,{size:"2xs",variant:"plain"})})})]},v))})]})]})}),a.jsx(fe,{})]})}),bu=({dialog:t,dialogProps:e})=>a.jsx(ke,{value:t,unmountOnExit:!0,lazyMount:!0,children:e&&a.jsx(ju,{...e})}),Ro=it(({inputProps:t,children:e,rootRef:n,trackLabel:r,thumbLabel:i,ref:s,...o})=>a.jsxs(Me.Root,{ref:n,...o,children:[a.jsx(Me.HiddenInput,{ref:s,...t}),a.jsxs(Me.Control,{children:[a.jsx(Me.Thumb,{children:i&&a.jsx(Me.ThumbIndicator,{fallback:i==null?void 0:i.off,children:i==null?void 0:i.on})}),r&&a.jsx(Me.Indicator,{fallback:r.off,children:r.on})]}),e!=null&&a.jsx(Me.Label,{children:e})]})),_u=({experiment:t,structure:e,ref:n,...r})=>{const{experimentIdToThresholds:i}=St(D),s=i[t.id],o=W(()=>s!=null&&s.lower&&!(s!=null&&s.upper)?[{category:"under",colorPalette:"below",text:`Below ${s.lower} Å`},{category:"ok",colorPalette:"green",text:`Above ${s.lower} Å`}]:!(s!=null&&s.lower)&&(s!=null&&s.upper)?[{category:"ok",colorPalette:"green",text:`Below ${s.upper} Å`},{category:"over",colorPalette:"red",text:`Above ${s.upper} Å`}]:s!=null&&s.lower&&(s!=null&&s.upper)?[{category:"under",colorPalette:"below",text:`Below ${s.lower} Å`},{category:"ok",colorPalette:"green",text:`Between ${s.lower} Å and ${s.upper} Å`},{category:"over",colorPalette:"red",text:`Above ${s.upper} Å`}]:[],[s]),{experimentIdToVisibleCrosslinkIds:c,aminoAcidsMustMatch:u}=St(D),l=c[t.id],h=W(()=>Object.fromEntries(t.crosslinks.filter(({id:g})=>l.has(g)).map(g=>[g.id,g])),[t.crosslinks,l]),f=W(()=>Object.fromEntries(t.proteins.map(g=>[g.id,g])),[t.proteins]),d=W(()=>lc(sr([Object.values(h)],f),!0).map(g=>h[g]),[h,f]),p=W(()=>{if(!s||!e||e.loading)return[];const g=[];for(const y of d){const b=fi(y,e.chains,e.chainIdToProteinIdToMapping,u).toArray(),w=Sn(b.map(({distance:I})=>I),s);g.push({...y,category:w,pairs:b.map(I=>({...I,category:Sn([I.distance],s)}))})}return g},[d,e,u,s]),[x,m]=lt({under:!0,ok:!0,over:!0}),v=W(()=>p.filter(({category:g})=>g&&x[g]),[p,x]);if(!(!e||e.loading))return a.jsxs(Te.Root,{ref:n,...r,children:[a.jsx(Te.Legend,{children:"Export crosslinks in structure"}),a.jsx(Te.Content,{children:a.jsx($n,{children:o.map(({category:g,colorPalette:y,text:b})=>{const w=p.some(I=>I.category===g);return a.jsx(Ro,{colorPalette:y,checked:x[g]&&w,onCheckedChange:({checked:I})=>m(E=>({...E,[g]:I})),disabled:!w,children:b},g)})})}),a.jsxs(jr,{alignSelf:"end",children:["Export ",Mt(v.length,"crosslink"),":",a.jsxs(tr,{attached:!0,children:[a.jsxs(st,{size:"xs",variant:"subtle",disabled:v.length===0,onClick:()=>Sr(uc(t,e.chains.map(({id:g})=>g),v),`${t.name??"XL Solver"}-${e.name}-xlinks`),children:[a.jsx(Ds,{}),"Distance Table"]}),a.jsxs(st,{size:"xs",variant:"subtle",disabled:v.length===0,onClick:()=>cc(t.name,e.name,v.flatMap(({category:g,pairs:y})=>y.filter(b=>b.category===g)),Object.fromEntries(o.map(({category:g,text:y})=>[g,y]))),children:[a.jsx(Ra,{}),"ChimeraX Script"]})]})]})]})},Su=t=>{const e=t.filter(({sequence:n})=>!/^[GAVLITSMCPFYWHKRDENQX-]*$/.test(n.toUpperCase()));return e.length>0?{error:{type:"error",title:`The sequence${e.length!==1?"s":""} of ${At(e.map(({id:n})=>n))} contain invalid characters`}}:new Set(t.map(({sequence:n})=>n.length)).size!==1?{error:{type:"error",title:"Sequences are not equal in size"}}:{error:void 0}},Cu=({sequences:t,...e})=>{const r=[];for(let u=0;u<t[0].sequence.length;u+=10){const l=Math.min(u+10,t[0].sequence.length);r.push(t.map(h=>h.sequence.slice(u,l).replaceAll("X","-")))}const i=":  ",s=Math.ceil((Math.max(...t.map(({id:u})=>u.length))+i.length)/10)*10,o=new Set;for(let u=0;u<t[0].sequence.length;u++){const l=t[0].sequence[u];t.every(h=>h.sequence[u]===l)&&o.add(u)}const c=t.map(({sequence:u,highlightedPositions:l})=>{if(!l)return;const h=new Set;let f=1;return Array.from(u).forEach((d,p)=>{d!=="-"&&(l.has(f)&&h.add(p),++f)}),h});return a.jsxs(at,{gapY:10,wrap:"wrap",...e,children:[a.jsxs(at,{children:[a.jsx(Rt,{direction:"column",mt:"1.1lh",h:"0.8lh"}),a.jsx(at,{direction:"column",align:"end",justify:"end",children:t.map(({id:u})=>a.jsxs(Lt,{whiteSpace:"pre",fontWeight:"bold",children:[10>u.length+i.length&&a.jsx(a.Fragment,{children:" ".repeat(s-(u.length+i.length))}),u,i]},u))})]}),r.map((u,l)=>a.jsxs(at,{children:[a.jsx(Rt,{direction:"column",mt:"1.1lh",h:"0.8lh"}),a.jsxs(at,{direction:"column",align:"end",children:[a.jsx(Lt,{color:"fg.muted",children:t[0].sequence.length<10?t[0].sequence.length:l*10+10}),u.map((h,f)=>a.jsxs(Lt,{whiteSpace:"pre",children:[Array.from(h).map((d,p)=>{var x,m;return d==="-"?a.jsx(Ce,{color:"fg.subtle",children:d},p):a.jsx(Ce,{bg:o.has(l*10+p)?"yellow.focusRing":void 0,fontWeight:(x=c[f])!=null&&x.has(l*10+p)?"bold":void 0,color:(m=c[f])!=null&&m.has(l*10+p)?"red":void 0,children:d},p)}),10>h.length&&a.jsx(a.Fragment,{children:" ".repeat(10-h.length)})]},t[f].id))]})]},l))]})},Bn=(t,e)=>{const n=Array.from(Ws(e)),r=new Set(n.filter((d,p,x)=>x.findIndex(m=>m.id===d.id)!==p).map(({id:d})=>d));if(r.size>0)return{error:{type:"error",title:`Duplicate sequence${r.size!==1?"s":""} of ${At(Array.from(r).map(d=>`${d} (appears ${Na(n.filter(p=>p.id===d).length)})`))}`}};const i=new Set(t.map(({id:d})=>d)),s=new Set(n.map(({id:d})=>d)),o=i.difference(s);if(o.size>0)return{error:{type:"error",title:`Missing sequence${o.size!==1?"s":""} of ${At(Array.from(o))}`}};let c;const u=s.difference(i);u.size>0&&(c={type:"warning",title:`Extra sequence${u.size!==1?"s":""} of ${At(Array.from(u))} ${u.size!==1?"are":"is"} ignored`,description:`Expected only the sequence${i.size!==1?"s":""} of ${At(Array.from(i))}`});const l=t.map(d=>({...d,sequence:n.find(({id:p})=>p===d.id).sequence.toUpperCase()})),h=l.filter(({sequence:d},p)=>d.replaceAll("-","")!==t[p].sequence.replaceAll("-",""));if(h.length>0)return{error:{type:"error",title:`Non-identical sequence${h.length!==1?"s":""} of ${At(h.map(({id:d})=>d))}`,description:"The sequences must be identical except for the gaps (i.e. '-')"}};const{error:f}=Su(l);return f?{error:f}:{warning:c,sequences:l}},Nr=({currentTarget:t},e)=>{const n=t.closest("[data-part=positioner]")||document.documentElement,r=n.scrollLeft,i=n.scrollTop;e&&(t.value=e),t.style.height="auto",t.style.height=`${t.scrollHeight}px`,n.scrollTo(r,i)};let gt;const Tu=({defaultSequences:t,onChange:e,readOnly:n=!1,setIsEditing:r,defaultEdit:i,inputRef:s,ref:o,...c})=>{const u=nt(({value:_})=>{const{warning:S,sequences:A}=Bn(t,_);A&&(gt=vn(gt),S&&(gt=wt(gt,S)),e(A))},[t,e]),l=W(()=>sl(t),[t]),[h,f]=lt(i??!1),d=nt(_=>{f(_),r==null||r(_)},[r]),[p,x]=lt(),m=h?void 0:p,v=W(()=>{if(m)return Bn(t,m).sequences},[m,t]),g=h?p:void 0,y=W(()=>{if(g===void 0)return;if(g.trim().length===0)return`Enter a sequence alignment of ${At(t.map(({id:S})=>S))} in FASTA format`;const{error:_}=Bn(t,g);return _==null?void 0:_.title},[t,g]),b=nt((_,S=!1)=>{gt=vn(gt);const{error:A,warning:k}=Bn(t,_);return A?(S||(gt=wt(gt,A)),d(!0),!1):(k&&!S&&(gt=wt(gt,k)),d(!1),u({value:_}),!0)},[t,d,u]),w=nt(_=>{if(_.size===0){gt=wt(gt,{type:"error",title:`${_.name} is empty`});return}_.text().then(S=>{if(!Hs(S)){gt=wt(gt,{type:"error",title:`${_.name} is not a valid FASTA file`});return}x(S),s.current&&Nr({currentTarget:s.current},S),b(S)&&(gt=wt(gt,{type:"success",title:`Loaded alignment from ${_.name}`}))}).catch(S=>{gt=wt(gt,{type:"error",title:`Couldn't read ${_.name}`,description:S.message})})},[s,b]),I=nt(_=>{var A;if(!((A=_.dataTransfer)!=null&&A.items)||_.dataTransfer.items.length===0)return;const S=_.dataTransfer.items[0];if(S.kind==="file"){const k=S.getAsFile();k&&w(k)}},[w]);let E=0;return a.jsxs(Rt,{onDragEnter:_=>{_.stopPropagation(),++E===1&&_.currentTarget.classList.add(Ye.dragover)},onDragLeave:_=>{_.stopPropagation(),--E===0&&_.currentTarget.classList.remove(Ye.dragover)},onDragOver:_=>{_.preventDefault(),_.stopPropagation()},onDrop:_=>{_.preventDefault(),_.stopPropagation(),_.currentTarget.classList.remove(Ye.dragover),E=0,I(_)},border:"2px solid transparent",ref:o,...c,children:[!h&&a.jsx(Cu,{sequences:v??t,onClick:()=>!n&&d(!0),cursor:"text",fontFamily:"mono"}),h&&a.jsxs(yl,{invalid:!!y,children:[a.jsx(wl,{autoFocus:!0,fontFamily:"mono",overflowY:"hidden",ref:s,onFocus:Nr,onInput:Nr,value:p??l,onChange:_=>{gt=vn(gt),x(_.currentTarget.value)},onKeyDown:_=>{_.key==="Enter"&&_.metaKey&&b(_.currentTarget.value)},onBlur:_=>b(_.currentTarget.value,!0)}),a.jsxs(Ge,{children:[y,"."," ",a.jsx(di,{onClick:()=>{x(void 0),d(!1)},children:"Revert changes."})]})]})]})},Iu=it(({alignment:t,readOnly:e=!1,applyAlignment:n,closeDialog:r})=>{const i=ot(null),s=!t,[o,c]=lt(s),[u,l]=lt(t),h=!o&&u&&JSON.stringify(u)===JSON.stringify(t);return a.jsxs(a.Fragment,{children:[a.jsxs(pe,{flexDir:"column",children:[a.jsx(ge,{children:"Alignment"}),a.jsx(Nn,{}),a.jsx(de,{})]}),a.jsxs(me,{children:[a.jsx(Tu,{defaultSequences:t,onChange:f=>l(f),defaultEdit:s,setIsEditing:c,readOnly:e,inputRef:i}),!o&&a.jsxs(Lt,{mt:5,fontSize:"xs",children:[a.jsx(Ce,{bg:"yellow.focusRing",children:"X"})," - Conserved",a.jsx(Ce,{fontWeight:"bold",color:"red",ml:5,children:"X"})," ","- Cross-linked"]})]}),a.jsxs(fe,{children:[!o&&h&&a.jsx(st,{variant:"surface",onClick:r,children:"Close"}),!o&&!h&&a.jsxs(a.Fragment,{children:[a.jsx(st,{variant:"surface",onClick:r,children:"Cancel"}),a.jsx(st,{colorPalette:"green",onClick:()=>{u&&(n(u.map(({sequence:f})=>f)),r())},disabled:!u,children:"Save alignment"})]})]})]})}),ku=it(({experimentId:t,structureId:e,chain:n,proteinsCollection:r,mappedProteinId:i,onShowAlignment:s,ref:o,...c})=>{const[{value:u,loading:l,error:h},f]=Cl(nt(async(g,y)=>{var w;if(i&&Zc(e,n.id,i),!g)return;const b=g in D.referenceProteinsById?D.referenceProteinsById[g]:(w=D.experiments.find(({id:I})=>I===t))==null?void 0:w.proteins.find(({id:I})=>I===g);if(b)return Kc(e,n.id,b,y)},[i,e,n.id,t])),d=qs({defaultValue:i?[i]:[],collection:r,onValueChange:({value:g})=>f(g[0]),invalid:!!h&&!l,disabled:l}),p=!l&&!h&&!!u,x=p&&u.message.startsWith("Note that this mapping might be wrong"),m=r.items.filter(g=>g.fileId===t),v=r.items.filter(g=>g.fileId===void 0&&!m.some(({value:y})=>y===g.value));return a.jsxs(wn,{invalid:!!h&&!l,ref:o,...c,children:[a.jsxs(Ks,{size:"xs",value:d,flexDirection:"row",gapX:3,alignItems:"center",children:[a.jsxs(Ec,{minW:5,children:["/",n.id]}),a.jsxs(Ac,{clearable:!l,hideIndicator:l,flexGrow:1,triggerProps:p?{borderColor:x?"fg.warning":"fg.success"}:void 0,children:[a.jsx(Mc,{placeholder:"Select protein to map",children:g=>At(g.map(y=>y.label+(y.isReferenceProtein?" (reference protein)":"")))}),l&&a.jsx(Ie,{})]}),a.jsxs(fo,{portalled:!1,mt:-1,children:[m.map(g=>a.jsxs(Kr,{item:g,children:[g.label," ",g.isReferenceProtein?"(reference protein)":""]},g.value)),v.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(Oe,{}),v.map(g=>a.jsxs(Kr,{item:g,children:[g.label," ",g.isReferenceProtein?"(reference protein)":""]},g.value))]})]})]}),!l&&h&&a.jsx(Ge,{children:h.message}),p&&a.jsxs(jl,{color:x?"fg.warning":"fg.success",children:[u.message," ",s&&u.mapping.alignedSequences&&a.jsx(di,{onClick:()=>{Os(d.selectedItems.length===1);const g=d.selectedItems[0];if(!g)return;const y=new Set;if(g.isReferenceProtein)for(const[b,w]of D.proteinIdToReferenceProtein.entries()){if(w.id!==g.value)continue;const I=D.experiments.flatMap(({proteins:E})=>E).find(({id:E})=>E===b);I&&Object.keys(I.linkPositionToAminoAcid).map(E=>Number.parseInt(E)).forEach(E=>{const _=w.xlPosToRefPos[E];_&&y.add(_)})}else{const b=D.experiments.flatMap(({proteins:w})=>w).find(({id:w})=>w===g.value);b&&Object.keys(b.linkPositionToAminoAcid).map(w=>Number.parseInt(w)).forEach(w=>{y.add(w)})}return s({sequences:[{id:`/${n.id}`,sequence:u.mapping.alignedSequences.chain},{id:g.label,sequence:u.mapping.alignedSequences.protein,highlightedPositions:y}],applyAlignment:b=>f(g.value,b)})},children:"View alignment."})]})]})}),Au=it(({experiment:t,structureId:e,ref:n,...r})=>{const{structures:i}=St(D),s=i.find(({id:f})=>f===e),o=gi(),c=W(()=>{const f=new Set;return Gs({items:[...t.proteins.map(({id:d,name:p,isReferenceProtein:x})=>(x&&f.add(d),{value:d,label:p,fileId:t.id,isReferenceProtein:x})),...o.filter(({id:d})=>!f.has(d)).map(({id:d,name:p})=>({value:d,label:p,fileId:void 0,isReferenceProtein:!0}))]})},[t.id,t.proteins,o]),u=ce({trapFocus:!1}),[l,h]=lt();if(!(!s||s.loading))return a.jsxs(ue,{ref:n,...r,children:[a.jsxs(pe,{flexDir:"column",children:[a.jsx(ge,{children:"Structure"}),a.jsx(Nn,{asChild:!0,children:a.jsx(bt.Root,{size:"sm",orientation:"horizontal",wordBreak:"break-word",children:a.jsxs(bt.Item,{children:[a.jsx(bt.ItemLabel,{children:"Name"}),a.jsx(bt.ItemValue,{children:a.jsx(Rn,{name:s.name,onRename:f=>wo(s.id,{name:f})})})]})})}),a.jsx(de,{})]}),a.jsx(me,{children:a.jsxs(wr,{gap:5,align:"stretch",children:[a.jsxs(Te.Root,{children:[a.jsxs(Te.Legend,{children:["Map chains to proteins in ",t.name]}),a.jsx(Te.Content,{children:s.chains.map(f=>{var d;return a.jsx(ku,{experimentId:t.id,structureId:s.id,chain:f,proteinsCollection:c,mappedProteinId:(d=Object.entries(s.chainIdToProteinIdToMapping[f.id]).find(([p,x])=>c.has(p)&&x!==void 0))==null?void 0:d[0],onShowAlignment:p=>{h(p),u.setOpen(!0)}},f.id)})})]}),a.jsx(_u,{experiment:t,structure:s},`${s.id}-${t.id}`)]})}),a.jsx(fe,{}),a.jsx(ke,{value:u,size:"xl",placement:"top",lazyMount:!0,unmountOnExit:!0,children:a.jsx(ue,{h:"fit",portalled:!1,children:l&&a.jsx(Iu,{alignment:l.sequences,applyAlignment:l.applyAlignment,closeDialog:()=>{u.setOpen(!1)}})})})]})}),Pu=it(({dialog:t,dialogProps:e})=>a.jsx(ke,{value:t,unmountOnExit:!0,lazyMount:!0,children:e&&a.jsx(Au,{...e})})),ds=t=>t.linkPosition?`${t.aminoAcid??""}${t.linkPosition}`:"Ø",Mu={cell:{width:20,height:20},labels:{crosslinks:{width:270,padding:10,fontSize:10,columns:[{render:({id:t})=>t,padding:0},{render:({from:t,to:e})=>`${ds(t)} - ${ds(e)}`,padding:30},{render:({from:t,to:e},n,r)=>r?`${n[t.proteinId].name} - ${n[e.proteinId].name}`:null,x:0,textAnchor:"start"}]},structures:{height:100,padding:10,fontSize:10}}},Eu=({config:t=Mu,experiments:e,groupedCrosslinkIds:n,structureNameById:r,proteinsById:i,ref:s,...o})=>{const c=e.flatMap(({groupedStructureIds:l},h)=>l.flat().map(f=>[h,f])),u=[];for(const{ids:l}of n.flatMap(({rows:h})=>h))u.push(...e.flatMap(({experiment:{crosslinks:h}},f)=>l[f].map(d=>[f,h.find(p=>p.id===d)])));return a.jsxs("svg",{viewBox:`0 0 ${t.labels.crosslinks.width+c.length*t.cell.width} ${t.labels.structures.height+u.length*t.cell.height}`,width:t.labels.crosslinks.width+c.length*t.cell.width,height:t.labels.structures.height+u.length*t.cell.height,...o,ref:s,children:[u.map(([l,h],f)=>c.map(([d,p],x)=>{var m;return d===l?a.jsx("rect",{width:t.cell.width,height:t.cell.height,x:t.labels.crosslinks.width+x*t.cell.width,y:t.labels.structures.height+f*t.cell.height,fill:se((m=e[d].structureToXlinkIdToStatus[p])==null?void 0:m[h.id])},`${d}-${h.id}-${p}`):null})),u.map(([l,h],f)=>t.labels.crosslinks.columns.map(({render:d,padding:p,...x},m)=>a.jsx("text",{y:t.labels.structures.height+(f+.5)*t.cell.height,x:t.labels.crosslinks.width-t.labels.crosslinks.padding-(p??0),dominantBaseline:"middle",textAnchor:"end",fontSize:t.labels.crosslinks.fontSize,...x,children:d(h,i,f===0||h.from.proteinId!==u[f-1][1].from.proteinId||h.to.proteinId!==u[f-1][1].to.proteinId)},`${l}-xlink-${h.id}-${m}`))),c.map(([l,h],f)=>a.jsx("text",{transform:`translate(${t.labels.crosslinks.width+(f+.5)*t.cell.width}, ${t.labels.structures.height-t.labels.structures.padding}) rotate(90)`,dominantBaseline:"middle",textAnchor:"end",fontSize:t.labels.structures.fontSize,children:r[h]},`${l}-structure-${h}`))]})},$u=({exportBasename:t,gridProps:e,...n})=>{const r=ot(null),i=nt(()=>{if(!r.current)return;const h=document.createElement("a"),f=new Blob([new XMLSerializer().serializeToString(r.current)],{type:"image/svg+xml"});h.href=URL.createObjectURL(f),h.download=`${t}-figure.svg`,h.click()},[r,t]),s=nt(()=>{if(!r.current)return;const h=new Blob([new XMLSerializer().serializeToString(r.current)],{type:"image/svg+xml"}),f=window.URL||window.webkitURL||window,d=f.createObjectURL(h),p=new Image;p.width=r.current.viewBox.baseVal.width,p.height=r.current.viewBox.baseVal.height,p.src=d,p.onload=function(){const x=document.getElementById("canvas");x.width=p.width,x.height=p.height;const m=x.getContext("2d");m==null||m.drawImage(p,0,0),f.revokeObjectURL(d);const v=x.toDataURL("image/png").replace("image/png","image/octet-stream"),g=document.createElement("a");g.href=v,g.download=`${t}.png`,g.click()}},[r,t]),[o,c]=lt(!1),[u,l]=lt(!1);return a.jsxs(ue,{...n,children:[a.jsxs(pe,{flexDir:"column",children:[a.jsx(ge,{children:"Export Figure"}),a.jsx(de,{})]}),a.jsxs(me,{as:at,justifyContent:"center",onClick:()=>c(h=>!h),cursor:o?"zoom-out":"zoom-in",bgImage:u?"linear-gradient(45deg, #E0E0E0 25%, transparent 25%), linear-gradient(-45deg, #E0E0E0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #E0E0E0 75%), linear-gradient(-45deg, transparent 75%, #E0E0E0 75%)":void 0,bgSize:u?"20px 20px":void 0,bgPos:u?"0 0, 0 10px, 10px -10px, -10px 0px":void 0,children:[a.jsx(Eu,{...e,ref:r,...o?{}:{height:"100%"},...u?{}:{style:{backgroundColor:"white"}}}),a.jsx("canvas",{style:{display:"none"},id:"canvas"})]}),a.jsxs(fe,{as:at,justifyContent:"space-between",children:[a.jsx(Cn,{checked:u,onCheckedChange:({checked:h})=>l(!!h),variant:"outline",children:"Transparent background"}),a.jsxs(tr,{children:[a.jsx(st,{variant:"outline",onClick:()=>i(),children:"Export as SVG"}),a.jsx(st,{variant:"outline",onClick:()=>s(),children:"Export as PNG"})]})]})]})},No=({dialog:t,dialogProps:e})=>a.jsx(ke,{value:t,size:"cover",placement:"center",scrollBehavior:"inside",unmountOnExit:!0,lazyMount:!0,children:e&&a.jsx($u,{...e})}),zu=(t,e,n)=>{const r=[];for(let i=0;i<=n;i++)t[i]===!0?e?r.length=0:r.push(i):e?r.push(i):r.length=0;return r},fs=({fromProteinId:t,fromDomainName:e,toProteinId:n,toDomainName:r})=>`${t}-${e}-${n}-${r}`,Oo=(t,e,n,r)=>{const[i,s]=lt({});for(const[x,m]of Object.entries(i)){const v=t.indexOf(x);if(v===-1)s(g=>Object.fromEntries(Object.entries(g).filter(([y])=>y!==x)));else{const g=new Set(m).difference(new Set(e.flatMap(({rows:y})=>y.flatMap(({ids:b})=>b[v]))));g.size>0&&s(y=>{var b;return{...y,[x]:(b=y[x])==null?void 0:b.filter(w=>!g.has(w))}})}}const o=W(()=>n.map(x=>{if(x)return x.ids.every((m,v)=>m.every(g=>{var y;return((y=i[t[v]])==null?void 0:y.includes(g))===!0}))?!0:x.ids.some((m,v)=>m.some(g=>{var y;return((y=i[t[v]])==null?void 0:y.includes(g))===!0}))?"indeterminate":!1}),[n,i,t]),c=W(()=>r.map((x,m)=>{if(x===void 0)return;let v;for(let g=m;g<o.length&&(g===m||r[g]===void 0);++g)if(o[g]!==void 0){if(v===void 0){if(v=o[g],v==="indeterminate")return"indeterminate"}else if(v!==o[g])return"indeterminate"}return v}),[r,o]),u=Object.values(i).flat().length,l=o.some(x=>x==="indeterminate")?void 0:o.filter(x=>x===!0).length,h=nt((x,m)=>{const v=Object.fromEntries(vr(...m.map(({ids:g})=>g)).map((g,y)=>[t[y],g.flatMap(b=>b??[])]));s(x?g=>Object.fromEntries(Object.values(Object.groupBy([...Object.entries(g).flatMap(([y,b])=>b?[[y,b]]:[]),...Object.entries(v)],([y])=>y)).filter(y=>y!==void 0).map(y=>[y[0][0],Array.from(new Set(y.flatMap(([b,w])=>w)))])):g=>Object.fromEntries(Object.entries(g).map(([y,b])=>[y,b==null?void 0:b.filter(w=>!v[y].includes(w))])))},[t]),f=nt((x,m,v)=>{if(!v)h(x,[m]);else{const g=n.findIndex(b=>b&&JSON.stringify(b)===JSON.stringify(m)),y=zu(o,x,g);h(x,y.map(b=>n[b]).filter(b=>b!==void 0))}},[h,n,o]),d=nt((x,m,v)=>h(x,e.find(g=>fs(g)===fs(m)).rows),[h,e]),p=nt(()=>s({}),[]);return{selectedCrosslinkIds:i,rowIndexToCheckedState:o,rowIndexToGroupCheckedState:c,numOfSelectedCrosslinks:u,numOfSelectedRows:l,onRowToggle:f,onGroupToggle:d,clearSelectedRows:p}},Lo=it(({selectedCrosslinkIds:t,numOfSelectedCrosslinks:e,numOfSelectedRows:n,clearSelectedRows:r,saveCrosslinksTable:i,hideCrosslinks:s,...o})=>a.jsx(Mo,{open:e>0,onOpenChange:({open:c})=>c?null:r(),closeOnInteractOutside:!1,...o,children:a.jsxs(Ao,{children:[a.jsxs(Eo,{children:[n!==void 0&&n!==e?Mt(n,"row"):Mt(e,"crosslink")," ","selected"]}),a.jsx(cr,{}),a.jsxs(st,{variant:"surface",size:"sm",onClick:()=>i(t),children:[a.jsx(bo,{}),"Export"]}),a.jsx(cr,{}),a.jsxs(st,{variant:"surface",colorPalette:"red",size:"sm",onClick:()=>{s(t),r()},children:[a.jsx(Oa,{}),"Hide"]}),a.jsx(Po,{})]})})),Ru="_experimentname_7yvhj_1",Nu={experimentname:Ru},Ou=it(({experiments:t,groupedCrosslinkIds:e,proteinsById:n,structuresById:r,groupDuplicates:i,hideCrosslinks:s})=>{var Pe,Tt,Kt;const o=ie(t),c=!Object.is(o,t),u=ie(e),l=ie(n),h=ie(r),f=ie(i),d=ot(null),p=W(()=>{const z=[void 0,void 0];return u.forEach(({rows:B},X)=>{X!==0&&z.push(void 0);const K=f?B.length:B.reduce((et,{ids:kt})=>et+Math.max(...kt.map(yt=>yt.length)),0);z.push(X),z.push(...Array(K-1).fill(void 0))}),z},[f,u]),x=W(()=>{const z=[void 0,void 0];return u.forEach(({rows:B},X)=>{X!==0&&z.push(void 0);for(const K of B)f?z.push(K):z.push(...vr(...K.ids).map(et=>({...K,ids:et.map(kt=>kt!==void 0?[kt]:[])})).flat())}),z},[f,u]),m=z=>{if(z===0)return"header";if(z===1)return"header-2";const B=x[z];return B===void 0?`gap-after-${m(z-1)}`:B.ids.map(X=>X.length>0?X.join("-"):"X").join(":")},v=ko({enabled:u.length>0,count:x.length,estimateSize:z=>z===0?40:z===1?80:x[z]===void 0?5:26,scrollMargin:((Pe=d.current)==null?void 0:Pe.offsetTop)??0,getItemKey:m,overscan:20,rangeExtractor:z=>new Set([0,1,...vi(z),...p.flatMap((B,X)=>B!==void 0?[X]:[])]).values().toArray()}),g=W(()=>{const z=[void 0];return o.forEach(({groupedStructureIds:B},X)=>{X!==0&&z.push(void 0),z.push([X,void 0]),B.forEach((K,et)=>{et!==0&&z.push([X,void 0]),z.push(...K.map(kt=>[X,kt]))}),z.push([X,void 0])}),z},[o]),y=z=>{if(z===0)return"header";const B=g[z];return B===void 0||B[1]===void 0?`gap-after-${y(z-1)}`:`${o[B[0]].experiment.id}-${B[1]}`},b=Io({enabled:u.length>0,horizontal:!0,count:g.length,getScrollElement:()=>d.current,estimateSize:z=>{if(z===0)return 237;const B=g[z];return B===void 0?10:B[1]===void 0?5:26},overscan:20,getItemKey:y}),w=b.getVirtualItems(),[I,E]=w.length>0?[w[0].start,b.getTotalSize()-w[w.length-1].end]:[0,0],[_,S]=lt(),A=Object.values(_??[]).reduce((z,B)=>z+((B==null?void 0:B.size)??0),0),k=A>0?Object.entries(_??{}).filter(([z,B])=>((B==null?void 0:B.size)??0)!==0).map(([z])=>z).length===1:!1,P=nt((z,B,X)=>{S(K=>{var et;return(et=K==null?void 0:K[z])!=null&&et.has(B)?{...K,[z]:K[z].difference(new Set([B]))}:{...K,[z]:((K==null?void 0:K[z])??new Set).union(new Set([B]))}})},[]);let R=((Tt=b.measurementsCache[0])==null?void 0:Tt.size)??0;const $=z=>{var et,kt;if(!b.options.enabled||!z||!z.dataset.index)return;const B=z.getBoundingClientRect().width;if(z.dataset.index==="0"){R<B&&(R=B,b.resizeItem(0,Math.ceil(B)));return}const[X,K]=z.dataset.index.split("-").map(yt=>Number.parseInt(yt));if(!Number.isNaN(X)&&!Number.isNaN(K)){let yt=B;for(let Jt=X;Jt<K;++Jt){const an=g[Jt];an===void 0?yt-=10:an[1]===void 0?yt-=5:yt-=26}const J=yt/2;(((et=b.measurementsCache[X])==null?void 0:et.size)??0)<J&&b.resizeItem(X,Math.ceil(J)),(((kt=b.measurementsCache[K])==null?void 0:kt.size)??0)<J&&b.resizeItem(K,Math.ceil(J))}};Gt(()=>{b.measure()},[u,l,b]);let j=((Kt=v.measurementsCache[0])==null?void 0:Kt.size)??0;const T=z=>{!v.options.enabled||!z||z.dataset.index!=="1"||j<z.getBoundingClientRect().height&&(j=z.getBoundingClientRect().height,v.resizeItem(1,Math.ceil(z.getBoundingClientRect().height)))};Gt(()=>{v.measure()},[h,v]);const C=W(()=>a.jsxs(a.Fragment,{children:[a.jsx(er,{styles:{".xlink":{cursor:"pointer",color:"transparent",fontSize:"0.8rem",alignContent:"center",textAlign:"center",":hover":{boxShadow:"inset 0px 0px 0px 1px var(--chakra-colors-fg-inverted)",color:"var(--chakra-colors-fg-inverted)"}}}}),a.jsx(er,{styles:Object.fromEntries(u.flatMap(({fromProteinId:z,fromDomainName:B,toProteinId:X,toDomainName:K})=>[z,...B?[z+B]:[],X,...K?[X+K]:[]].map(et=>[`html:has(.xlp${jn(et)}:hover) .xlp${jn(et)}`,{boxShadow:"inset 0px 0px 0px 1px var(--chakra-colors-fg-info)"}])))})]}),[u]),[M,O]=lt(),V=ce({trapFocus:!1}),[F,H]=lt(),Y=ce({trapFocus:!1}),N=o.some(({experiment:{crosslinks:z}})=>z.some(({score:B})=>B!==void 0)),[L,U]=Tl("fieldToShow","ids"),G=o.length>1?void 0:N?L:"ids",q=N?()=>U(L==="ids"?"scores":"ids"):void 0,Z=ce({}),{selectedCrosslinkIds:rt,rowIndexToCheckedState:tt,rowIndexToGroupCheckedState:$t,numOfSelectedCrosslinks:ct,numOfSelectedRows:ft,onRowToggle:vt,onGroupToggle:ht,clearSelectedRows:Q}=Oo(W(()=>o.map(({experiment:z})=>z.id),[o]),u,x,p),zt=nt(z=>Sr(_r(o.map(({experiment:B})=>B),u.map(({rows:B,...X})=>({rows:B.map(({ids:K,...et})=>({ids:K.map((kt,yt)=>kt.filter(J=>{var Jt;return((Jt=z[o[yt].experiment.id])==null?void 0:Jt.includes(J))===!0})),...et})),...X}))),`${o.length===1?o[0].experiment.name??"XL Solver":"Experiments"}-xlinks`),[o,u]);return a.jsxs(a.Fragment,{children:[a.jsx(Pu,{dialog:V,dialogProps:M}),a.jsx(bu,{dialog:Y,dialogProps:F}),a.jsx(No,{dialog:Z,dialogProps:{exportBasename:o.length===1?o[0].experiment.name??"XL Solver":"Experiments",gridProps:{experiments:o,groupedCrosslinkIds:u,proteinsById:l,structureNameById:Object.fromEntries(Object.values(h).map(({id:z,name:B})=>[z,B]))}}}),C,a.jsx("div",{ref:d,style:{overflowY:"auto",opacity:c?.5:1,transition:c?"opacity 0.2s 0.2s linear":"opacity 0s 0s linear",userSelect:"none",WebkitUserSelect:"none",display:"flex",justifyContent:"center",marginLeft:"1rem",marginRight:"1rem",marginBottom:ct>0||A>0?"5rem":void 0},children:a.jsx("div",{style:{height:v.getTotalSize(),position:"relative",width:b.getTotalSize()},children:v.getVirtualItems().map(z=>{const B=z.index===0||z.index===1,X=x[z.index];if(!B&&X===void 0)return null;const K=!B&&p[z.index]!==void 0?u[p[z.index]]:void 0;return a.jsxs("div",{"data-index":z.index,ref:z.index===1?T:void 0,style:{position:"absolute",top:0,left:0,transform:`translateY(${z.start-v.options.scrollMargin}px)`,display:"flex"},children:[a.jsx("div",{style:{width:`${I}px`}}),w.map(et=>{var Jt,an,Pi;const kt=et.index===0,yt=g[et.index];if(z.index===0){const Ot=yt==null?void 0:yt[0];if(Ot===void 0)return a.jsx("div",{"data-index":et.index,style:{minHeight:z.size,minWidth:et.size,maxHeight:150,maxWidth:500,flexShrink:0}},et.key);if(((Jt=g[et.index-1])==null?void 0:Jt[0])===Ot)return null;const Mi=g.findLastIndex(te=>(te==null?void 0:te[0])===Ot&&(te==null?void 0:te[1])===void 0),ya=Array.from(new Array(Mi-et.index+1)).map((te,Pr)=>et.index+Pr);return a.jsx("div",{"data-index":`${et.index}-${Mi}`,ref:$,className:o.length>1?Nu.experimentname:void 0,style:{minHeight:z.size,minWidth:ya.reduce((te,Pr)=>te+w[Pr].size,0),maxHeight:150,maxWidth:500,flexShrink:0,textAlign:"center"},children:o.length>1&&a.jsxs("span",{children:[a.jsx(br,{pb:"0.1rem",mr:"0.5rem",children:a.jsx(Cr,{})}),o[Ot].experiment.name]})},et.key)}const J=yt!==void 0&&yt[1]!==void 0?{file:o[yt[0]],structureId:yt[1],crosslinkIds:X==null?void 0:X.ids[yt[0]]}:void 0;return a.jsxs("div",{"data-index":et.index,ref:et.index===0?$:void 0,className:Ke(J==null?void 0:J.crosslinkIds)?"xlink":void 0,onClick:()=>{if(J!=null&&J.crosslinkIds&&J.crosslinkIds.length>0){const Ot=h[J.structureId];if(Ot.loading)return;H({experiment:J.file.experiment,crosslinkIds:J.crosslinkIds,structure:Ot}),Y.setOpen(!0)}},style:{minHeight:z.size,maxHeight:150,minWidth:et.size,maxWidth:500,flexShrink:0,...Ke(J==null?void 0:J.crosslinkIds)&&!h[J.structureId].loading?{backgroundColor:se((an=J.file.structureToXlinkIdToStatus[J.structureId])==null?void 0:an[J.crosslinkIds[0]])}:{}},children:[B&&z.index===1&&kt&&a.jsx($o,{field:G,onFieldClick:q,viewName:o.length===1?o[0].experiment.name??"XL Solver":"Experiments",experiments:o.map(({experiment:Ot})=>Ot),groupedCrosslinkIds:u,exportFigureDialog:o.some(({groupedStructureIds:Ot})=>Ot.flat().length>0)?Z:void 0,showingStructures:o.some(({groupedStructureIds:Ot})=>Ot.flat().length>0),disableMenus:ct!==0||A!==0}),B&&z.index===1&&!kt&&J!==void 0&&a.jsx(mu,{experimentId:J.file.experiment.id,structure:h[J.structureId],checked:((Pi=_==null?void 0:_[J.file.experiment.id])==null?void 0:Pi.has(J.structureId))??!1,onCheck:ct===0?P:void 0,onClick:()=>{O({experiment:J.file.experiment,structureId:J.structureId}),V.setOpen(!0)}}),kt&&!B&&X!==void 0&&a.jsx(_o,{rowHeader:X,groupHeader:K,field:G,checked:tt[z.index],groupedChecked:$t[z.index],toggle:A===0?vt:void 0,toggleGroup:A===0?ht:void 0}),(J==null?void 0:J.crosslinkIds)&&(J.crosslinkIds.length??0)>1&&`x${J.crosslinkIds.length}`]},et.key)}),a.jsx("div",{style:{width:`${E}px`}})]},z.key)})})}),a.jsx(Mo,{open:A>0,onOpenChange:({open:z})=>z?null:S(void 0),closeOnInteractOutside:!1,children:a.jsxs(Ao,{children:[a.jsxs(Eo,{children:[Mt(A,"structure")," selected"]}),a.jsx(cr,{}),a.jsxs(st,{variant:"surface",size:"sm",disabled:!k,onClick:()=>{const z=Object.entries(_??{}).find(([K,et])=>et&&et.size>0);if(!z||!z[1])return;const[B,X]=z;Zr(B,[...X]),S(void 0)},children:[a.jsx(pu,{}),"Group"]}),a.jsx(cr,{}),a.jsxs(vc,{placement:"center",children:[a.jsx(yc,{asChild:!0,children:a.jsxs(st,{variant:"surface",colorPalette:"red",size:"sm",children:[a.jsx(La,{}),"Hide"]})}),a.jsxs(ue,{children:[a.jsxs(pe,{children:[a.jsxs(ge,{children:["Hide ",Mt(A,"structure"),"?"]}),a.jsx(de,{})]}),a.jsxs(me,{children:["The structure",A!==1?"s":""," will be removed from the file",k?"":"s",', but will still be available under the "Structures" tab.']}),a.jsxs(fe,{children:[a.jsx(qr,{asChild:!0,children:a.jsx(st,{variant:"outline",children:"Cancel"})}),a.jsx(qr,{asChild:!0,children:a.jsx(st,{colorPalette:"red",onClick:()=>{Object.entries(_??{}).forEach(([z,B])=>{B&&xi(z,Array.from(B))}),S(void 0)},children:"Hide"})})]})]})]}),a.jsx(Po,{})]})}),a.jsx(Lo,{selectedCrosslinkIds:rt,numOfSelectedCrosslinks:ct,numOfSelectedRows:ft,clearSelectedRows:Q,saveCrosslinksTable:zt,hideCrosslinks:s})]})}),Do=it(({resetFilters:t,loading:e})=>a.jsx(un.Root,{children:a.jsxs(un.Content,{children:[a.jsx(un.Indicator,{children:a.jsx(Da,{})}),a.jsxs(wr,{textAlign:"center",children:[a.jsx(un.Title,{children:"No crosslinks match the current filters"}),a.jsx(un.Description,{children:"Adjust the filters or upload a new file to see crosslinks."}),a.jsx(En,{size:"sm",onClick:t,variant:"outline",loading:e,children:"Reset Filters"})]})]})}));function Fo({experiments:t,structures:e,groupDuplicates:n,resetFilters:r,hideCrosslinks:i}){const s=W(()=>Object.fromEntries(e.map(u=>[u.id,u])),[e]),o=W(()=>Object.fromEntries(t.flatMap(({experiment:{proteins:u}})=>u.map(l=>[l.id,l]))),[t]),c=W(()=>sr(t.map(({experiment:{crosslinks:u},visibleCrosslinkIds:l})=>u.filter(({id:h})=>l.has(h))),o),[t,o]);return c.length===0?a.jsx(Do,{resetFilters:r,loading:!1}):a.jsx(Ou,{experiments:t,groupedCrosslinkIds:c,proteinsById:o,structuresById:s,groupDuplicates:n,hideCrosslinks:i})}var Lu={value:()=>{}};function On(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Kn(n)}function Kn(t){this._=t}function Du(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Kn.prototype=On.prototype={constructor:Kn,on:function(t,e){var n=this._,r=Du(t+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(t=r[s]).type)&&(i=Fu(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=r[s]).type)n[i]=ps(n[i],t.name,e);else if(e==null)for(i in n)n[i]=ps(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Kn(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,i=s.length;r<i;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};function Fu(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function ps(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Lu,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Qr="http://www.w3.org/1999/xhtml";const ms={svg:"http://www.w3.org/2000/svg",xhtml:Qr,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Tr(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),ms.hasOwnProperty(e)?{space:ms[e],local:t}:t}function Vu(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Qr&&e.documentElement.namespaceURI===Qr?e.createElement(t):e.createElementNS(n,t)}}function Bu(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Vo(t){var e=Tr(t);return(e.local?Bu:Vu)(e)}function Hu(){}function wi(t){return t==null?Hu:function(){return this.querySelector(t)}}function Wu(t){typeof t!="function"&&(t=wi(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,c=r[i]=new Array(o),u,l,h=0;h<o;++h)(u=s[h])&&(l=t.call(u,u.__data__,h,s))&&("__data__"in u&&(l.__data__=u.__data__),c[h]=l);return new Ft(r,this._parents)}function Xu(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Uu(){return[]}function Bo(t){return t==null?Uu:function(){return this.querySelectorAll(t)}}function Gu(t){return function(){return Xu(t.apply(this,arguments))}}function qu(t){typeof t=="function"?t=Gu(t):t=Bo(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o=e[s],c=o.length,u,l=0;l<c;++l)(u=o[l])&&(r.push(t.call(u,u.__data__,l,o)),i.push(u));return new Ft(r,i)}function Ho(t){return function(){return this.matches(t)}}function Wo(t){return function(e){return e.matches(t)}}var Ku=Array.prototype.find;function Yu(t){return function(){return Ku.call(this.children,t)}}function Zu(){return this.firstElementChild}function Qu(t){return this.select(t==null?Zu:Yu(typeof t=="function"?t:Wo(t)))}var Ju=Array.prototype.filter;function th(){return Array.from(this.children)}function eh(t){return function(){return Ju.call(this.children,t)}}function nh(t){return this.selectAll(t==null?th:eh(typeof t=="function"?t:Wo(t)))}function rh(t){typeof t!="function"&&(t=Ho(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,c=r[i]=[],u,l=0;l<o;++l)(u=s[l])&&t.call(u,u.__data__,l,s)&&c.push(u);return new Ft(r,this._parents)}function Xo(t){return new Array(t.length)}function ih(){return new Ft(this._enter||this._groups.map(Xo),this._parents)}function ur(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}ur.prototype={constructor:ur,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function sh(t){return function(){return t}}function oh(t,e,n,r,i,s){for(var o=0,c,u=e.length,l=s.length;o<l;++o)(c=e[o])?(c.__data__=s[o],r[o]=c):n[o]=new ur(t,s[o]);for(;o<u;++o)(c=e[o])&&(i[o]=c)}function ah(t,e,n,r,i,s,o){var c,u,l=new Map,h=e.length,f=s.length,d=new Array(h),p;for(c=0;c<h;++c)(u=e[c])&&(d[c]=p=o.call(u,u.__data__,c,e)+"",l.has(p)?i[c]=u:l.set(p,u));for(c=0;c<f;++c)p=o.call(t,s[c],c,s)+"",(u=l.get(p))?(r[c]=u,u.__data__=s[c],l.delete(p)):n[c]=new ur(t,s[c]);for(c=0;c<h;++c)(u=e[c])&&l.get(d[c])===u&&(i[c]=u)}function lh(t){return t.__data__}function ch(t,e){if(!arguments.length)return Array.from(this,lh);var n=e?ah:oh,r=this._parents,i=this._groups;typeof t!="function"&&(t=sh(t));for(var s=i.length,o=new Array(s),c=new Array(s),u=new Array(s),l=0;l<s;++l){var h=r[l],f=i[l],d=f.length,p=uh(t.call(h,h&&h.__data__,l,r)),x=p.length,m=c[l]=new Array(x),v=o[l]=new Array(x),g=u[l]=new Array(d);n(h,f,m,v,g,p,e);for(var y=0,b=0,w,I;y<x;++y)if(w=m[y]){for(y>=b&&(b=y+1);!(I=v[b])&&++b<x;);w._next=I||null}}return o=new Ft(o,r),o._enter=c,o._exit=u,o}function uh(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function hh(){return new Ft(this._exit||this._groups.map(Xo),this._parents)}function dh(t,e,n){var r=this.enter(),i=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function fh(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),c=new Array(i),u=0;u<o;++u)for(var l=n[u],h=r[u],f=l.length,d=c[u]=new Array(f),p,x=0;x<f;++x)(p=l[x]||h[x])&&(d[x]=p);for(;u<i;++u)c[u]=n[u];return new Ft(c,this._parents)}function ph(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function mh(t){t||(t=gh);function e(f,d){return f&&d?t(f.__data__,d.__data__):!f-!d}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],c=o.length,u=i[s]=new Array(c),l,h=0;h<c;++h)(l=o[h])&&(u[h]=l);u.sort(e)}return new Ft(i,this._parents).order()}function gh(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function xh(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function vh(){return Array.from(this)}function yh(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function wh(){let t=0;for(const e of this)++t;return t}function jh(){return!this.node()}function bh(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],s=0,o=i.length,c;s<o;++s)(c=i[s])&&t.call(c,c.__data__,s,i);return this}function _h(t){return function(){this.removeAttribute(t)}}function Sh(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ch(t,e){return function(){this.setAttribute(t,e)}}function Th(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Ih(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function kh(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Ah(t,e){var n=Tr(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Sh:_h:typeof e=="function"?n.local?kh:Ih:n.local?Th:Ch)(n,e))}function Uo(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ph(t){return function(){this.style.removeProperty(t)}}function Mh(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Eh(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function $h(t,e,n){return arguments.length>1?this.each((e==null?Ph:typeof e=="function"?Eh:Mh)(t,e,n??"")):rn(this.node(),t)}function rn(t,e){return t.style.getPropertyValue(e)||Uo(t).getComputedStyle(t,null).getPropertyValue(e)}function zh(t){return function(){delete this[t]}}function Rh(t,e){return function(){this[t]=e}}function Nh(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Oh(t,e){return arguments.length>1?this.each((e==null?zh:typeof e=="function"?Nh:Rh)(t,e)):this.node()[t]}function Go(t){return t.trim().split(/^|\s+/)}function ji(t){return t.classList||new qo(t)}function qo(t){this._node=t,this._names=Go(t.getAttribute("class")||"")}qo.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Ko(t,e){for(var n=ji(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Yo(t,e){for(var n=ji(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Lh(t){return function(){Ko(this,t)}}function Dh(t){return function(){Yo(this,t)}}function Fh(t,e){return function(){(e.apply(this,arguments)?Ko:Yo)(this,t)}}function Vh(t,e){var n=Go(t+"");if(arguments.length<2){for(var r=ji(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?Fh:e?Lh:Dh)(n,e))}function Bh(){this.textContent=""}function Hh(t){return function(){this.textContent=t}}function Wh(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Xh(t){return arguments.length?this.each(t==null?Bh:(typeof t=="function"?Wh:Hh)(t)):this.node().textContent}function Uh(){this.innerHTML=""}function Gh(t){return function(){this.innerHTML=t}}function qh(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Kh(t){return arguments.length?this.each(t==null?Uh:(typeof t=="function"?qh:Gh)(t)):this.node().innerHTML}function Yh(){this.nextSibling&&this.parentNode.appendChild(this)}function Zh(){return this.each(Yh)}function Qh(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Jh(){return this.each(Qh)}function td(t){var e=typeof t=="function"?t:Vo(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function ed(){return null}function nd(t,e){var n=typeof t=="function"?t:Vo(t),r=e==null?ed:typeof e=="function"?e:wi(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function rd(){var t=this.parentNode;t&&t.removeChild(this)}function id(){return this.each(rd)}function sd(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function od(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ad(t){return this.select(t?od:sd)}function ld(t){return arguments.length?this.property("__data__",t):this.node().__data__}function cd(t){return function(e){t.call(this,e,this.__data__)}}function ud(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function hd(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,s;n<i;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function dd(t,e,n){return function(){var r=this.__on,i,s=cd(e);if(r){for(var o=0,c=r.length;o<c;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=e;return}}this.addEventListener(t.type,s,n),i={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(i):this.__on=[i]}}function fd(t,e,n){var r=ud(t+""),i,s=r.length,o;if(arguments.length<2){var c=this.node().__on;if(c){for(var u=0,l=c.length,h;u<l;++u)for(i=0,h=c[u];i<s;++i)if((o=r[i]).type===h.type&&o.name===h.name)return h.value}return}for(c=e?dd:hd,i=0;i<s;++i)this.each(c(r[i],e,n));return this}function Zo(t,e,n){var r=Uo(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function pd(t,e){return function(){return Zo(this,t,e)}}function md(t,e){return function(){return Zo(this,t,e.apply(this,arguments))}}function gd(t,e){return this.each((typeof e=="function"?md:pd)(t,e))}function*xd(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var Qo=[null];function Ft(t,e){this._groups=t,this._parents=e}function Ln(){return new Ft([[document.documentElement]],Qo)}function vd(){return this}Ft.prototype=Ln.prototype={constructor:Ft,select:Wu,selectAll:qu,selectChild:Qu,selectChildren:nh,filter:rh,data:ch,enter:ih,exit:hh,join:dh,merge:fh,selection:vd,order:ph,sort:mh,call:xh,nodes:vh,node:yh,size:wh,empty:jh,each:bh,attr:Ah,style:$h,property:Oh,classed:Vh,text:Xh,html:Kh,raise:Zh,lower:Jh,append:td,insert:nd,remove:id,clone:ad,datum:ld,on:fd,dispatch:gd,[Symbol.iterator]:xd};function Ht(t){return typeof t=="string"?new Ft([[document.querySelector(t)]],[document.documentElement]):new Ft([[t]],Qo)}function yd(t){let e;for(;e=t.sourceEvent;)t=e;return t}function re(t,e){if(t=yd(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const wd={passive:!1},In={capture:!0,passive:!1};function Or(t){t.stopImmediatePropagation()}function Je(t){t.preventDefault(),t.stopImmediatePropagation()}function Jo(t){var e=t.document.documentElement,n=Ht(t).on("dragstart.drag",Je,In);"onselectstart"in e?n.on("selectstart.drag",Je,In):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function ta(t,e){var n=t.document.documentElement,r=Ht(t).on("dragstart.drag",null);e&&(r.on("click.drag",Je,In),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Hn=t=>()=>t;function Jr(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:s,x:o,y:c,dx:u,dy:l,dispatch:h}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:c,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:h}})}Jr.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function jd(t){return!t.ctrlKey&&!t.button}function bd(){return this.parentNode}function _d(t,e){return e??{x:t.x,y:t.y}}function Sd(){return navigator.maxTouchPoints||"ontouchstart"in this}function Cd(){var t=jd,e=bd,n=_d,r=Sd,i={},s=On("start","drag","end"),o=0,c,u,l,h,f=0;function d(w){w.on("mousedown.drag",p).filter(r).on("touchstart.drag",v).on("touchmove.drag",g,wd).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(w,I){if(!(h||!t.call(this,w,I))){var E=b(this,e.call(this,w,I),w,I,"mouse");E&&(Ht(w.view).on("mousemove.drag",x,In).on("mouseup.drag",m,In),Jo(w.view),Or(w),l=!1,c=w.clientX,u=w.clientY,E("start",w))}}function x(w){if(Je(w),!l){var I=w.clientX-c,E=w.clientY-u;l=I*I+E*E>f}i.mouse("drag",w)}function m(w){Ht(w.view).on("mousemove.drag mouseup.drag",null),ta(w.view,l),Je(w),i.mouse("end",w)}function v(w,I){if(t.call(this,w,I)){var E=w.changedTouches,_=e.call(this,w,I),S=E.length,A,k;for(A=0;A<S;++A)(k=b(this,_,w,I,E[A].identifier,E[A]))&&(Or(w),k("start",w,E[A]))}}function g(w){var I=w.changedTouches,E=I.length,_,S;for(_=0;_<E;++_)(S=i[I[_].identifier])&&(Je(w),S("drag",w,I[_]))}function y(w){var I=w.changedTouches,E=I.length,_,S;for(h&&clearTimeout(h),h=setTimeout(function(){h=null},500),_=0;_<E;++_)(S=i[I[_].identifier])&&(Or(w),S("end",w,I[_]))}function b(w,I,E,_,S,A){var k=s.copy(),P=re(A||E,I),R,$,j;if((j=n.call(w,new Jr("beforestart",{sourceEvent:E,target:d,identifier:S,active:o,x:P[0],y:P[1],dx:0,dy:0,dispatch:k}),_))!=null)return R=j.x-P[0]||0,$=j.y-P[1]||0,function T(C,M,O){var V=P,F;switch(C){case"start":i[S]=T,F=o++;break;case"end":delete i[S],--o;case"drag":P=re(O||M,I),F=o;break}k.call(C,w,new Jr(C,{sourceEvent:M,subject:j,target:d,identifier:S,active:F,x:P[0]+R,y:P[1]+$,dx:P[0]-V[0],dy:P[1]-V[1],dispatch:k}),_)}}return d.filter=function(w){return arguments.length?(t=typeof w=="function"?w:Hn(!!w),d):t},d.container=function(w){return arguments.length?(e=typeof w=="function"?w:Hn(w),d):e},d.subject=function(w){return arguments.length?(n=typeof w=="function"?w:Hn(w),d):n},d.touchable=function(w){return arguments.length?(r=typeof w=="function"?w:Hn(!!w),d):r},d.on=function(){var w=s.on.apply(s,arguments);return w===s?d:w},d.clickDistance=function(w){return arguments.length?(f=(w=+w)*w,d):Math.sqrt(f)},d}function bi(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function ea(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Dn(){}var kn=.7,hr=1/kn,tn="\\s*([+-]?\\d+)\\s*",An="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Zt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Td=/^#([0-9a-f]{3,8})$/,Id=new RegExp(`^rgb\\(${tn},${tn},${tn}\\)$`),kd=new RegExp(`^rgb\\(${Zt},${Zt},${Zt}\\)$`),Ad=new RegExp(`^rgba\\(${tn},${tn},${tn},${An}\\)$`),Pd=new RegExp(`^rgba\\(${Zt},${Zt},${Zt},${An}\\)$`),Md=new RegExp(`^hsl\\(${An},${Zt},${Zt}\\)$`),Ed=new RegExp(`^hsla\\(${An},${Zt},${Zt},${An}\\)$`),gs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};bi(Dn,Pn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:xs,formatHex:xs,formatHex8:$d,formatHsl:zd,formatRgb:vs,toString:vs});function xs(){return this.rgb().formatHex()}function $d(){return this.rgb().formatHex8()}function zd(){return na(this).formatHsl()}function vs(){return this.rgb().formatRgb()}function Pn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Td.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?ys(e):n===3?new Nt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Wn(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Wn(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Id.exec(t))?new Nt(e[1],e[2],e[3],1):(e=kd.exec(t))?new Nt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ad.exec(t))?Wn(e[1],e[2],e[3],e[4]):(e=Pd.exec(t))?Wn(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Md.exec(t))?bs(e[1],e[2]/100,e[3]/100,1):(e=Ed.exec(t))?bs(e[1],e[2]/100,e[3]/100,e[4]):gs.hasOwnProperty(t)?ys(gs[t]):t==="transparent"?new Nt(NaN,NaN,NaN,0):null}function ys(t){return new Nt(t>>16&255,t>>8&255,t&255,1)}function Wn(t,e,n,r){return r<=0&&(t=e=n=NaN),new Nt(t,e,n,r)}function Rd(t){return t instanceof Dn||(t=Pn(t)),t?(t=t.rgb(),new Nt(t.r,t.g,t.b,t.opacity)):new Nt}function ti(t,e,n,r){return arguments.length===1?Rd(t):new Nt(t,e,n,r??1)}function Nt(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}bi(Nt,ti,ea(Dn,{brighter(t){return t=t==null?hr:Math.pow(hr,t),new Nt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?kn:Math.pow(kn,t),new Nt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Nt(Le(this.r),Le(this.g),Le(this.b),dr(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ws,formatHex:ws,formatHex8:Nd,formatRgb:js,toString:js}));function ws(){return`#${Re(this.r)}${Re(this.g)}${Re(this.b)}`}function Nd(){return`#${Re(this.r)}${Re(this.g)}${Re(this.b)}${Re((isNaN(this.opacity)?1:this.opacity)*255)}`}function js(){const t=dr(this.opacity);return`${t===1?"rgb(":"rgba("}${Le(this.r)}, ${Le(this.g)}, ${Le(this.b)}${t===1?")":`, ${t})`}`}function dr(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Le(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Re(t){return t=Le(t),(t<16?"0":"")+t.toString(16)}function bs(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Xt(t,e,n,r)}function na(t){if(t instanceof Xt)return new Xt(t.h,t.s,t.l,t.opacity);if(t instanceof Dn||(t=Pn(t)),!t)return new Xt;if(t instanceof Xt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,c=s-i,u=(s+i)/2;return c?(e===s?o=(n-r)/c+(n<r)*6:n===s?o=(r-e)/c+2:o=(e-n)/c+4,c/=u<.5?s+i:2-s-i,o*=60):c=u>0&&u<1?0:o,new Xt(o,c,u,t.opacity)}function Od(t,e,n,r){return arguments.length===1?na(t):new Xt(t,e,n,r??1)}function Xt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}bi(Xt,Od,ea(Dn,{brighter(t){return t=t==null?hr:Math.pow(hr,t),new Xt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?kn:Math.pow(kn,t),new Xt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Nt(Lr(t>=240?t-240:t+120,i,r),Lr(t,i,r),Lr(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Xt(_s(this.h),Xn(this.s),Xn(this.l),dr(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=dr(this.opacity);return`${t===1?"hsl(":"hsla("}${_s(this.h)}, ${Xn(this.s)*100}%, ${Xn(this.l)*100}%${t===1?")":`, ${t})`}`}}));function _s(t){return t=(t||0)%360,t<0?t+360:t}function Xn(t){return Math.max(0,Math.min(1,t||0))}function Lr(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const ra=t=>()=>t;function Ld(t,e){return function(n){return t+n*e}}function Dd(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Fd(t){return(t=+t)==1?ia:function(e,n){return n-e?Dd(e,n,t):ra(isNaN(e)?n:e)}}function ia(t,e){var n=e-t;return n?Ld(t,n):ra(isNaN(t)?e:t)}const Ss=function t(e){var n=Fd(e);function r(i,s){var o=n((i=ti(i)).r,(s=ti(s)).r),c=n(i.g,s.g),u=n(i.b,s.b),l=ia(i.opacity,s.opacity);return function(h){return i.r=o(h),i.g=c(h),i.b=u(h),i.opacity=l(h),i+""}}return r.gamma=t,r}(1);function we(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var ei=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Dr=new RegExp(ei.source,"g");function Vd(t){return function(){return t}}function Bd(t){return function(e){return t(e)+""}}function Hd(t,e){var n=ei.lastIndex=Dr.lastIndex=0,r,i,s,o=-1,c=[],u=[];for(t=t+"",e=e+"";(r=ei.exec(t))&&(i=Dr.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),c[o]?c[o]+=s:c[++o]=s),(r=r[0])===(i=i[0])?c[o]?c[o]+=i:c[++o]=i:(c[++o]=null,u.push({i:o,x:we(r,i)})),n=Dr.lastIndex;return n<e.length&&(s=e.slice(n),c[o]?c[o]+=s:c[++o]=s),c.length<2?u[0]?Bd(u[0].x):Vd(e):(e=u.length,function(l){for(var h=0,f;h<e;++h)c[(f=u[h]).i]=f.x(l);return c.join("")})}var Cs=180/Math.PI,ni={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function sa(t,e,n,r,i,s){var o,c,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(c=Math.sqrt(n*n+r*r))&&(n/=c,r/=c,u/=c),t*r<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*Cs,skewX:Math.atan(u)*Cs,scaleX:o,scaleY:c}}var Un;function Wd(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?ni:sa(e.a,e.b,e.c,e.d,e.e,e.f)}function Xd(t){return t==null||(Un||(Un=document.createElementNS("http://www.w3.org/2000/svg","g")),Un.setAttribute("transform",t),!(t=Un.transform.baseVal.consolidate()))?ni:(t=t.matrix,sa(t.a,t.b,t.c,t.d,t.e,t.f))}function oa(t,e,n,r){function i(l){return l.length?l.pop()+" ":""}function s(l,h,f,d,p,x){if(l!==f||h!==d){var m=p.push("translate(",null,e,null,n);x.push({i:m-4,x:we(l,f)},{i:m-2,x:we(h,d)})}else(f||d)&&p.push("translate("+f+e+d+n)}function o(l,h,f,d){l!==h?(l-h>180?h+=360:h-l>180&&(l+=360),d.push({i:f.push(i(f)+"rotate(",null,r)-2,x:we(l,h)})):h&&f.push(i(f)+"rotate("+h+r)}function c(l,h,f,d){l!==h?d.push({i:f.push(i(f)+"skewX(",null,r)-2,x:we(l,h)}):h&&f.push(i(f)+"skewX("+h+r)}function u(l,h,f,d,p,x){if(l!==f||h!==d){var m=p.push(i(p)+"scale(",null,",",null,")");x.push({i:m-4,x:we(l,f)},{i:m-2,x:we(h,d)})}else(f!==1||d!==1)&&p.push(i(p)+"scale("+f+","+d+")")}return function(l,h){var f=[],d=[];return l=t(l),h=t(h),s(l.translateX,l.translateY,h.translateX,h.translateY,f,d),o(l.rotate,h.rotate,f,d),c(l.skewX,h.skewX,f,d),u(l.scaleX,l.scaleY,h.scaleX,h.scaleY,f,d),l=h=null,function(p){for(var x=-1,m=d.length,v;++x<m;)f[(v=d[x]).i]=v.x(p);return f.join("")}}}var Ud=oa(Wd,"px, ","px)","deg)"),Gd=oa(Xd,", ",")",")"),qd=1e-12;function Ts(t){return((t=Math.exp(t))+1/t)/2}function Kd(t){return((t=Math.exp(t))-1/t)/2}function Yd(t){return((t=Math.exp(2*t))-1)/(t+1)}const Zd=function t(e,n,r){function i(s,o){var c=s[0],u=s[1],l=s[2],h=o[0],f=o[1],d=o[2],p=h-c,x=f-u,m=p*p+x*x,v,g;if(m<qd)g=Math.log(d/l)/e,v=function(_){return[c+_*p,u+_*x,l*Math.exp(e*_*g)]};else{var y=Math.sqrt(m),b=(d*d-l*l+r*m)/(2*l*n*y),w=(d*d-l*l-r*m)/(2*d*n*y),I=Math.log(Math.sqrt(b*b+1)-b),E=Math.log(Math.sqrt(w*w+1)-w);g=(E-I)/e,v=function(_){var S=_*g,A=Ts(I),k=l/(n*y)*(A*Yd(e*S+I)-Kd(I));return[c+k*p,u+k*x,l*A/Ts(e*S+I)]}}return v.duration=g*1e3*e/Math.SQRT2,v}return i.rho=function(s){var o=Math.max(.001,+s),c=o*o,u=c*c;return t(o,c,u)},i}(Math.SQRT2,2,4);var sn=0,mn=0,dn=0,aa=1e3,fr,gn,pr=0,Fe=0,Ir=0,Mn=typeof performance=="object"&&performance.now?performance:Date,la=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function _i(){return Fe||(la(Qd),Fe=Mn.now()+Ir)}function Qd(){Fe=0}function mr(){this._call=this._time=this._next=null}mr.prototype=Si.prototype={constructor:mr,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?_i():+n)+(e==null?0:+e),!this._next&&gn!==this&&(gn?gn._next=this:fr=this,gn=this),this._call=t,this._time=n,ri()},stop:function(){this._call&&(this._call=null,this._time=1/0,ri())}};function Si(t,e,n){var r=new mr;return r.restart(t,e,n),r}function Jd(){_i(),++sn;for(var t=fr,e;t;)(e=Fe-t._time)>=0&&t._call.call(void 0,e),t=t._next;--sn}function Is(){Fe=(pr=Mn.now())+Ir,sn=mn=0;try{Jd()}finally{sn=0,ef(),Fe=0}}function tf(){var t=Mn.now(),e=t-pr;e>aa&&(Ir-=e,pr=t)}function ef(){for(var t,e=fr,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:fr=n);gn=t,ri(r)}function ri(t){if(!sn){mn&&(mn=clearTimeout(mn));var e=t-Fe;e>24?(t<1/0&&(mn=setTimeout(Is,t-Mn.now()-Ir)),dn&&(dn=clearInterval(dn))):(dn||(pr=Mn.now(),dn=setInterval(tf,aa)),sn=1,la(Is))}}function ks(t,e,n){var r=new mr;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var nf=On("start","end","cancel","interrupt"),rf=[],ca=0,As=1,ii=2,Yn=3,Ps=4,si=5,Zn=6;function kr(t,e,n,r,i,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;sf(t,n,{name:e,index:r,group:i,on:nf,tween:rf,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:ca})}function Ci(t,e){var n=qt(t,e);if(n.state>ca)throw new Error("too late; already scheduled");return n}function Qt(t,e){var n=qt(t,e);if(n.state>Yn)throw new Error("too late; already running");return n}function qt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function sf(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=Si(s,0,n.time);function s(l){n.state=As,n.timer.restart(o,n.delay,n.time),n.delay<=l&&o(l-n.delay)}function o(l){var h,f,d,p;if(n.state!==As)return u();for(h in r)if(p=r[h],p.name===n.name){if(p.state===Yn)return ks(o);p.state===Ps?(p.state=Zn,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete r[h]):+h<e&&(p.state=Zn,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete r[h])}if(ks(function(){n.state===Yn&&(n.state=Ps,n.timer.restart(c,n.delay,n.time),c(l))}),n.state=ii,n.on.call("start",t,t.__data__,n.index,n.group),n.state===ii){for(n.state=Yn,i=new Array(d=n.tween.length),h=0,f=-1;h<d;++h)(p=n.tween[h].value.call(t,t.__data__,n.index,n.group))&&(i[++f]=p);i.length=f+1}}function c(l){for(var h=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(u),n.state=si,1),f=-1,d=i.length;++f<d;)i[f].call(t,h);n.state===si&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=Zn,n.timer.stop(),delete r[e];for(var l in r)return;delete t.__transition}}function Qn(t,e){var n=t.__transition,r,i,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){s=!1;continue}i=r.state>ii&&r.state<si,r.state=Zn,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}s&&delete t.__transition}}function of(t){return this.each(function(){Qn(this,t)})}function af(t,e){var n,r;return function(){var i=Qt(this,t),s=i.tween;if(s!==n){r=n=s;for(var o=0,c=r.length;o<c;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function lf(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=Qt(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var c={name:e,value:n},u=0,l=i.length;u<l;++u)if(i[u].name===e){i[u]=c;break}u===l&&i.push(c)}s.tween=i}}function cf(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=qt(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?af:lf)(n,t,e))}function Ti(t,e,n){var r=t._id;return t.each(function(){var i=Qt(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return qt(i,r).value[e]}}function ua(t,e){var n;return(typeof e=="number"?we:e instanceof Pn?Ss:(n=Pn(e))?(e=n,Ss):Hd)(t,e)}function uf(t){return function(){this.removeAttribute(t)}}function hf(t){return function(){this.removeAttributeNS(t.space,t.local)}}function df(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttribute(t);return o===i?null:o===r?s:s=e(r=o,n)}}function ff(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?s:s=e(r=o,n)}}function pf(t,e,n){var r,i,s;return function(){var o,c=n(this),u;return c==null?void this.removeAttribute(t):(o=this.getAttribute(t),u=c+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,c)))}}function mf(t,e,n){var r,i,s;return function(){var o,c=n(this),u;return c==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),u=c+"",o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,c)))}}function gf(t,e){var n=Tr(t),r=n==="transform"?Gd:ua;return this.attrTween(t,typeof e=="function"?(n.local?mf:pf)(n,r,Ti(this,"attr."+t,e)):e==null?(n.local?hf:uf)(n):(n.local?ff:df)(n,r,e))}function xf(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function vf(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function yf(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&vf(t,s)),n}return i._value=e,i}function wf(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&xf(t,s)),n}return i._value=e,i}function jf(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Tr(t);return this.tween(n,(r.local?yf:wf)(r,e))}function bf(t,e){return function(){Ci(this,t).delay=+e.apply(this,arguments)}}function _f(t,e){return e=+e,function(){Ci(this,t).delay=e}}function Sf(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?bf:_f)(e,t)):qt(this.node(),e).delay}function Cf(t,e){return function(){Qt(this,t).duration=+e.apply(this,arguments)}}function Tf(t,e){return e=+e,function(){Qt(this,t).duration=e}}function If(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Cf:Tf)(e,t)):qt(this.node(),e).duration}function kf(t,e){if(typeof e!="function")throw new Error;return function(){Qt(this,t).ease=e}}function Af(t){var e=this._id;return arguments.length?this.each(kf(e,t)):qt(this.node(),e).ease}function Pf(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Qt(this,t).ease=n}}function Mf(t){if(typeof t!="function")throw new Error;return this.each(Pf(this._id,t))}function Ef(t){typeof t!="function"&&(t=Ho(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,c=r[i]=[],u,l=0;l<o;++l)(u=s[l])&&t.call(u,u.__data__,l,s)&&c.push(u);return new he(r,this._parents,this._name,this._id)}function $f(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),c=0;c<s;++c)for(var u=e[c],l=n[c],h=u.length,f=o[c]=new Array(h),d,p=0;p<h;++p)(d=u[p]||l[p])&&(f[p]=d);for(;c<r;++c)o[c]=e[c];return new he(o,this._parents,this._name,this._id)}function zf(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Rf(t,e,n){var r,i,s=zf(e)?Ci:Qt;return function(){var o=s(this,t),c=o.on;c!==r&&(i=(r=c).copy()).on(e,n),o.on=i}}function Nf(t,e){var n=this._id;return arguments.length<2?qt(this.node(),n).on.on(t):this.each(Rf(n,t,e))}function Of(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Lf(){return this.on("end.remove",Of(this._id))}function Df(t){var e=this._name,n=this._id;typeof t!="function"&&(t=wi(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var c=r[o],u=c.length,l=s[o]=new Array(u),h,f,d=0;d<u;++d)(h=c[d])&&(f=t.call(h,h.__data__,d,c))&&("__data__"in h&&(f.__data__=h.__data__),l[d]=f,kr(l[d],e,n,d,l,qt(h,n)));return new he(s,this._parents,e,n)}function Ff(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Bo(t));for(var r=this._groups,i=r.length,s=[],o=[],c=0;c<i;++c)for(var u=r[c],l=u.length,h,f=0;f<l;++f)if(h=u[f]){for(var d=t.call(h,h.__data__,f,u),p,x=qt(h,n),m=0,v=d.length;m<v;++m)(p=d[m])&&kr(p,e,n,m,d,x);s.push(d),o.push(h)}return new he(s,o,e,n)}var Vf=Ln.prototype.constructor;function Bf(){return new Vf(this._groups,this._parents)}function Hf(t,e){var n,r,i;return function(){var s=rn(this,t),o=(this.style.removeProperty(t),rn(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}function ha(t){return function(){this.style.removeProperty(t)}}function Wf(t,e,n){var r,i=n+"",s;return function(){var o=rn(this,t);return o===i?null:o===r?s:s=e(r=o,n)}}function Xf(t,e,n){var r,i,s;return function(){var o=rn(this,t),c=n(this),u=c+"";return c==null&&(u=c=(this.style.removeProperty(t),rn(this,t))),o===u?null:o===r&&u===i?s:(i=u,s=e(r=o,c))}}function Uf(t,e){var n,r,i,s="style."+e,o="end."+s,c;return function(){var u=Qt(this,t),l=u.on,h=u.value[s]==null?c||(c=ha(e)):void 0;(l!==n||i!==h)&&(r=(n=l).copy()).on(o,i=h),u.on=r}}function Gf(t,e,n){var r=(t+="")=="transform"?Ud:ua;return e==null?this.styleTween(t,Hf(t,r)).on("end.style."+t,ha(t)):typeof e=="function"?this.styleTween(t,Xf(t,r,Ti(this,"style."+t,e))).each(Uf(this._id,t)):this.styleTween(t,Wf(t,r,e),n).on("end.style."+t,null)}function qf(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Kf(t,e,n){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&qf(t,o,n)),r}return s._value=e,s}function Yf(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Kf(t,e,n??""))}function Zf(t){return function(){this.textContent=t}}function Qf(t){return function(){var e=t(this);this.textContent=e??""}}function Jf(t){return this.tween("text",typeof t=="function"?Qf(Ti(this,"text",t)):Zf(t==null?"":t+""))}function t0(t){return function(e){this.textContent=t.call(this,e)}}function e0(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&t0(i)),e}return r._value=t,r}function n0(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,e0(t))}function r0(){for(var t=this._name,e=this._id,n=da(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],c=o.length,u,l=0;l<c;++l)if(u=o[l]){var h=qt(u,e);kr(u,t,n,l,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new he(r,this._parents,t,n)}function i0(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var c={value:o},u={value:function(){--i===0&&s()}};n.each(function(){var l=Qt(this,r),h=l.on;h!==t&&(e=(t=h).copy(),e._.cancel.push(c),e._.interrupt.push(c),e._.end.push(u)),l.on=e}),i===0&&s()})}var s0=0;function he(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function da(){return++s0}var ee=Ln.prototype;he.prototype={constructor:he,select:Df,selectAll:Ff,selectChild:ee.selectChild,selectChildren:ee.selectChildren,filter:Ef,merge:$f,selection:Bf,transition:r0,call:ee.call,nodes:ee.nodes,node:ee.node,size:ee.size,empty:ee.empty,each:ee.each,on:Nf,attr:gf,attrTween:jf,style:Gf,styleTween:Yf,text:Jf,textTween:n0,remove:Lf,tween:cf,delay:Sf,duration:If,ease:Af,easeVarying:Mf,end:i0,[Symbol.iterator]:ee[Symbol.iterator]};function o0(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var a0={time:null,delay:0,duration:250,ease:o0};function l0(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function c0(t){var e,n;t instanceof he?(e=t._id,t=t._name):(e=da(),(n=a0).time=_i(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],c=o.length,u,l=0;l<c;++l)(u=o[l])&&kr(u,t,e,l,o,n||l0(u,e));return new he(r,this._parents,t,e)}Ln.prototype.interrupt=of;Ln.prototype.transition=c0;const oi=Math.PI,ai=2*oi,ze=1e-6,u0=ai-ze;function fa(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function h0(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return fa;const n=10**e;return function(r){this._+=r[0];for(let i=1,s=r.length;i<s;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}class pa{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?fa:h0(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,i){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,n,r,i,s,o){this._append`C${+e},${+n},${+r},${+i},${this._x1=+s},${this._y1=+o}`}arcTo(e,n,r,i,s){if(e=+e,n=+n,r=+r,i=+i,s=+s,s<0)throw new Error(`negative radius: ${s}`);let o=this._x1,c=this._y1,u=r-e,l=i-n,h=o-e,f=c-n,d=h*h+f*f;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(d>ze)if(!(Math.abs(f*u-l*h)>ze)||!s)this._append`L${this._x1=e},${this._y1=n}`;else{let p=r-o,x=i-c,m=u*u+l*l,v=p*p+x*x,g=Math.sqrt(m),y=Math.sqrt(d),b=s*Math.tan((oi-Math.acos((m+d-v)/(2*g*y)))/2),w=b/y,I=b/g;Math.abs(w-1)>ze&&this._append`L${e+w*h},${n+w*f}`,this._append`A${s},${s},0,0,${+(f*p>h*x)},${this._x1=e+I*u},${this._y1=n+I*l}`}}arc(e,n,r,i,s,o){if(e=+e,n=+n,r=+r,o=!!o,r<0)throw new Error(`negative radius: ${r}`);let c=r*Math.cos(i),u=r*Math.sin(i),l=e+c,h=n+u,f=1^o,d=o?i-s:s-i;this._x1===null?this._append`M${l},${h}`:(Math.abs(this._x1-l)>ze||Math.abs(this._y1-h)>ze)&&this._append`L${l},${h}`,r&&(d<0&&(d=d%ai+ai),d>u0?this._append`A${r},${r},0,1,${f},${e-c},${n-u}A${r},${r},0,1,${f},${this._x1=l},${this._y1=h}`:d>ze&&this._append`A${r},${r},0,${+(d>=oi)},${f},${this._x1=e+r*Math.cos(s)},${this._y1=n+r*Math.sin(s)}`)}rect(e,n,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}function ne(){return new pa}ne.prototype=pa.prototype;function d0(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return ma(this.cover(e,n),e,n,t)}function ma(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s=t._root,o={data:r},c=t._x0,u=t._y0,l=t._x1,h=t._y1,f,d,p,x,m,v,g,y;if(!s)return t._root=o,t;for(;s.length;)if((m=e>=(f=(c+l)/2))?c=f:l=f,(v=n>=(d=(u+h)/2))?u=d:h=d,i=s,!(s=s[g=v<<1|m]))return i[g]=o,t;if(p=+t._x.call(null,s.data),x=+t._y.call(null,s.data),e===p&&n===x)return o.next=s,i?i[g]=o:t._root=o,t;do i=i?i[g]=new Array(4):t._root=new Array(4),(m=e>=(f=(c+l)/2))?c=f:l=f,(v=n>=(d=(u+h)/2))?u=d:h=d;while((g=v<<1|m)===(y=(x>=d)<<1|p>=f));return i[y]=s,i[g]=o,t}function f0(t){var e,n,r=t.length,i,s,o=new Array(r),c=new Array(r),u=1/0,l=1/0,h=-1/0,f=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=i,c[n]=s,i<u&&(u=i),i>h&&(h=i),s<l&&(l=s),s>f&&(f=s));if(u>h||l>f)return this;for(this.cover(u,l).cover(h,f),n=0;n<r;++n)ma(this,o[n],c[n],t[n]);return this}function p0(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o=i-n||1,c=this._root,u,l;n>t||t>=i||r>e||e>=s;)switch(l=(e<r)<<1|t<n,u=new Array(4),u[l]=c,c=u,o*=2,l){case 0:i=n+o,s=r+o;break;case 1:n=i-o,s=r+o;break;case 2:i=n+o,r=s-o;break;case 3:n=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this}function m0(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function g0(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Pt(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function x0(t,e,n){var r,i=this._x0,s=this._y0,o,c,u,l,h=this._x1,f=this._y1,d=[],p=this._root,x,m;for(p&&d.push(new Pt(p,i,s,h,f)),n==null?n=1/0:(i=t-n,s=e-n,h=t+n,f=e+n,n*=n);x=d.pop();)if(!(!(p=x.node)||(o=x.x0)>h||(c=x.y0)>f||(u=x.x1)<i||(l=x.y1)<s))if(p.length){var v=(o+u)/2,g=(c+l)/2;d.push(new Pt(p[3],v,g,u,l),new Pt(p[2],o,g,v,l),new Pt(p[1],v,c,u,g),new Pt(p[0],o,c,v,g)),(m=(e>=g)<<1|t>=v)&&(x=d[d.length-1],d[d.length-1]=d[d.length-1-m],d[d.length-1-m]=x)}else{var y=t-+this._x.call(null,p.data),b=e-+this._y.call(null,p.data),w=y*y+b*b;if(w<n){var I=Math.sqrt(n=w);i=t-I,s=e-I,h=t+I,f=e+I,r=p.data}}return r}function v0(t){if(isNaN(h=+this._x.call(null,t))||isNaN(f=+this._y.call(null,t)))return this;var e,n=this._root,r,i,s,o=this._x0,c=this._y0,u=this._x1,l=this._y1,h,f,d,p,x,m,v,g;if(!n)return this;if(n.length)for(;;){if((x=h>=(d=(o+u)/2))?o=d:u=d,(m=f>=(p=(c+l)/2))?c=p:l=p,e=n,!(n=n[v=m<<1|x]))return this;if(!n.length)break;(e[v+1&3]||e[v+2&3]||e[v+3&3])&&(r=e,g=v)}for(;n.data!==t;)if(i=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,i?(s?i.next=s:delete i.next,this):e?(s?e[v]=s:delete e[v],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(r?r[g]=n:this._root=n),this):(this._root=s,this)}function y0(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function w0(){return this._root}function j0(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function b0(t){var e=[],n,r=this._root,i,s,o,c,u;for(r&&e.push(new Pt(r,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(r=n.node,s=n.x0,o=n.y0,c=n.x1,u=n.y1)&&r.length){var l=(s+c)/2,h=(o+u)/2;(i=r[3])&&e.push(new Pt(i,l,h,c,u)),(i=r[2])&&e.push(new Pt(i,s,h,l,u)),(i=r[1])&&e.push(new Pt(i,l,o,c,h)),(i=r[0])&&e.push(new Pt(i,s,o,l,h))}return this}function _0(t){var e=[],n=[],r;for(this._root&&e.push(new Pt(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,c=r.y0,u=r.x1,l=r.y1,h=(o+u)/2,f=(c+l)/2;(s=i[0])&&e.push(new Pt(s,o,c,h,f)),(s=i[1])&&e.push(new Pt(s,h,c,u,f)),(s=i[2])&&e.push(new Pt(s,o,f,h,l)),(s=i[3])&&e.push(new Pt(s,h,f,u,l))}n.push(r)}for(;r=n.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function S0(t){return t[0]}function C0(t){return arguments.length?(this._x=t,this):this._x}function T0(t){return t[1]}function I0(t){return arguments.length?(this._y=t,this):this._y}function Ii(t,e,n){var r=new ki(e??S0,n??T0,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function ki(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function Ms(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Et=Ii.prototype=ki.prototype;Et.copy=function(){var t=new ki(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,r;if(!e)return t;if(!e.length)return t._root=Ms(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var i=0;i<4;++i)(r=e.source[i])&&(r.length?n.push({source:r,target:e.target[i]=new Array(4)}):e.target[i]=Ms(r));return t};Et.add=d0;Et.addAll=f0;Et.cover=p0;Et.data=m0;Et.extent=g0;Et.find=x0;Et.remove=v0;Et.removeAll=y0;Et.root=w0;Et.size=j0;Et.visit=b0;Et.visitAfter=_0;Et.x=C0;Et.y=I0;function Wt(t){return function(){return t}}function qe(t){return(t()-.5)*1e-6}function k0(t){return t.x+t.vx}function A0(t){return t.y+t.vy}function P0(t){var e,n,r,i=1,s=1;typeof t!="function"&&(t=Wt(t==null?1:+t));function o(){for(var l,h=e.length,f,d,p,x,m,v,g=0;g<s;++g)for(f=Ii(e,k0,A0).visitAfter(c),l=0;l<h;++l)d=e[l],m=n[d.index],v=m*m,p=d.x+d.vx,x=d.y+d.vy,f.visit(y);function y(b,w,I,E,_){var S=b.data,A=b.r,k=m+A;if(S){if(S.index>d.index){var P=p-S.x-S.vx,R=x-S.y-S.vy,$=P*P+R*R;$<k*k&&(P===0&&(P=qe(r),$+=P*P),R===0&&(R=qe(r),$+=R*R),$=(k-($=Math.sqrt($)))/$*i,d.vx+=(P*=$)*(k=(A*=A)/(v+A)),d.vy+=(R*=$)*k,S.vx-=P*(k=1-k),S.vy-=R*k)}return}return w>p+k||E<p-k||I>x+k||_<x-k}}function c(l){if(l.data)return l.r=n[l.data.index];for(var h=l.r=0;h<4;++h)l[h]&&l[h].r>l.r&&(l.r=l[h].r)}function u(){if(e){var l,h=e.length,f;for(n=new Array(h),l=0;l<h;++l)f=e[l],n[f.index]=+t(f,l,e)}}return o.initialize=function(l,h){e=l,r=h,u()},o.iterations=function(l){return arguments.length?(s=+l,o):s},o.strength=function(l){return arguments.length?(i=+l,o):i},o.radius=function(l){return arguments.length?(t=typeof l=="function"?l:Wt(+l),u(),o):t},o}const M0=1664525,E0=1013904223,Es=4294967296;function $0(){let t=1;return()=>(t=(M0*t+E0)%Es)/Es}function z0(t){return t.x}function R0(t){return t.y}var N0=10,O0=Math.PI*(3-Math.sqrt(5));function L0(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,c=new Map,u=Si(f),l=On("tick","end"),h=$0();t==null&&(t=[]);function f(){d(),l.call("tick",e),n<r&&(u.stop(),l.call("end",e))}function d(m){var v,g=t.length,y;m===void 0&&(m=1);for(var b=0;b<m;++b)for(n+=(s-n)*i,c.forEach(function(w){w(n)}),v=0;v<g;++v)y=t[v],y.fx==null?y.x+=y.vx*=o:(y.x=y.fx,y.vx=0),y.fy==null?y.y+=y.vy*=o:(y.y=y.fy,y.vy=0);return e}function p(){for(var m=0,v=t.length,g;m<v;++m){if(g=t[m],g.index=m,g.fx!=null&&(g.x=g.fx),g.fy!=null&&(g.y=g.fy),isNaN(g.x)||isNaN(g.y)){var y=N0*Math.sqrt(.5+m),b=m*O0;g.x=y*Math.cos(b),g.y=y*Math.sin(b)}(isNaN(g.vx)||isNaN(g.vy))&&(g.vx=g.vy=0)}}function x(m){return m.initialize&&m.initialize(t,h),m}return p(),e={tick:d,restart:function(){return u.restart(f),e},stop:function(){return u.stop(),e},nodes:function(m){return arguments.length?(t=m,p(),c.forEach(x),e):t},alpha:function(m){return arguments.length?(n=+m,e):n},alphaMin:function(m){return arguments.length?(r=+m,e):r},alphaDecay:function(m){return arguments.length?(i=+m,e):+i},alphaTarget:function(m){return arguments.length?(s=+m,e):s},velocityDecay:function(m){return arguments.length?(o=1-m,e):1-o},randomSource:function(m){return arguments.length?(h=m,c.forEach(x),e):h},force:function(m,v){return arguments.length>1?(v==null?c.delete(m):c.set(m,x(v)),e):c.get(m)},find:function(m,v,g){var y=0,b=t.length,w,I,E,_,S;for(g==null?g=1/0:g*=g,y=0;y<b;++y)_=t[y],w=m-_.x,I=v-_.y,E=w*w+I*I,E<g&&(S=_,g=E);return S},on:function(m,v){return arguments.length>1?(l.on(m,v),e):l.on(m)}}}function D0(){var t,e,n,r,i=Wt(-30),s,o=1,c=1/0,u=.81;function l(p){var x,m=t.length,v=Ii(t,z0,R0).visitAfter(f);for(r=p,x=0;x<m;++x)e=t[x],v.visit(d)}function h(){if(t){var p,x=t.length,m;for(s=new Array(x),p=0;p<x;++p)m=t[p],s[m.index]=+i(m,p,t)}}function f(p){var x=0,m,v,g=0,y,b,w;if(p.length){for(y=b=w=0;w<4;++w)(m=p[w])&&(v=Math.abs(m.value))&&(x+=m.value,g+=v,y+=v*m.x,b+=v*m.y);p.x=y/g,p.y=b/g}else{m=p,m.x=m.data.x,m.y=m.data.y;do x+=s[m.data.index];while(m=m.next)}p.value=x}function d(p,x,m,v){if(!p.value)return!0;var g=p.x-e.x,y=p.y-e.y,b=v-x,w=g*g+y*y;if(b*b/u<w)return w<c&&(g===0&&(g=qe(n),w+=g*g),y===0&&(y=qe(n),w+=y*y),w<o&&(w=Math.sqrt(o*w)),e.vx+=g*p.value*r/w,e.vy+=y*p.value*r/w),!0;if(p.length||w>=c)return;(p.data!==e||p.next)&&(g===0&&(g=qe(n),w+=g*g),y===0&&(y=qe(n),w+=y*y),w<o&&(w=Math.sqrt(o*w)));do p.data!==e&&(b=s[p.data.index]*r/w,e.vx+=g*b,e.vy+=y*b);while(p=p.next)}return l.initialize=function(p,x){t=p,n=x,h()},l.strength=function(p){return arguments.length?(i=typeof p=="function"?p:Wt(+p),h(),l):i},l.distanceMin=function(p){return arguments.length?(o=p*p,l):Math.sqrt(o)},l.distanceMax=function(p){return arguments.length?(c=p*p,l):Math.sqrt(c)},l.theta=function(p){return arguments.length?(u=p*p,l):Math.sqrt(u)},l}function F0(t){var e=Wt(.1),n,r,i;typeof t!="function"&&(t=Wt(t==null?0:+t));function s(c){for(var u=0,l=n.length,h;u<l;++u)h=n[u],h.vx+=(i[u]-h.x)*r[u]*c}function o(){if(n){var c,u=n.length;for(r=new Array(u),i=new Array(u),c=0;c<u;++c)r[c]=isNaN(i[c]=+t(n[c],c,n))?0:+e(n[c],c,n)}}return s.initialize=function(c){n=c,o()},s.strength=function(c){return arguments.length?(e=typeof c=="function"?c:Wt(+c),o(),s):e},s.x=function(c){return arguments.length?(t=typeof c=="function"?c:Wt(+c),o(),s):t},s}function V0(t){var e=Wt(.1),n,r,i;typeof t!="function"&&(t=Wt(t==null?0:+t));function s(c){for(var u=0,l=n.length,h;u<l;++u)h=n[u],h.vy+=(i[u]-h.y)*r[u]*c}function o(){if(n){var c,u=n.length;for(r=new Array(u),i=new Array(u),c=0;c<u;++c)r[c]=isNaN(i[c]=+t(n[c],c,n))?0:+e(n[c],c,n)}}return s.initialize=function(c){n=c,o()},s.strength=function(c){return arguments.length?(e=typeof c=="function"?c:Wt(+c),o(),s):e},s.y=function(c){return arguments.length?(t=typeof c=="function"?c:Wt(+c),o(),s):t},s}const Gn=t=>()=>t;function B0(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function le(t,e,n){this.k=t,this.x=e,this.y=n}le.prototype={constructor:le,scale:function(t){return t===1?this:new le(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new le(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ar=new le(1,0,0);ga.prototype=le.prototype;function ga(t){for(;!t.__zoom;)if(!(t=t.parentNode))return Ar;return t.__zoom}function Fr(t){t.stopImmediatePropagation()}function fn(t){t.preventDefault(),t.stopImmediatePropagation()}function H0(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function W0(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function $s(){return this.__zoom||Ar}function X0(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function U0(){return navigator.maxTouchPoints||"ontouchstart"in this}function G0(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function q0(){var t=H0,e=W0,n=G0,r=X0,i=U0,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],c=250,u=Zd,l=On("start","zoom","end"),h,f,d,p=500,x=150,m=0,v=10;function g(j){j.property("__zoom",$s).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",A).on("dblclick.zoom",k).filter(i).on("touchstart.zoom",P).on("touchmove.zoom",R).on("touchend.zoom touchcancel.zoom",$).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}g.transform=function(j,T,C,M){var O=j.selection?j.selection():j;O.property("__zoom",$s),j!==O?I(j,T,C,M):O.interrupt().each(function(){E(this,arguments).event(M).start().zoom(null,typeof T=="function"?T.apply(this,arguments):T).end()})},g.scaleBy=function(j,T,C,M){g.scaleTo(j,function(){var O=this.__zoom.k,V=typeof T=="function"?T.apply(this,arguments):T;return O*V},C,M)},g.scaleTo=function(j,T,C,M){g.transform(j,function(){var O=e.apply(this,arguments),V=this.__zoom,F=C==null?w(O):typeof C=="function"?C.apply(this,arguments):C,H=V.invert(F),Y=typeof T=="function"?T.apply(this,arguments):T;return n(b(y(V,Y),F,H),O,o)},C,M)},g.translateBy=function(j,T,C,M){g.transform(j,function(){return n(this.__zoom.translate(typeof T=="function"?T.apply(this,arguments):T,typeof C=="function"?C.apply(this,arguments):C),e.apply(this,arguments),o)},null,M)},g.translateTo=function(j,T,C,M,O){g.transform(j,function(){var V=e.apply(this,arguments),F=this.__zoom,H=M==null?w(V):typeof M=="function"?M.apply(this,arguments):M;return n(Ar.translate(H[0],H[1]).scale(F.k).translate(typeof T=="function"?-T.apply(this,arguments):-T,typeof C=="function"?-C.apply(this,arguments):-C),V,o)},M,O)};function y(j,T){return T=Math.max(s[0],Math.min(s[1],T)),T===j.k?j:new le(T,j.x,j.y)}function b(j,T,C){var M=T[0]-C[0]*j.k,O=T[1]-C[1]*j.k;return M===j.x&&O===j.y?j:new le(j.k,M,O)}function w(j){return[(+j[0][0]+ +j[1][0])/2,(+j[0][1]+ +j[1][1])/2]}function I(j,T,C,M){j.on("start.zoom",function(){E(this,arguments).event(M).start()}).on("interrupt.zoom end.zoom",function(){E(this,arguments).event(M).end()}).tween("zoom",function(){var O=this,V=arguments,F=E(O,V).event(M),H=e.apply(O,V),Y=C==null?w(H):typeof C=="function"?C.apply(O,V):C,N=Math.max(H[1][0]-H[0][0],H[1][1]-H[0][1]),L=O.__zoom,U=typeof T=="function"?T.apply(O,V):T,G=u(L.invert(Y).concat(N/L.k),U.invert(Y).concat(N/U.k));return function(q){if(q===1)q=U;else{var Z=G(q),rt=N/Z[2];q=new le(rt,Y[0]-Z[0]*rt,Y[1]-Z[1]*rt)}F.zoom(null,q)}})}function E(j,T,C){return!C&&j.__zooming||new _(j,T)}function _(j,T){this.that=j,this.args=T,this.active=0,this.sourceEvent=null,this.extent=e.apply(j,T),this.taps=0}_.prototype={event:function(j){return j&&(this.sourceEvent=j),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(j,T){return this.mouse&&j!=="mouse"&&(this.mouse[1]=T.invert(this.mouse[0])),this.touch0&&j!=="touch"&&(this.touch0[1]=T.invert(this.touch0[0])),this.touch1&&j!=="touch"&&(this.touch1[1]=T.invert(this.touch1[0])),this.that.__zoom=T,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(j){var T=Ht(this.that).datum();l.call(j,this.that,new B0(j,{sourceEvent:this.sourceEvent,target:g,transform:this.that.__zoom,dispatch:l}),T)}};function S(j,...T){if(!t.apply(this,arguments))return;var C=E(this,T).event(j),M=this.__zoom,O=Math.max(s[0],Math.min(s[1],M.k*Math.pow(2,r.apply(this,arguments)))),V=re(j);if(C.wheel)(C.mouse[0][0]!==V[0]||C.mouse[0][1]!==V[1])&&(C.mouse[1]=M.invert(C.mouse[0]=V)),clearTimeout(C.wheel);else{if(M.k===O)return;C.mouse=[V,M.invert(V)],Qn(this),C.start()}fn(j),C.wheel=setTimeout(F,x),C.zoom("mouse",n(b(y(M,O),C.mouse[0],C.mouse[1]),C.extent,o));function F(){C.wheel=null,C.end()}}function A(j,...T){if(d||!t.apply(this,arguments))return;var C=j.currentTarget,M=E(this,T,!0).event(j),O=Ht(j.view).on("mousemove.zoom",Y,!0).on("mouseup.zoom",N,!0),V=re(j,C),F=j.clientX,H=j.clientY;Jo(j.view),Fr(j),M.mouse=[V,this.__zoom.invert(V)],Qn(this),M.start();function Y(L){if(fn(L),!M.moved){var U=L.clientX-F,G=L.clientY-H;M.moved=U*U+G*G>m}M.event(L).zoom("mouse",n(b(M.that.__zoom,M.mouse[0]=re(L,C),M.mouse[1]),M.extent,o))}function N(L){O.on("mousemove.zoom mouseup.zoom",null),ta(L.view,M.moved),fn(L),M.event(L).end()}}function k(j,...T){if(t.apply(this,arguments)){var C=this.__zoom,M=re(j.changedTouches?j.changedTouches[0]:j,this),O=C.invert(M),V=C.k*(j.shiftKey?.5:2),F=n(b(y(C,V),M,O),e.apply(this,T),o);fn(j),c>0?Ht(this).transition().duration(c).call(I,F,M,j):Ht(this).call(g.transform,F,M,j)}}function P(j,...T){if(t.apply(this,arguments)){var C=j.touches,M=C.length,O=E(this,T,j.changedTouches.length===M).event(j),V,F,H,Y;for(Fr(j),F=0;F<M;++F)H=C[F],Y=re(H,this),Y=[Y,this.__zoom.invert(Y),H.identifier],O.touch0?!O.touch1&&O.touch0[2]!==Y[2]&&(O.touch1=Y,O.taps=0):(O.touch0=Y,V=!0,O.taps=1+!!h);h&&(h=clearTimeout(h)),V&&(O.taps<2&&(f=Y[0],h=setTimeout(function(){h=null},p)),Qn(this),O.start())}}function R(j,...T){if(this.__zooming){var C=E(this,T).event(j),M=j.changedTouches,O=M.length,V,F,H,Y;for(fn(j),V=0;V<O;++V)F=M[V],H=re(F,this),C.touch0&&C.touch0[2]===F.identifier?C.touch0[0]=H:C.touch1&&C.touch1[2]===F.identifier&&(C.touch1[0]=H);if(F=C.that.__zoom,C.touch1){var N=C.touch0[0],L=C.touch0[1],U=C.touch1[0],G=C.touch1[1],q=(q=U[0]-N[0])*q+(q=U[1]-N[1])*q,Z=(Z=G[0]-L[0])*Z+(Z=G[1]-L[1])*Z;F=y(F,Math.sqrt(q/Z)),H=[(N[0]+U[0])/2,(N[1]+U[1])/2],Y=[(L[0]+G[0])/2,(L[1]+G[1])/2]}else if(C.touch0)H=C.touch0[0],Y=C.touch0[1];else return;C.zoom("touch",n(b(F,H,Y),C.extent,o))}}function $(j,...T){if(this.__zooming){var C=E(this,T).event(j),M=j.changedTouches,O=M.length,V,F;for(Fr(j),d&&clearTimeout(d),d=setTimeout(function(){d=null},p),V=0;V<O;++V)F=M[V],C.touch0&&C.touch0[2]===F.identifier?delete C.touch0:C.touch1&&C.touch1[2]===F.identifier&&delete C.touch1;if(C.touch1&&!C.touch0&&(C.touch0=C.touch1,delete C.touch1),C.touch0)C.touch0[1]=this.__zoom.invert(C.touch0[0]);else if(C.end(),C.taps===2&&(F=re(F,this),Math.hypot(f[0]-F[0],f[1]-F[1])<v)){var H=Ht(this).on("dblclick.zoom");H&&H.apply(this,arguments)}}}return g.wheelDelta=function(j){return arguments.length?(r=typeof j=="function"?j:Gn(+j),g):r},g.filter=function(j){return arguments.length?(t=typeof j=="function"?j:Gn(!!j),g):t},g.touchable=function(j){return arguments.length?(i=typeof j=="function"?j:Gn(!!j),g):i},g.extent=function(j){return arguments.length?(e=typeof j=="function"?j:Gn([[+j[0][0],+j[0][1]],[+j[1][0],+j[1][1]]]),g):e},g.scaleExtent=function(j){return arguments.length?(s[0]=+j[0],s[1]=+j[1],g):[s[0],s[1]]},g.translateExtent=function(j){return arguments.length?(o[0][0]=+j[0][0],o[1][0]=+j[1][0],o[0][1]=+j[0][1],o[1][1]=+j[1][1],g):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},g.constrain=function(j){return arguments.length?(n=j,g):n},g.duration=function(j){return arguments.length?(c=+j,g):c},g.interpolate=function(j){return arguments.length?(u=j,g):u},g.on=function(){var j=l.on.apply(l,arguments);return j===l?g:j},g.clickDistance=function(j){return arguments.length?(m=(j=+j)*j,g):Math.sqrt(m)},g.tapDistance=function(j){return arguments.length?(v=+j,g):v},g}const pt=30;let K0=class xn{constructor(e,n,r){xe(this,"_svg");xe(this,"_content");xe(this,"_zoom");xe(this,"_proteinsSelection");xe(this,"_interproteinCrosslinksSelection");xe(this,"_classNames");xe(this,"_data",{proteins:[],crosslinks:[]});this._svg=Ht(e),this._svg.selectChildren().remove(),this._content=this._svg.append("g"),this._zoom=q0().scaleExtent([.01,3]).on("zoom",({transform:i})=>this._content.attr("transform",i)).filter(i=>i.type==="wheel"?i.ctrlKey:!0),this._svg.call(this._zoom),this._proteinsSelection=this._content.append("g").selectAll("g"),this._interproteinCrosslinksSelection=this._content.append("g").selectAll("path"),this._classNames=n,r&&this.updateData(r,0,!1)}updateData(e,n,r){this._data={proteins:e.proteins.map(i=>({...this._data.proteins.find(({id:s})=>s===i.id),...i})),crosslinks:e.crosslinks},this._simulateProteinsPositions(),this._proteinsSelection=this._proteinsSelection.data(this._data.proteins,({id:i})=>i).join(i=>{const s=i.append("g").attr("id",({id:o})=>`protein-${o}`).attr("transform",o=>`translate(${xn._getProteinPosition(o).join()})`).call(Cd().subject(()=>this).on("start",xn._proteinDragStarted)).call(Vr);return s.append("rect").classed(this._classNames.protein,!0).attr("width",({length:o})=>o).attr("height",pt),s.selectAll(`rect.${this._classNames.domain}`).data(o=>o.domains??[]).join("rect").classed(this._classNames.domain,!0).attr("x",({startPosition:o})=>o).attr("y",0).attr("width",({startPosition:o,endPosition:c})=>c-o).attr("height",pt),s.selectAll(`text.${this._classNames.domain}`).data(o=>o.domains??[]).join("text").classed(this._classNames.domain,!0).attr("x",({startPosition:o})=>o).attr("y",pt).attr("dominant-baseline","text-before-edge").attr("text-anchor","start").text(({name:o})=>o),s.append("path").classed(this._classNames.known_protein_borders,!0).attr("d",({length:o,isEstimatedLength:c})=>{const u=ne();return u.moveTo(o,0),u.lineTo(0,0),u.lineTo(0,pt),u.lineTo(o,pt),c||u.closePath(),u.toString()}),s.append("path").classed(this._classNames.unknown_protein_borders,!0).attr("d",({isEstimatedLength:o,length:c})=>{const u=ne();return o&&(u.moveTo(c,0),u.lineTo(c,pt)),u.toString()}),s.append("text").classed(this._classNames.protein_name,!0).attr("x",-20).attr("y",pt/2).attr("dominant-baseline","central").attr("text-anchor","end").text(({name:o})=>o),s.append("g").attr("id","xlinks"),s},i=>(i.select(`rect.${this._classNames.protein}`).attr("width",({length:s})=>s),i.selectAll(`rect.${this._classNames.domain}`).data(s=>s.domains??[]).join("rect").classed(this._classNames.domain,!0).attr("x",({startPosition:s})=>s).attr("y",0).attr("width",({startPosition:s,endPosition:o})=>o-s).attr("height",pt),i.selectAll(`text.${this._classNames.domain}`).data(s=>s.domains??[]).join("text").classed(this._classNames.domain,!0).attr("x",({startPosition:s})=>s).attr("y",pt).attr("dominant-baseline","text-before-edge").attr("text-anchor","start").text(({name:s})=>s),i.select(`path.${this._classNames.known_protein_borders}`).attr("d",({length:s,isEstimatedLength:o})=>{const c=ne();return c.moveTo(s,0),c.lineTo(0,0),c.lineTo(0,pt),c.lineTo(s,pt),o||c.closePath(),c.toString()}),i.select(`path.${this._classNames.unknown_protein_borders}`).attr("d",({isEstimatedLength:s,length:o})=>{const c=ne();return s&&(c.moveTo(o,0),c.lineTo(o,pt)),c.toString()}),i.select(`text.${this._classNames.protein_name}`).text(({name:s})=>s),i));for(const i of this._data.proteins)Ht(`#protein-${i.id}`).select("#xlinks").selectAll("path").data(this._data.crosslinks.filter(({fromProtein:s,toProtein:o})=>s===i.id&&o===i.id),({id:s})=>s).join(s=>s.append("path").classed(this._classNames.xlinks,!0).classed(this._classNames.intraprotein,!0).attr("d",({fromPosition:o,toPosition:c})=>{const u=ne();return u.moveTo(o,pt/2),u.lineTo(o,-30/2),u.bezierCurveTo(o,-40-.2*(c-o),c,-40-.2*(c-o),c,-30/2),u.lineTo(c,pt/2),u.toString()}).call(Vr),s=>(s.select(`path.${this._classNames.xlinks}.${this._classNames.intraprotein}`).attr("d",({fromPosition:o,toPosition:c})=>{const u=ne();return u.moveTo(o,pt/2),u.lineTo(o,-30/2),u.bezierCurveTo(o,-40-.2*(c-o),c,-40-.2*(c-o),c,-30/2),u.lineTo(c,pt/2),u.toString()}),s));this._interproteinCrosslinksSelection=this._interproteinCrosslinksSelection.data(this._data.crosslinks.filter(({fromProtein:i,toProtein:s})=>i!==s),({id:i})=>i).join(i=>i.append("path").classed(this._classNames.xlinks,!0).classed(this._classNames.interprotein,!0).attr("pointer-events","none").call(Vr),i=>(i.select(`path.${this._classNames.xlinks}.${this._classNames.interprotein}`).attr("d",({fromPosition:s,toPosition:o})=>{const c=ne();return c.moveTo(s,pt/2),c.lineTo(s,-30/2),c.bezierCurveTo(s,-40-.2*(o-s),o,-40-.2*(o-s),o,-30/2),c.lineTo(o,pt/2),c.toString()}),i)),this._redrawCrosslinks(),this.zoomToFit(void 0,n,r)}zoomToFit(e,n=100,r=!1,i=0){e||(e=this._content.node().getBBox());const s=this._svg.node().getBoundingClientRect(),o=this._zoom.scaleExtent(),c=r?ga(this._svg.node()).k:o[1],u=Ar.scale(Math.max(o[0],Math.min(c,s.width/(e.width+i),s.height/(e.height+i)))).translate(-(e.x+e.width/2),-(e.y+e.height/2));this._svg.transition().duration(n).call(this._zoom.transform,u)}_simulateProteinsPositions(){const e=L0(this._data.proteins).stop().force("collide",P0(({length:n})=>n/2)).force("x",F0().strength(.01)).force("y",V0().strength(.01)).force("charge",D0());e.tick(Math.ceil(Math.log(e.alphaMin())/Math.log(1-e.alphaDecay())));for(const n of this._data.proteins)n.fx=n.x,n.fy=n.y,n.vx=void 0,n.vy=void 0}static _getProteinPosition({x:e,y:n,length:r}){return[(e??0)-r/2,(n??0)-pt/2]}_redrawCrosslinks(){const e=Object.fromEntries(this._data.proteins.map(n=>[n.id,xn._getProteinPosition(n)]));this._interproteinCrosslinksSelection.attr("d",({fromProtein:n,fromPosition:r,toProtein:i,toPosition:s})=>{if(!(n in e)||!(i in e))return null;const[o,c]=e[n],[u,l]=e[i],h=ne();return h.moveTo(o+r,c+pt/2),h.lineTo(u+s,l+pt/2),h.toString()})}static _proteinDragStarted(e){const n=e.subject._classNames.dragging,r=Ht(this).classed(n,!0);e.on("drag",(i,s)=>{s.x=s.fx=(s.x??0)+i.dx,s.y=s.fy=(s.y??0)+i.dy,r.raise().attr("transform",o=>`translate(${xn._getProteinPosition(o).join()})`),i.subject._redrawCrosslinks()}).on("end",()=>r.classed(n,!1))}};const Vr=t=>t.style("opacity",0).transition().duration(100).style("opacity",1),Y0="_grid_1orqa_1",Z0="_protein_1orqa_9",Q0="_domain_1orqa_13",J0="_known_protein_borders_1orqa_22",tp="_unknown_protein_borders_1orqa_23",ep="_dragging_1orqa_34",np="_xlinks_1orqa_39",rp="_intraprotein_1orqa_44",ip="_interprotein_1orqa_48",sp="_protein_name_1orqa_52",zs={grid:Y0,protein:Z0,domain:Q0,known_protein_borders:J0,unknown_protein_borders:tp,dragging:ep,xlinks:np,intraprotein:rp,interprotein:ip,protein_name:sp},op=({experiment:t,visibleCrosslinkIds:e})=>{const n=ot(null),r=ot(null),i=W(()=>({proteins:t.proteins.map(s=>{var o,c;return{id:s.id,name:s.name,length:((o=s.sequence)==null?void 0:o.length)??50+Math.max(0,...t.crosslinks.flatMap(({from:u,to:l})=>[...u.proteinId===s.id&&u.linkPosition?[u.linkPosition]:[],...l.proteinId===s.id&&l.linkPosition?[l.linkPosition]:[]])),isEstimatedLength:s.sequence===void 0,domains:((c=s.domains)==null?void 0:c.map(u=>u))??[]}}),crosslinks:t.crosslinks.flatMap(s=>s.from.linkPosition!==void 0&&s.to.linkPosition!==void 0&&e.has(s.id)?[{id:s.id,fromProtein:s.from.proteinId,fromPosition:s.from.linkPosition,toProtein:s.to.proteinId,toPosition:s.to.linkPosition}]:[])}),[t,e]);return Gt(()=>{r.current?r.current.updateData(i):n.current&&(r.current=new K0(n.current,zs,i))},[i]),a.jsx("svg",{className:zs.grid,width:"100%",height:"300px",viewBox:"-250 -250 500 500",ref:n})},ap=t=>Object.entries(t).forEach(([e,n])=>n&&ar(e,!1,new Set(n))),lp=it(({experiment:t,ref:e,...n})=>{const{experimentIdToThresholds:r,aminoAcidsMustMatch:i}=St(D),s=r[t.id],[o,c]=Qc(t),u=Oc(t),l=W(()=>new Set(u.crosslinks.filter(({from:y,to:b})=>y.linkPosition===void 0||b.linkPosition===void 0).map(({id:y})=>y)),[u.crosslinks]),h=W(()=>o.some(({loading:y})=>y),[o]),f=W(()=>pi(o,u.crosslinks,i,s),[o,u.crosslinks,i,s]),d=W(()=>new Set(t.crosslinks.map(({id:y})=>y)),[t.crosslinks]),{experimentIdToVisibleCrosslinkIds:p,groupDuplicatedCrosslinks:x}=St(D),m=p[t.id],v=W(()=>[{experiment:u,structureToXlinkIdToStatus:f,visibleCrosslinkIds:m,groupedStructureIds:c}],[u,f,m,c]),g=nt(()=>Xc(t.id),[t.id]);return a.jsx(a.Fragment,{children:a.jsxs(De,{ref:e,...n,children:[a.jsx(zn,{maxW:"5xl",children:a.jsxs(De,{gap:5,children:[a.jsx(Uc,{experiment:t,resolvedExperiment:u}),a.jsx(op,{experiment:u,visibleCrosslinkIds:m}),a.jsx(Gc,{w:"fit-content",experimentId:t.id,structureToXlinkIdToStatus:h?"loading":f,allCrosslinkIds:d,visibleCrosslinkIds:m,unmappedCrosslinkIds:l,numOfDistanceConstraints:(s!=null&&s.lower?1:0)+(s!=null&&s.upper?1:0)}),a.jsx(fc,{experimentId:t.id,thresholds:s})]})}),a.jsx(Fo,{experiments:v,structures:o,groupDuplicates:x,resetFilters:g,hideCrosslinks:ap})]})})}),Ai=it(({children:t,hideButtonUnlessHover:e=!1,hideButtonUnlessSelected:n=!1,buttonProps:r,ref:i,...s})=>{const o=W(()=>!e&&!n?null:{opacity:0,...e?{_hover:{opacity:1},_peerHover:{opacity:1}}:{},...n?{css:{".peer:is([aria-selected=true], [data-selected]) ~ &":{opacity:1}}}:{}},[e,n]);return a.jsxs(at,{children:[a.jsx(ve.Trigger,{pr:`${.75+2}rem`,className:"peer",flexGrow:1,justifyContent:"center",ref:i,...s,children:t}),a.jsx(Be,{size:"2xs",alignSelf:"center",variant:"ghost",colorPalette:"bg",ml:"-2rem",mr:"0.5rem",...o,...r})]})}),cp=it(({experimentId:t,experimentName:e,ref:n,...r})=>{const i=yr({defaultValue:e,placeholder:{preview:"File",edit:""},onValueCommit:({value:s})=>{if(!(s.trim()===""?void 0:s.trim())){e&&i.setValue(e);return}const c=D.experiments.find(({id:u})=>u===t);c&&(c.name=s)},activationMode:"dblclick",autoResize:!0});return a.jsxs(Qe,{size:"sm",onSelect:({value:s})=>s==="close"?$i(t):s==="rename"?i.edit():null,children:[a.jsx(xu,{as:"div",children:a.jsxs(Ai,{value:t,hideButtonUnlessHover:!0,hideButtonUnlessSelected:!0,buttonProps:{children:a.jsx(Ls,{}),onClick:()=>$i(t)},ref:n,...r,children:[a.jsx(br,{children:a.jsx(Cr,{})}),a.jsx(Ut.RootProvider,{value:i,size:"sm",children:a.jsxs(Ut.Area,{children:[a.jsx(Ut.Preview,{cursor:"unset",_hover:{bg:"unset"}}),a.jsx(Ut.Input,{focusRing:"none",onClick:s=>s.stopPropagation(),onKeyDown:s=>s.stopPropagation(),onKeyUp:s=>s.preventDefault()})]})})]})}),a.jsxs(Ze,{children:[a.jsx(ae,{value:"rename",children:"Rename"}),a.jsx(ae,{value:"close",children:"Close"})]})]},t)});function up(t,e,n){var r=this,i=ot(null),s=ot(0),o=ot(null),c=ot([]),u=ot(),l=ot(),h=ot(t),f=ot(!0);h.current=t;var d=typeof window<"u",p=!e&&e!==0&&d;if(typeof t!="function")throw new TypeError("Expected a function");e=+e||0;var x=!!(n=n||{}).leading,m=!("trailing"in n)||!!n.trailing,v="maxWait"in n,g="debounceOnServer"in n&&!!n.debounceOnServer,y=v?Math.max(+n.maxWait||0,e):null;Gt(function(){return f.current=!0,function(){f.current=!1}},[]);var b=W(function(){var w=function(k){var P=c.current,R=u.current;return c.current=u.current=null,s.current=k,l.current=h.current.apply(R,P)},I=function(k,P){p&&cancelAnimationFrame(o.current),o.current=p?requestAnimationFrame(k):setTimeout(k,P)},E=function(k){if(!f.current)return!1;var P=k-i.current;return!i.current||P>=e||P<0||v&&k-s.current>=y},_=function(k){return o.current=null,m&&c.current?w(k):(c.current=u.current=null,l.current)},S=function k(){var P=Date.now();if(E(P))return _(P);if(f.current){var R=e-(P-i.current),$=v?Math.min(R,y-(P-s.current)):R;I(k,$)}},A=function(){if(d||g){var k=Date.now(),P=E(k);if(c.current=[].slice.call(arguments),u.current=r,i.current=k,P){if(!o.current&&f.current)return s.current=i.current,I(S,e),x?w(i.current):l.current;if(v)return I(S,e),w(i.current)}return o.current||I(S,e),l.current}};return A.cancel=function(){o.current&&(p?cancelAnimationFrame(o.current):clearTimeout(o.current)),s.current=0,c.current=i.current=u.current=o.current=null},A.isPending=function(){return!!o.current},A.flush=function(){return o.current?_(Date.now()):l.current},A},[x,v,e,y,m,p,d,g]);return b}function hp(t,e){return t===e}function xa(t,e,n){var r=hp,i=ot(t),s=lt({})[1],o=up(nt(function(u){i.current=u,s({})},[s]),e,n),c=ot(t);return r(c.current,t)||(o(t),c.current=t),[i.current,o]}const dp=t=>/^[A-Za-z0-9_]{4,15}$/.test(t),fp=t=>/^\d+|deposited$/.test(t),pp=co(async({pdbId:t,assemblyId:e},n)=>{var i,s;if(!dp(t))throw new Error("PDB ID is invalid");if(e!==void 0&&!fp(e))throw new Error("PDB ID is invalid");const{data:r}=await Zs.post("https://data.rcsb.org/graphql",{query:"query ($pdbId: String!) { entry(entry_id: $pdbId) { struct { title } assemblies { rcsb_assembly_info { assembly_id } } rcsb_comp_model_provenance { source_url } } }",variables:{pdbId:t}},{signal:n});return!((i=r.data)!=null&&i.entry)||r.data.entry.assemblies.length===0||e&&!r.data.entry.assemblies.find(({rcsb_assembly_info:o})=>o.assembly_id===e)?!1:{title:r.data.entry.struct.title,sourceUrl:(s=r.data.entry.rcsb_comp_model_provenance)==null?void 0:s.source_url}}),va=t=>e=>{const[n,r]=lt({});return Gt(()=>{if(e===n.query)return;if(e===void 0){r({});return}const i=new AbortController;return r({query:e}),t(e,i.signal).then(s=>{r({query:e,data:s})}).catch(s=>{s.name!=="CanceledError"&&r({query:e,error:s})}),()=>{i.abort()}},e&&Object.values(e)),n},mp=va(uo),gp=va(pp),Br=t=>{const[e,n]=t.split("-",2);return{pdbId:e,assemblyId:n}},xp=Ct(({autoFocus:t,onAddedStructures:e,inputRef:n,...r},i)=>{const[s,o]=lt(""),[c,{isPending:u}]=xa(s,300),{query:l,data:h,error:f}=gp(Br(c)),[d,p]=lt(!1),x=!!s&&!u()&&(l==null?void 0:l.pdbId)===Br(s).pdbId&&(l==null?void 0:l.assemblyId)===Br(s).assemblyId,m=x&&h,v=x&&(!!f||h===!1),g=d||!!s&&!m&&!v;return a.jsx(wn,{ref:i,...r,invalid:v,errorText:v&&((f==null?void 0:f.message)??(h===!1&&"PDB ID doesn't exist")),colorPalette:m?"green":void 0,helperText:m&&h.title,disabled:d,children:a.jsx(ui,{flex:"1",w:"full",startElement:a.jsx(Vs,{}),endElement:g?a.jsx(Ie,{}):m?a.jsx(Fs,{}):void 0,children:a.jsx(Ne,{placeholder:"PDB ID",ref:n,value:s,onChange:y=>o(y.target.value),autoFocus:t,spellCheck:"false",autoCorrect:"false",onKeyDown:y=>{y.key==="Enter"&&m&&(e([{name:s,...l,sourceUrl:h.sourceUrl}]),p(!0))}})})})}),vp=Ct(({autoFocus:t,...e},n)=>{const[r,i]=lt(""),[s,{isPending:o}]=xa(r,300),{query:c,data:u,error:l}=mp({accession:s}),h=!!r&&!o()&&(c==null?void 0:c.accession)===r,f=h&&!!u,d=h&&!!l,p=!!r&&!f&&!d;return a.jsx(wn,{ref:n,...e,invalid:d,errorText:d&&l.message,colorPalette:f?"green":void 0,children:a.jsx(ui,{flex:"1",w:"full",startElement:a.jsx(Vs,{}),endElement:p?a.jsx(Ie,{}):f?a.jsx(Fs,{}):void 0,children:a.jsx(Ne,{placeholder:"UniProt accession",value:r,maxLength:wc,onChange:x=>i(x.target.value.toUpperCase()),autoFocus:t,spellCheck:"false",autoCorrect:"false"})})})}),yp=({onAddedStructures:t})=>{const[e,n]=tl(),r=bl({maxFiles:1/0,disabled:e,validate:i=>i.name.endsWith(".cif")?null:["FILE_INVALID_TYPE"],onFileChange:({acceptedFiles:i,rejectedFiles:s})=>{if(s.length>0){Se.error({title:`Failed to process ${At(s.map(({file:o})=>o.name))}`}),r.clearFiles();return}i.length>0&&n(()=>t(i.map(o=>({name:o.name.split(".",1)[0],file:o}))))}});return a.jsx(Fa,{value:r,gap:"1",children:a.jsx(ui,{w:"full",startElement:a.jsx(Ba,{}),endElement:e&&a.jsx(Ie,{}),children:a.jsx(Va,{placeholder:"Upload structure(s) (.cif)"})})})},wp=({value:t,...e})=>a.jsx(ke,{value:t,placement:"top",lazyMount:!0,unmountOnExit:!0,...e,children:a.jsxs(ue,{children:[a.jsxs(pe,{flexDir:"column",children:[a.jsx(ge,{children:"Add structures to the project"}),a.jsx(Nn,{children:"using one of the following options:"}),a.jsx(de,{})]}),a.jsx(me,{children:a.jsxs(De,{gap:"4",children:[a.jsx(xp,{autoFocus:!0,onAddedStructures:n=>{t.setOpen(!1),es(n)}}),a.jsx(vp,{disabled:!0,onKeyDown:n=>n.key==="Enter"&&console.log("enter uniprot")}),a.jsx(yp,{onAddedStructures:n=>{t.setOpen(!1),es(n)}})]})}),a.jsx(fe,{})]})}),jp=({ref:t,...e})=>{const n=ce({restoreFocus:!1});return a.jsxs(a.Fragment,{children:[a.jsx(wp,{value:n}),a.jsx(Ai,{buttonProps:{children:a.jsx(en,{}),onClick:()=>n.setOpen(!0)},ref:t,...e,children:"Structures"})]})},bp=({ref:t,...e})=>{const n=gi(),{experiments:r,proteinIdToReferenceProtein:i}=St(D),s=Object.groupBy(r.flatMap(o=>o.proteins.flatMap(c=>({experiment:o,protein:c}))),({protein:o})=>{var c;return((c=i.get(o.id))==null?void 0:c.id)??o.id});return a.jsxs(zn,{maxW:"5xl",pt:6,ref:t,...e,children:[n.length===0&&a.jsx(Ys,{children:"No reference proteins"}),a.jsx(je.Root,{gap:5,children:n.map(o=>{const c=s[o.id],u=c?Object.groupBy(c,({protein:h})=>h.name):{},l=Object.keys(u).toSorted((h,f)=>{var d,p;return(((d=u[f])==null?void 0:d.length)??0)-(((p=u[h])==null?void 0:p.length)??0)}).map(h=>{var f;return[h,((f=u[h])==null?void 0:f.flatMap(({experiment:{name:d}})=>d?[d]:[]))??[]]});return a.jsxs(je.Item,{children:[a.jsx(Rn,{fontSize:"lg",fontWeight:"semibold",wordBreak:"break-word",name:o.name,onRename:h=>or(o.id,{name:h}),autoResize:!0,w:"fit-content"})," ","is"," ",l.length===0?"not referenced by any protein.":l.length===1?`referenced by ${l[0][0]} in ${At(l[0][1])}.`:"referenced by the proteins:",a.jsxs(je.Root,{ps:5,children:[l.length>1?l.map(([h,f])=>a.jsxs(Oi,{children:[h," in ",At(f)]},h)):null,a.jsx(Oi,{children:a.jsxs(st,{size:"2xs",colorPalette:"red",onClick:()=>zc(o.id),children:[a.jsx(Bs,{}),"Delete protein"]})})]})]},o.id)})})]})},_p=({ref:t,...e})=>{const n=ot(null);return a.jsxs(a.Fragment,{children:[a.jsx(xo,{dialogRef:n}),a.jsx(Ai,{buttonProps:{children:a.jsx(en,{}),onClick:()=>{var r;return(r=n.current)==null?void 0:r.setOpen(!0)}},ref:t,...e,children:"Proteins"})]})},Sp=it(({fileId:t,fileName:e,visible:n,structureId:r,toggle:i,ref:s,...o})=>a.jsxs(st,{size:"2xs",variant:n?"solid":"outline",className:"group",onClick:()=>i(n,t,r),ref:s,...o,children:[a.jsx(Cr,{}),e,a.jsx(br,{visibility:"hidden",_groupHover:{visibility:"visible"},children:n?a.jsx(Ha,{}):a.jsx(en,{})})]})),Cp=({ref:t,...e})=>{const{experiments:n,structures:r,experimentIdToGroupedStructureIds:i}=St(D),s=W(()=>Object.fromEntries(r.map(({id:o})=>[o,n.map(c=>{var u;return{fileId:c.id,fileName:c.name,structureId:o,visible:((u=i[c.id])==null?void 0:u.some(l=>l.includes(o)))??!1}})])),[r,n,i]);return a.jsxs(zn,{maxW:"5xl",pt:6,ref:t,...e,children:[r.length===0&&a.jsx(Ys,{children:"No structures"}),a.jsx(je.Root,{gap:5,children:r.map(o=>a.jsxs(je.Item,{children:[a.jsx(Rn,{fontSize:"lg",fontWeight:"semibold",wordBreak:"break-word",name:o.name,onRename:c=>wo(o.id,{name:c}),autoResize:!0,disabled:o.loading}),o.loading?a.jsx(Ie,{ml:2,size:"sm"}):a.jsxs(je.Root,{ms:6,children:[a.jsxs(je.Item,{children:["Appears in"," ",s[o.id].filter(({visible:c})=>c).length,"/",Mt(n.length,"file"),":",s[o.id].map(({fileId:c,fileName:u,visible:l})=>a.jsx(Sp,{ml:2,fileId:c,fileName:u,structureId:o.id,visible:l,toggle:(h,f,d)=>{h?xi(f,[d]):Wc(f,[d])}},c))]}),a.jsx(je.Item,{children:a.jsxs(st,{size:"2xs",colorPalette:"red",onClick:()=>jo([o.id]),children:[a.jsx(Bs,{}),"Delete structure"]})})]})]},o.id))})]})},Tp=({protein:t,stats:e,domainNameToStats:n,toggleVisibility:r,hideMultiProteinToggles:i,ref:s,...o})=>{const c=e.interprotein.visible+e.intraprotein.visible>0;return a.jsxs(be.Root,{borderColor:c?"colorPalette.solid":void 0,ref:s,...o,children:[a.jsxs(be.Header,{children:[a.jsxs(at,{flexDir:"row",alignItems:"center",children:[a.jsx(Rn,{name:t.name,onRename:u=>or(t.id,{name:u}),size:"lg",fontWeight:"semibold"}),a.jsx(Yt,{stat:e.interprotein,stat2:e.intraprotein,toggleVisibility:r,dir:"rtl"})]}),a.jsx(vo,{protein:{isReferenceProtein:!0,...t},domainNameToStats:n,toggleVisibility:r,experimentId:null,w:"fit-content",mt:-2})]}),a.jsx(be.Body,{p:i?0:void 0,children:a.jsx($n,{children:!i&&a.jsxs(a.Fragment,{children:[a.jsx(Yt,{name:"Inter-protein",info:"Crosslinks that occur between two different proteins",stat:e.interprotein,toggleVisibility:r}),a.jsx(Yt,{name:"Intra-protein",info:"Crosslinks that occur within the same protein",stat:e.intraprotein,toggleVisibility:r})]})})}),a.jsx(be.Footer,{})]})},Ip=it(Tp),kp=it(({name:t="File",ref:e,...n})=>a.jsxs(at,{flexDir:"column",h:"100%",justifyContent:"space-between",alignItems:"center",gap:1,ref:e,...n,children:[a.jsx(br,{children:a.jsx(Cr,{})}),a.jsx(Lt,{display:"inline-flex",fontSize:"xs",writingMode:"vertical-lr",minH:"fit",flexGrow:1,justifyContent:"end",me:2,children:Hr(t,13)})]})),Ap=it(({experiments:t,referenceProteinsById:e,groupedCrosslinkIds:n,groupDuplicates:r,hideCrosslinks:i})=>{var F,H,Y;const s=ie(t),o=ie(e),c=ie(n),u=ie(r),l=s!==t||o!==e||c!==n||u!==r,h=ot(null),f=W(()=>{const N=[void 0];return c.forEach(({rows:L},U)=>{U!==0&&N.push(void 0);const G=u?L.length:L.reduce((q,{ids:Z})=>q+Math.max(...Z.map(rt=>rt.length)),0);N.push(U),N.push(...Array(G-1).fill(void 0))}),N},[u,c]),d=W(()=>{const N=[void 0];return c.forEach(({rows:L},U)=>{U!==0&&N.push(void 0);for(const G of L)u?N.push(G):N.push(...vr(...G.ids).map(q=>({...G,ids:q.map(Z=>Z!==void 0?[Z]:[])})).flat())}),N},[u,c]),p=N=>{if(N===0)return"header";const L=d[N];return L===void 0?`gap-after-${p(N-1)}`:L.ids.map(U=>U.length>0?U.join("-"):"X").join(":")},x=ko({enabled:c.length>0,count:d.length,estimateSize:N=>N===0?30:d[N]===void 0?5:26,scrollMargin:((F=h.current)==null?void 0:F.offsetTop)??0,getItemKey:p,overscan:20,rangeExtractor:N=>new Set([0,...vi(N),...d.flatMap((L,U)=>L===void 0&&U+1<d.length?[U+1]:[])]).values().toArray()}),m=s.length,v=W(()=>[void 0,...Array(m).keys()],[m]),g=Io({enabled:c.length>0,horizontal:!0,count:v.length,getScrollElement:()=>h.current,estimateSize:N=>N===0?237:26,overscan:20,getItemKey:N=>N===0?"header":s[v[N]].id}),y=g.getVirtualItems(),[b,w]=y.length>0?[y[0].start,g.getTotalSize()-y[y.length-1].end]:[0,0];let I=((H=g.measurementsCache[0])==null?void 0:H.size)??0;const E=N=>{!g.options.enabled||!N||N.dataset.index!=="0"||I<N.getBoundingClientRect().width&&(I=N.getBoundingClientRect().width,g.resizeItem(0,Math.ceil(N.getBoundingClientRect().width)))};Gt(()=>{g.measure()},[c,o,g]);let _=((Y=x.measurementsCache[0])==null?void 0:Y.size)??0;const S=N=>{!x.options.enabled||!N||N.dataset.index!=="0"||_<N.getBoundingClientRect().height&&(_=N.getBoundingClientRect().height,x.resizeItem(0,Math.ceil(N.getBoundingClientRect().height)))};Gt(()=>{x.measure()},[s,x]);const A=W(()=>a.jsxs(a.Fragment,{children:[a.jsx(er,{styles:{".xlink":{cursor:"pointer",color:"transparent",fontSize:"0.8rem",alignContent:"center",textAlign:"center",":hover":{boxShadow:"inset 0px 0px 0px 1px var(--chakra-colors-fg-inverted)",color:"var(--chakra-colors-fg-inverted)"}}}}),a.jsx(er,{styles:Object.fromEntries(c.flatMap(({fromProteinId:N,fromDomainName:L,toProteinId:U,toDomainName:G})=>[N,...L?[N+L]:[],U,...G?[U+G]:[]].map(q=>[`html:has(.xlp${jn(q)}:hover) .xlp${jn(q)}`,{boxShadow:"inset 0px 0px 0px 1px var(--chakra-colors-fg-info)"}])))})]}),[c]),k=ce({}),{selectedCrosslinkIds:P,rowIndexToCheckedState:R,rowIndexToGroupCheckedState:$,numOfSelectedCrosslinks:j,numOfSelectedRows:T,onRowToggle:C,onGroupToggle:M,clearSelectedRows:O}=Oo(W(()=>s.map(({id:N})=>N),[s]),c,d,f),V=nt(N=>Sr(_r(s,c.map(({rows:L,...U})=>({rows:L.map(({ids:G,...q})=>({ids:G.map((Z,rt)=>Z.filter(tt=>{var $t;return(($t=N[s[rt].id])==null?void 0:$t.includes(tt))===!0})),...q})),...U}))),`${s.length===1?s[0].name??"XL Solver":"Experiments"}-xlinks`),[s,c]);return a.jsxs(a.Fragment,{children:[A,a.jsx(No,{dialog:k,dialogProps:{exportBasename:s.length===1?s[0].name??"XL Solver":"Experiments",gridProps:{experiments:s.map(N=>({experiment:N,structureToXlinkIdToStatus:{[N.id]:Object.fromEntries(N.crosslinks.map(({id:L})=>[L,"ok"]))},groupedStructureIds:[[N.id]]})),groupedCrosslinkIds:c,proteinsById:o,structureNameById:Object.fromEntries(s.map(({id:N,name:L})=>[N,L??"Experiment"]))}}}),a.jsx("div",{ref:h,style:{overflowY:"auto",opacity:l?.5:1,transition:l?"opacity 0.2s 0.2s linear":"opacity 0s 0s linear",userSelect:"none",WebkitUserSelect:"none",display:"flex",justifyContent:"center",marginLeft:"1rem",marginRight:"1rem"},children:a.jsx("div",{style:{height:x.getTotalSize(),position:"relative",width:g.getTotalSize()},children:x.getVirtualItems().map(N=>{const L=N.index===0,U=d[N.index];if(!L&&U===void 0)return null;const G=!L&&f[N.index]!==void 0?c[f[N.index]]:void 0;return a.jsxs("div",{"data-index":N.index,ref:N.index===0?S:void 0,style:{position:"absolute",top:0,left:0,transform:`translateY(${N.start-x.options.scrollMargin}px)`,display:"flex"},children:[a.jsx("div",{style:{width:`${b}px`}}),y.map(q=>{const Z=q.index===0,rt=v[q.index],tt=rt!==void 0?{file:s[rt],crosslinkIds:U==null?void 0:U.ids[rt]}:void 0;return a.jsxs("div",{"data-index":q.index,ref:q.index===0?E:void 0,className:Ke(tt==null?void 0:tt.crosslinkIds)?"xlink":void 0,onClick:()=>{if(tt!=null&&tt.crosslinkIds&&tt.crosslinkIds.length>0)throw new Error("TODO")},style:{minHeight:N.size,maxHeight:150,minWidth:q.size,maxWidth:500,flexShrink:0,...tt!=null&&tt.crosslinkIds?tt.crosslinkIds.length>0?{backgroundColor:se("ok")}:{backgroundColor:"transparent"}:{}},children:[L&&Z&&a.jsx($o,{viewName:s.length===1?s[0].name??"XL Solver":"Experiments",experiments:s,groupedCrosslinkIds:c,exportFigureDialog:k,showingStructures:!1,disableMenus:!1}),L&&!Z&&tt!==void 0&&a.jsx(kp,{name:tt.file.name}),Z&&!L&&U!==void 0&&a.jsx(_o,{rowHeader:U,groupHeader:G,checked:R[N.index],groupedChecked:$[N.index],toggle:C,toggleGroup:M}),(tt==null?void 0:tt.crosslinkIds)&&(tt.crosslinkIds.length??0)>1&&`x${tt.crosslinkIds.length}`]},q.key)}),a.jsx("div",{style:{width:`${w}px`}})]},N.key)})})}),a.jsx(Lo,{selectedCrosslinkIds:P,numOfSelectedCrosslinks:j,numOfSelectedRows:T,clearSelectedRows:O,saveCrosslinksTable:V,hideCrosslinks:i})]})}),Pp=({ref:t,...e})=>{const{experimentIdToGroupedStructureIds:n,experimentIdToVisibleCrosslinkIds:r,experiments:i,referenceProteinsById:s,proteinIdToReferenceProtein:o,groupDuplicatedCrosslinks:c}=St(D),[u,l]=lt(),h=Object.values(n).some(P=>P.some(R=>R.length>0)),f=h&&u!==!1,d=mo(...i),p=W(()=>sr(d.map(({id:P,crosslinks:R})=>R.filter(({id:$,from:j,to:T})=>r[P].has($)&&j.proteinId in s&&T.proteinId in s)),s),[d,r,s]),x=p.some(({rows:P})=>P.length>0),m=W(()=>{const P=()=>({total:0,data:[]}),R=Object.fromEntries(Object.values(s).map(({id:j,domains:T})=>[j,{stats:{interprotein:P(),intraprotein:P()},domainNameToStats:Object.fromEntries((T==null?void 0:T.map(({name:C})=>[C,{interdomain:P(),intradomain:P()}]))??[])}])),$=(j,T)=>{j.total+=T.length,j.data.push(...T)};for(const{fromProteinId:j,fromDomainName:T,toProteinId:C,toDomainName:M,rows:O}of p)j===C?$(R[j].stats.intraprotein,O):($(R[j].stats.interprotein,O),$(R[C].stats.interprotein,O)),T&&M&&T===M&&j===C?$(R[j].domainNameToStats[T].intradomain,O):[[j,T],[C,M]].forEach(([V,F])=>{F&&$(R[V].domainNameToStats[F].interdomain,O)});return R},[p,s]),[v,g]=lt({}),y=W(()=>{const P=j=>{let T=0;for(const{ids:C}of j)C.some((O,V)=>{const F=i[V].id;return v[F]===void 0||O.some(H=>!v[F].includes(H))})&&(T+=1);return T},R=j=>Jn(Object.entries(j).map(([T,{data:C,...M}])=>[T,{visible:P(C),data:C,...M}])),$={};for(const[j,{stats:T,domainNameToStats:C}]of Object.entries(m))$[j]={stats:R(T),domainNameToStats:Jn(Object.entries(C).map(([M,O])=>[M,R(O)]))};return $},[m,i,v]),b=nt((P,R=!1)=>{g(R?$=>Object.fromEntries(Object.entries($).map(([j,T])=>[j,T==null?void 0:T.filter(C=>{var M;return((M=P[j])==null?void 0:M.includes(C))!==!0})])):$=>Object.fromEntries(Object.values(Object.groupBy([...Object.entries($),...Object.entries(P)].flatMap(([j,T])=>T?[[j,T]]:[]),([j])=>j)).filter(j=>j!==void 0).map(j=>[j[0][0],j.flatMap(([T,C])=>C)])))},[g]),w=nt((P,...R)=>b(Object.fromEntries(vr(...R.flat().map(({ids:$})=>$)).map(($,j)=>[i[j].id,$.flatMap(T=>T??[])])),P),[b,i]),I=W(()=>sr(d.map(({id:P,crosslinks:R})=>R.filter(({id:$,from:j,to:T})=>{var C;return r[P].has($)&&j.proteinId in s&&T.proteinId in s&&((C=v[P])==null?void 0:C.includes($))!==!0})),s),[d,r,s,v]),{structures:E,experimentIdToThresholds:_,aminoAcidsMustMatch:S}=St(D),A=W(()=>E.filter(({id:P})=>Object.values(n).some(R=>R.flat().includes(P))),[E,n]),k=W(()=>d.map(P=>({experiment:P,structureToXlinkIdToStatus:pi(A??[],P.crosslinks,S,_[P.id]),visibleCrosslinkIds:new Set(P.crosslinks.filter(({id:R,from:$,to:j})=>{var T;return r[P.id].has(R)&&$.proteinId in s&&j.proteinId in s&&((T=v[P.id])==null?void 0:T.includes(R))!==!0}).map(({id:R})=>R)),groupedStructureIds:n[P.id]})),[d,A,S,_,r,s,v,n]);return a.jsxs(De,{ref:t,...e,children:[a.jsxs(zn,{maxW:"5xl",children:[!x&&a.jsxs(Bt.Root,{status:"warning",my:5,children:[a.jsx(Bt.Indicator,{}),a.jsxs(Bt.Content,{children:[a.jsx(Bt.Title,{children:"No data available"}),a.jsx(Bt.Description,{children:Object.keys(s).length===0||o.size===0?"Ensure that proteins in your experiments are mapped to a reference protein.":"All crosslinks were filtered out in the experiment pages."})]})]}),a.jsx(Rt,{position:"relative",children:a.jsx(at,{gapY:5,gapX:10,wrap:"wrap",children:Object.values(s).toSorted((P,R)=>P.name.localeCompare(R.name)).map(P=>a.jsx(Ip,{protein:P,stats:y[P.id].stats,domainNameToStats:y[P.id].domainNameToStats,toggleVisibility:w,hideMultiProteinToggles:Object.keys(s).length<=1,w:"30%",overflow:"clip",size:"sm"},P.id))})}),a.jsx(Oe,{my:5}),x&&a.jsxs(a.Fragment,{children:[a.jsx(De,{children:h&&a.jsx(Ro,{checked:!!f,onCheckedChange:({checked:P})=>l(!!P),children:"Show structures"})}),a.jsx(Oe,{my:5})]})]}),x&&(I.length===0?a.jsx(Do,{resetFilters:()=>g({}),loading:!1}):f?a.jsx(Fo,{experiments:k,structures:A??[],resetFilters:()=>g({}),hideCrosslinks:b,groupDuplicates:c}):a.jsx(Ap,{experiments:d,groupedCrosslinkIds:I,referenceProteinsById:s,groupDuplicates:c,hideCrosslinks:b}))]})},Mp=it(({value:t,onConfirm:e,ref:n,...r})=>a.jsx(ke,{value:t,role:"alertdialog",...r,children:a.jsxs(ue,{ref:n,children:[a.jsxs(pe,{children:[a.jsx(ge,{children:"Close Project?"}),a.jsx(de,{})]}),a.jsx(me,{children:"Are you sure you want to close this project? Any unsaved data will be lost."}),a.jsxs(fe,{children:[a.jsx(qr,{asChild:!0,children:a.jsx(st,{variant:"outline",children:"Cancel"})}),a.jsx(st,{colorPalette:"red",onClick:()=>e(),children:"Close Project"})]})]})}));function Ep(t){return on({attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M12 10v-2h-5v-2h5v-2l3 3zM11 9v4h-5v3l-6-3v-13h11v5h-1v-4h-8l4 2v9h4v-3z"},child:[]}]})(t)}const $p=it(({confirmBeforeClosing:t=!0,saveProject:e,closeProject:n,ref:r,...i})=>{const{colorMode:s,theme:o,toggleColorMode:c,setColorMode:u}=Wa(),l=ce({closeOnInteractOutside:!0,restoreFocus:!1}),{groupDuplicatedCrosslinks:h,aminoAcidsMustMatch:f}=St(D);return a.jsxs(a.Fragment,{children:[t&&a.jsx(Mp,{value:l,onConfirm:n}),a.jsxs(Qe,{onSelect:({value:d})=>d==="close"?t?l.setOpen(!0):n():d==="save"?e():d==="color-mode"?c():null,lazyMount:!0,unmountOnExit:!0,children:[a.jsx(yn,{asChild:!0,children:a.jsx(Be,{...i,ref:r,children:a.jsx(Xa,{})})}),a.jsxs(Ze,{children:[a.jsxs(ae,{value:"save",children:[a.jsx(Ua,{}),"Save Project (.","xlsolver",")"]}),a.jsxs(Qe,{positioning:{placement:"right-start",gutter:2},children:[a.jsx(yn,{asChild:!0,children:a.jsxs(cs,{value:"bla",children:[a.jsx(Ga,{}),"Project Options"]})}),a.jsxs(Ze,{children:[a.jsxs(ls,{value:"group-duplicates",checked:h,onCheckedChange:d=>{D.groupDuplicatedCrosslinks=d},children:["Group Identical Crosslinks",a.jsx(Li,{})]}),a.jsxs(ls,{value:"amino-acids-must-match",checked:f,onCheckedChange:d=>{D.aminoAcidsMustMatch=d},children:["Amino Acids Must Match",a.jsx(Li,{})]})]})]}),a.jsx(qn,{}),a.jsxs(Qe,{positioning:{placement:"right-start",gutter:2},children:[a.jsx(yn,{asChild:!0,children:a.jsxs(cs,{value:"color-mode",children:[s==="light"?a.jsx(qa,{}):a.jsx(Ka,{}),"Change Color Mode"]})}),a.jsx(Ze,{children:a.jsxs(gu,{value:o??"system",onValueChange:({value:d})=>u(d),children:[a.jsx(Rr,{value:"light",children:"Light"}),a.jsx(Rr,{value:"dark",children:"Dark"}),a.jsx(qn,{}),a.jsx(Rr,{value:"system",children:"System"})]})})]}),a.jsxs(ae,{value:"cite",disabled:!0,children:[a.jsx(Ya,{}),"Cite"]}),a.jsx(qn,{}),a.jsxs(ae,{value:"close",color:"fg.error",children:[a.jsx(Ep,{}),"Close Project"]})]})]})]})}),Rs=t=>{const e=document.createElement("a"),n=new Blob([cl(ul(t))],{type:"application/octet-stream"});e.href=URL.createObjectURL(n),e.download="project.xlsolver",e.click()};let Ns;const zp=({closeProject:t,ref:e,...n})=>{const{experiments:r}=St(D),i=_l({defaultValue:r.length===0?"empty":r[0].id,activationMode:"manual"}),s=W(()=>r.find(({id:h})=>h===i.value),[r,i.value]),o=r.length>1;(i.value!=="compare"||!o)&&i.value!=="proteins"&&i.value!=="structures"&&(r.length===0?i.setValue("empty"):s||i.setValue(r[0].id));const c=!ol();li("beforeunload",nt(h=>{c&&(h.preventDefault(),Ns=wt(Ns,{title:"Download a copy of the project?",description:"Any unsaved data will be lost.",type:"warning",action:{label:"Save Project",onClick:()=>Rs(JSON.stringify(zi()))}}))},[c]));const u=ot(i.setValue);u.current=i.setValue;const l=nt(()=>{const h=document.createElement("input");h.type="file",h.accept="text/csv,.zhrm",h.multiple=!0,h.onchange=f=>{h.remove();const d=Array.from(h.files??[]);if(d.length===0)return;const p=Se.create({type:"loading",title:`Loading ${Mt(d.length,"file")}...`});el(()=>{Promise.all(d.map(al)).then(x=>{ll(x),Se.success({id:p,title:`Added ${Mt(d.length,"experiment")}`,description:null}),u.current(x[0].id)}).catch(x=>{Se.error({id:p,title:"Error",description:x.message})})})},h.click()},[]);return a.jsxs(ve.RootProvider,{size:"sm",value:i,lazyMount:!0,unmountOnExit:!0,my:5,variant:"subtle",ref:e,...n,children:[a.jsxs(zn,{maxW:"5xl",children:[a.jsxs(ve.List,{w:"full",alignItems:"center",pb:1,children:[a.jsx(at,{flexDirection:"column",alignSelf:"stretch",mb:-1,children:a.jsx($p,{variant:"ghost",size:"md",pb:1,flexGrow:1,borderRadius:0,confirmBeforeClosing:c,saveProject:()=>Rs(JSON.stringify(zi())),closeProject:t})}),a.jsx(Oe,{orientation:"vertical",alignSelf:"stretch",mr:1,mb:-1}),a.jsxs(at,{wrap:"wrap",grow:1,children:[r.map((h,f)=>a.jsxs(tr,{gap:0,children:[a.jsx(cp,{experimentId:h.id,experimentName:h.name}),f===r.length-1&&a.jsx(Be,{size:"xs",variant:"ghost",alignSelf:"center",ml:2,onClick:l,children:a.jsx(en,{})})]},h.id)),r.length===0&&a.jsxs(st,{variant:"outline",size:"sm",onClick:l,children:[a.jsx(en,{}),"Add experiments to the project"]})]}),a.jsx(Oe,{orientation:"vertical",alignSelf:"stretch",mx:1,mb:-1}),o&&a.jsx(ve.Trigger,{value:"compare",flexShrink:0,height:"4.5rem",children:"Compare"}),a.jsxs(tr,{flexShrink:0,orientation:"vertical",gap:0,alignItems:"stretch",children:[a.jsx(_p,{value:"proteins"}),a.jsx(jp,{value:"structures"})]})]}),a.jsx(Oe,{})]}),a.jsx(ve.Content,{value:"compare",children:a.jsx(Pp,{})}),a.jsx(ve.Content,{value:"proteins",children:a.jsx(bp,{})}),a.jsx(ve.Content,{value:"structures",children:a.jsx(Cp,{})}),r.map(h=>a.jsx(ve.Content,{value:h.id,children:a.jsx(lp,{experiment:h})},h.id))]})},Xp=({initProps:t,closeProject:e})=>{const n=ot(!1);return n.current||(hl(t),n.current=!0),a.jsx(zp,{closeProject:e})};export{Xp as XLAppWrapper};
